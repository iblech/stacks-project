\input{preamble}

% OK, start here.
%
\begin{document}

\title{Pro-\'etale Cohomology}


\maketitle

\phantomsection
\label{section-phantom}

\tableofcontents

\section{Introduction}
\label{section-introduction}

\noindent
The material in this chapter and more can be found in the preprint \cite{BS}.

\medskip\noindent
The goal of this chapter is to introduce the pro-\'etale topology and
show how it simplifies the introduction of $\ell$-adic cohomology in
algebraic geometry.

\medskip\noindent
A brief overview of the history of this material as we have understood it.
In \cite[Expos\'es V and VI]{SGA5} Grothendieck et al developed a theory for
dealing with $\ell$-adic sheaves as inverse systems of sheaves of
$\mathbf{Z}/\ell^n\mathbf{Z}$-modules.
In his second paper on the Weil conjectures (\cite{WeilII}) Deligne introduced
a derived category of $\ell$-adic sheaves as a certain 2-limit of categories
of complexes of sheaves of $\mathbf{Z}/\ell^n\mathbf{Z}$-modules on the
\'etale site of a scheme $X$. This approach is used in the paper by
Beilinson, Bernstein, and Deligne (\cite{BBD}) as the basis for their
beautiful theory of perverse sheaves. In a paper entitled ``Continuous
\'Etale Cohomology'' (\cite{Jannsen}) Uwe Jannsen discusses an important
variant of the cohomology of a $\ell$-adic sheaf on a variety over a field.
His paper is followed up by a paper of Torsten Ekedahl (\cite{Ekedahl})
who discusses the adic formalism needed to work comfortably with derived
categories defined as limits.

\medskip\noindent
The goal of this chapter is to show that, if we work with the pro-\'etale
site of a scheme, then one can avoid some of the technicalities these
authors encountered. This comes at the expense of having to work with
non-Noetherian schemes, even when one is only interested in working with
$\ell$-adic sheaves and cohomology of such on varieties over an
algebraically closed field.




\section{Some topology}
\label{section-topology}

\noindent
Some preliminaries. We have defined {\it spectral spaces} and
{\it spectral maps} of spectral spaces in
Topology, Section \ref{topology-section-spectral}.
The spectrum of a ring is a spectral space, see
Algebra, Lemma \ref{algebra-lemma-spec-spectral}.

\begin{lemma}
\label{lemma-spectral-split}
Let $X$ be a spectral space. Let $X_0 \subset X$ be the set of closed points.
The following are equivalent
\begin{enumerate}
\item Every open covering of $X$ can be refined by a finite
disjoint union decomposition $X = \coprod U_i$ with $U_i$
open and closed in $X$.
\item The composition $X_0 \to X \to \pi_0(X)$ is bijective.
\end{enumerate}
Moreover, if $X_0$ is closed in $X$ and every point of $X$ specializes
to a unique point of $X_0$, then these conditions are satisfied.
\end{lemma}

\begin{proof}
We will use without further mention that
$X_0$ is quasi-compact
(Topology, Lemma \ref{topology-lemma-closed-points-quasi-compact})
and $\pi_0(X)$ is profinite
(Topology, Lemma \ref{topology-lemma-spectral-pi0}).
Picture
$$
\xymatrix{
X_0 \ar[rd]_f \ar[r] & X \ar[d]^\pi \\
& \pi_0(X)
}
$$
If (2) holds, the continuous bijective map $f : X_0 \to \pi_0(X)$ is
a homeomorphism by
Topology, Lemma \ref{topology-lemma-bijective-map}.
Given an open covering $X = \bigcup U_i$, we get an open covering
$\pi_0(X) = \bigcup f(X_0 \cap U_i)$. By
Topology, Lemma \ref{topology-lemma-profinite-refine-open-covering}
we can find a finite open covering of the form $\pi_0(X) = \coprod V_j$
which refines this covering.
Since $X_0 \to \pi_0(X)$ is bijective each connected component of
$X$ has a unique closed point, whence is equal to the set of points
specializing to this closed point. Hence $\pi^{-1}(V_j)$ is the
set of points specializing to the points of $f^{-1}(V_j)$.
Now, if $f^{-1}(V_j) \subset X_0 \cap U_i \subset U_i$, then
it follows that $\pi^{-1}(V_j) \subset U_i$ (because the open set
$U_i$ is closed under generalizations). In this way we see
that the open covering $X = \coprod \pi^{-1}(V_j)$ refines
the covering we started out with. In this way we see that
(2) implies (1).

\medskip\noindent
Assume (1). Let $x, y \in X$ be closed points. Then we have the open covering
$X = (X \setminus \{x\}) \cup (X \setminus \{y\})$.
It follows from (1) that there exists a disjoint union decomposition
$X = U \amalg V$ with $U$ and $V$ open (and closed) and $x \in U$ and
$y \in V$. In particular we see that every connected component of $X$
has at most one closed point. By
Topology, Lemma \ref{topology-lemma-quasi-compact-closed-point}
every connected component (being closed) also does have a closed point.
Thus $X_0 \to \pi_0(X)$ is bijective. In this way we see that (1) implies (2).

\medskip\noindent
Assume $X_0$ is closed in $X$ and every point specializes to a unique
point of $X_0$. Then $X_0$ is a spectral space
(Topology, Lemma \ref{topology-lemma-spectral-sub})
consisting of closed points, hence profinite
(Topology, Lemma \ref{topology-lemma-characterize-profinite-spectral}).
Let $x, y \in X_0$ be distinct. By
Topology, Lemma \ref{topology-lemma-profinite-refine-open-covering}
we can find a disjoint union decomposition
$X_0 = U_0 \amalg V_0$ with $U_0$ and $V_0$ open and closed.
Let $\{U_i\}$ be the set of quasi-compact open subsets of $X$
such that $U_0 = X_0 \cap U_i$. Similarly, let $\{V_j\}$ be the
set of quasi-compact open subsets of $X$ such that
and $V_0 = X_0 \cap V_j$. If $U_i \cap V_j$ is nonempty for all $i, j$,
then there exists a point $\xi$ contained in all of them
(use the $U_i \cap V_j$ is constructible, hence closed in the
constructible topology, and use
Topology, Lemmas \ref{topology-lemma-constructible-hausdorff-quasi-compact} and
\ref{topology-lemma-intersection-closed-in-quasi-compact}).
However, since $X$ is sober and $V_0$ is closed in $X$,
the intersection $\bigcap U_i$ is the set of points specializing to $U_0$.
Similarly, $\bigcap V_j$ is the set of points specializing to $V_0$.
Since $U_0 \cap V_0$ is empty this is a contradiction.
Thus we find disjoint quasi-compact opens $U, V \subset X$
such that $U_0 = X_0 \cap U$ and $V_0 = X_0 \cap V$.
Observe that $X = U \cup V = U \amalg V$ as
$X_0 \subset U \cup V$ (use
Topology, Lemma \ref{topology-lemma-quasi-compact-closed-point}).
This proves that $x, y$ are not in the same connected component of $X$.
In other words, $X_0 \to \pi_0(X)$ is injective. The map is also
surjective by
Topology, Lemma \ref{topology-lemma-quasi-compact-closed-point}
and the fact that connected components are closed.
In this way we see that the final condition implies (1).
\end{proof}

\begin{example}
\label{example-not-w-local}
Let $T$ be a profinite space. Let $t \in T$ be a point and assume
that $T \setminus \{t\}$ is not quasi-compact.
Let $X = T \times \{0, 1\}$. Consider the topology on $X$
with a subbase given by the sets
$U \times \{0, 1\}$ for $U \subset T$ open, $X \setminus \{(t, 0)\}$,
and $U \times \{1\}$ for $U \subset T$ open with $t \not \in U$.
The set of closed points of $X$ is $X_0 = T \times \{0\}$ and
$(t, 1)$ is in the closure of $X_0$.
Moreover, $X_0 \to \pi_0(X)$ is a bijection.
This example shows that conditions (1) and (2) of
Lemma \ref{lemma-spectral-split} do no imply the set of closed points
is closed.
\end{example}

\noindent
It turns out it is more convenient to work with spectral
spaces which have the slightly stronger property mentioned in
the final statement of Lemma \ref{lemma-spectral-split}.
We give this property a name.

\begin{definition}
\label{definition-w-local}
A spectral space $X$ is {\it w-local} if the set of closed points $X_0$
is closed and every point of $X$ specializes to a unique closed point.
A continuous map $f : X \to Y$ of w-local spaces is {\it w-local}
if it is spectral and maps any closed point of $X$ to a closed point of $Y$.
\end{definition}

\noindent
We have seen in the proof of Lemma \ref{lemma-spectral-split}
that in this case $X_0 \to \pi_0(X)$ is a homeomorphism and that
$X_0 \cong \pi_0(X)$ is a profinite space. Moreover, a connected
component of $X$ is exactly the set of points specializing to
a given $x \in X_0$.

\begin{lemma}
\label{lemma-closed-subspace-w-local}
Let $X$ be a w-local spectral space. If $Y \subset X$ is closed,
then $Y$ is w-local.
\end{lemma}

\begin{proof}
The subset $Y_0 \subset Y$ of closed points is closed because
$Y_0 = X_0 \cap Y$. Since $X$ is $w$-local, every $y \in Y$ specializes
to a unique point of $X_0$. This specialization is in $Y$, and hence
also in $Y_0$, because $\overline{\{y\}}\subset Y$. In conclusion, $Y$
is $w$-local.
\end{proof}

\begin{lemma}
\label{lemma-silly}
Let $X$ be a spectral space. Let
$$
\xymatrix{
Y \ar[r] \ar[d] & T \ar[d] \\
X \ar[r] & \pi_0(X)
}
$$
be a cartesian diagram in the category of topological spaces
with $T$ profinite. Then $Y$ is spectral and $T = \pi_0(Y)$.
If moreover $X$ is w-local, then $Y$ is w-local, $Y \to X$ is w-local,
and the set of closed points of $Y$ is the inverse image of the
set of closed points of $X$.
\end{lemma}

\begin{proof}
Note that $Y$ is a closed subspace of $X \times T$ as $\pi_0(X)$
is a profinite space hence Hausdorff
(use Topology, Lemmas \ref{topology-lemma-spectral-pi0} and
\ref{topology-lemma-fibre-product-closed}).
Since $X \times T$ is spectral
(Topology, Lemma \ref{topology-lemma-product-spectral-spaces})
it follows that $Y$ is spectral
(Topology, Lemma \ref{topology-lemma-spectral-sub}).
Let $Y \to \pi_0(Y) \to T$ be the canonical factorization
(Topology, Lemma \ref{topology-lemma-space-connected-components}).
It is clear that $\pi_0(Y) \to T$ is surjective.
The fibres of $Y \to T$ are homeomorphic to the fibres of
$X \to \pi_0(X)$. Hence these fibres are connected. It follows
that $\pi_0(Y) \to T$ is injective. We conclude that $\pi_0(Y) \to T$
is a homeomorphism by
Topology, Lemma \ref{topology-lemma-bijective-map}.

\medskip\noindent
Next, assume that $X$ is w-local and let $X_0 \subset X$ be the
set of closed points. The inverse image $Y_0 \subset Y$ of $X_0$ in
$Y$ maps bijectively onto $T$ as $X_0 \to \pi_0(X)$ is a bijection
by Lemma \ref{lemma-spectral-split}. Moreover, $Y_0$ is quasi-compact
as a closed subset of the spectral space $Y$. Hence
$Y_0 \to \pi_0(Y) = T$ is a homeomorphism by
Topology, Lemma \ref{topology-lemma-bijective-map}.
It follows that all points of $Y_0$ are closed in $Y$.
Conversely, if $y \in Y$ is a closed point, then
it is closed in the fibre of $Y \to \pi_0(Y) = T$
and hence its image $x$ in $X$ is closed in the (homeomorphic) fibre of
$X \to \pi_0(X)$. This implies $x \in X_0$ and hence $y \in Y_0$.
Thus $Y_0$ is the collection of closed points of $Y$
and for each $y \in Y_0$ the set of generalizations of $y$ is
the fibre of $Y \to \pi_0(Y)$. The lemma follows.
\end{proof}




\section{Local isomorphisms}
\label{section-local-isomorphism}

\noindent
We start with a definition.

\begin{definition}
\label{definition-local-isomorphism}
Let $\varphi : A \to B$ be a ring map.
\begin{enumerate}
\item We say $A \to B$ is a {\it local isomorphism} if for every prime
$\mathfrak q \subset B$ there exists a $g \in B$, $g \not \in \mathfrak q$
such that $A \to B_g$ induces an open immersion $\Spec(B_g) \to \Spec(A)$.
\item We say $A \to B$ {\it identifies local rings} if for every prime
$\mathfrak q \subset B$ the canonical map
$A_{\varphi^{-1}(\mathfrak q)} \to B_\mathfrak q$ is an isomorphism.
\end{enumerate}
\end{definition}

\noindent
We list some elementary properties.

\begin{lemma}
\label{lemma-base-change-local-isomorphism}
Let $A \to B$ and $A \to A'$ be ring maps. Let $B' = B \otimes_A A'$
be the base change of $B$.
\begin{enumerate}
\item If $A \to B$ is a local isomorphism, then $A' \to B'$ is a
local isomorphism.
\item If $A \to B$ identifies local rings, then $A' \to B'$
identifies local rings.
\end{enumerate}
\end{lemma}

\begin{proof}
Omitted.
\end{proof}

\begin{lemma}
\label{lemma-composition-local-isomorphism}
Let $A \to B$ and $B \to C$ be ring maps.
\begin{enumerate}
\item If $A \to B$ and $B \to C$ are local isomorphisms, then $A \to C$
is a local isomorphism.
\item If $A \to B$ and $B \to C$ identify local rings, then $A \to C$
identifies local rings.
\end{enumerate}
\end{lemma}

\begin{proof}
Omitted.
\end{proof}

\begin{lemma}
\label{lemma-local-isomorphism-permanence}
Let $A$ be a ring. Let $B \to C$ be an $A$-algebra homomorphism.
\begin{enumerate}
\item If $A \to B$ and $A \to C$ are local isomorphisms, then $B \to C$
is a local isomorphism.
\item If $A \to B$ and $A \to C$ identify local rings, then $B \to C$
identifies local rings.
\end{enumerate}
\end{lemma}

\begin{proof}
Omitted.
\end{proof}

\begin{lemma}
\label{lemma-local-isomorphism-implies}
Let $A \to B$ be a local isomorphism. Then
\begin{enumerate}
\item $A \to B$ is \'etale,
\item $A \to B$ identifies local rings,
\item $A \to B$ is quasi-finite.
\end{enumerate}
\end{lemma}

\begin{proof}
Omitted.
\end{proof}

\begin{lemma}
\label{lemma-structure-local-isomorphism}
Let $A \to B$ be a local isomorphism. Then there exist $n \geq 0$,
$g_1, \ldots, g_n \in B$, $f_1, \ldots, f_n \in A$ such that
$(g_1, \ldots, g_n) = B$ and $A_{f_i} \cong B_{g_i}$.
\end{lemma}

\begin{proof}
Omitted.
\end{proof}

\begin{lemma}
\label{lemma-fully-faithful-spaces-over-X}
Let $p : (Y, \mathcal{O}_Y) \to (X, \mathcal{O}_X)$ and
$q : (Z, \mathcal{O}_Z) \to (X, \mathcal{O}_X)$
be morphisms of locally ringed spaces.
If $\mathcal{O}_Y = p^{-1}\mathcal{O}_X$, then
$$
\Mor_{\text{LRS}/(X, \mathcal{O}_X)}((Z, \mathcal{O}_Z), (Y, \mathcal{O}_Y))
\longrightarrow
\Mor_{\textit{Top}/X}(Z, Y),\quad
(f, f^\sharp) \longmapsto f
$$
is bijective. Here $\text{LRS}/(X, \mathcal{O}_X)$ is the category of
locally ringed spaces over $X$ and $\textit{Top}/X$ is the category
of topological spaces over $X$.
\end{lemma}

\begin{proof}
This is immediate from the definitions.
\end{proof}

\begin{lemma}
\label{lemma-local-isomorphism-fully-faithful}
Let $A$ be a ring. Set $X = \Spec(A)$. The functor
$$
B \longmapsto \Spec(B)
$$
from the category of $A$-algebras $B$ such that $A \to B$ identifies
local rings to the category of
topological spaces over $X$ is fully faithful.
\end{lemma}

\begin{proof}
This follows from Lemma \ref{lemma-fully-faithful-spaces-over-X}
and the fact that if $A \to B$ identifies local rings, then the pullback
of the structure sheaf of $\Spec(A)$ via $p : \Spec(B) \to \Spec(A)$
is equal to the structure sheaf of $\Spec(B)$.
\end{proof}




\section{Ind-Zariski algebra}
\label{section-ind-zariski}

\noindent
We start with a definition; please see Remark \ref{remark-slightly-stronger}
for a comparison with the corresponding definition of the article \cite{BS}.

\begin{definition}
\label{definition-ind-zariski}
A ring map $A \to B$ is said to be {\it ind-Zariski} if $B$ can be written
as a filtered colimit $B = \colim B_i$ with each $A \to B_i$ a local
isomorphism.
\end{definition}

\noindent
An example of an Ind-Zariski map is a localization $A \to S^{-1}A$, see
Algebra, Lemma \ref{algebra-lemma-localization-colimit}.
The category of ind-Zariski algebras is closed under several natural
operations.

\begin{lemma}
\label{lemma-base-change-ind-zariski}
Let $A \to B$ and $A \to A'$ be ring maps. Let $B' = B \otimes_A A'$
be the base change of $B$.
If $A \to B$ is ind-Zariski, then $A' \to B'$ is ind-Zariski.
\end{lemma}

\begin{proof}
Omitted.
\end{proof}

\begin{lemma}
\label{lemma-composition-ind-zariski}
Let $A \to B$ and $B \to C$ be ring maps. If $A \to B$ and $B \to C$
are ind-Zariski, then $A \to C$ is ind-Zariski.
\end{lemma}

\begin{proof}
Omitted.
\end{proof}

\begin{lemma}
\label{lemma-ind-zariski-permanence}
Let $A$ be a ring. Let $B \to C$ be an $A$-algebra homomorphism.
If $A \to B$ and $A \to C$ are ind-Zariski, then $B \to C$
is ind-Zariski.
\end{lemma}

\begin{proof}
Omitted.
\end{proof}

\begin{lemma}
\label{lemma-ind-ind-zariski}
A filtered colimit of ind-Zariski $A$-algebras is ind-Zariski over $A$.
\end{lemma}

\begin{proof}
Omitted.
\end{proof}

\begin{lemma}
\label{lemma-ind-zariski-implies}
Let $A \to B$ be ind-Zariski. Then $A \to B$ identifies local rings,
\end{lemma}

\begin{proof}
Omitted.
\end{proof}







\section{Constructing w-local affine schemes}
\label{section-construction}

\noindent
An affine scheme $X$ is called {\it w-local} if its underlying
topological space is w-local (Definition \ref{definition-w-local}).
It turns out given any ring $A$ there is a canonical faithfully
flat ind-Zariski ring map $A \to A_w$ such that $\Spec(A_w)$ is
w-local. The key to constructing $A_w$ is the following simple lemma.

\begin{lemma}
\label{lemma-localization}
Let $A$ be a ring. Set $X = \Spec(A)$. Let $Z \subset X$ be a locally closed
subscheme which is of the form $D(f) \cap V(I)$ for some $f \in A$ and
ideal $I \subset A$. Then
\begin{enumerate}
\item there exists a multiplicative subset $S \subset A$ such that
$\Spec(S^{-1}A)$ maps by a homeomorphism to the set of points of $X$
specializing to $Z$,
\item the $A$-algebra $A_Z^\sim = S^{-1}A$ depends only on
the underlying locally closed subset $Z \subset X$,
\item $Z$ is a closed subscheme of $\Spec(A_Z^\sim)$,
\end{enumerate}
If $A \to A'$ is a ring map and $Z' \subset X' = \Spec(A')$ is a
locally closed subscheme of the same form which maps into $Z$,
then there is a unique $A$-algebra map
$A_Z^\sim \to (A')_{Z'}^\sim$.
\end{lemma}

\begin{proof}
Let $S \subset A$ be the multiplicative set of elements which map
to invertible elements of $\Gamma(Z, \mathcal{O}_Z) = (A/I)_f$.
If $\mathfrak p$ is a prime of $A$ which does not specialize to $Z$,
then $\mathfrak p$ generates the unit ideal in $(A/I)_f$. Hence
we can write $f^n =  g + h$ for some $n \geq 0$, $g \in \mathfrak p$,
$h \in I$. Then $g \in S$ and we see that $\mathfrak p$ is not in
the spectrum of $S^{-1}A$. Conversely, if $\mathfrak p$ does specialize
to $Z$, say $\mathfrak p \subset \mathfrak q \supset I$ with
$f \not \in \mathfrak q$, then we see that $S^{-1}A$ maps to
$A_\mathfrak q$ and hence $\mathfrak p$ is in the spectrum of $S^{-1}A$.
This proves (1).

\medskip\noindent
The isomorphism class of the localization $S^{-1}A$ depends only
on the corresponding subset $\Spec(S^{-1}A) \subset \Spec(A)$, whence
(2) holds. By construction $S^{-1}A$ maps surjectively onto
$(A/I)_f$, hence (3). The final statement follows as the multiplicative subset
$S' \subset A'$ corresponding to $Z'$ contains the image of the
multiplicative subset $S$.
\end{proof}

\noindent
Let $A$ be a ring. Let $E \subset A$ be a finite subset. We get a
stratification of $X = \Spec(A)$ into locally closed subschemes by
looking at the vanishing behaviour of the elements of $E$. More precisely,
given a disjoint union decomposition $E = E' \amalg E''$ we set
\begin{equation}
\label{equation-stratum}
Z(E', E'') =
\bigcap\nolimits_{f \in E'} D(f) \cap \bigcap\nolimits_{f \in E''} V(f) =
D(\prod\nolimits_{f \in E'} f) \cap V( \sum\nolimits_{f \in E''} fA)
\end{equation}
The points of $Z(E', E'')$ are exactly those $x \in X$ such that
$f \in E'$ maps to a nonzero element in $\kappa(x)$ and $f \in E''$
maps to zero in $\kappa(x)$. Thus it is clear that
\begin{equation}
\label{equation-stratify}
X = \coprod\nolimits_{E = E' \amalg E''} Z(E', E'')
\end{equation}
set theoretically. Observe that each stratum is constructible.

\begin{lemma}
\label{lemma-refine}
Let $X = \Spec(A)$ as above. Given any finite stratification
$X = \coprod T_i$ by constructible subsets, there exists a finite
subset $E \subset A$ such that the stratification (\ref{equation-stratify})
refines $X = \coprod T_i$.
\end{lemma}

\begin{proof}
We may write $T_i = \bigcup_j U_{i, j} \cap V_{i, j}^c$ as a finite union
for some $U_{i, j}$ and $V_{i, j}$ quasi-compact open in $X$.
Then we may write $U_{i, j} = \bigcup D(f_{i, j, k})$ and
$V_{i, j} = \bigcup D(g_{i, j, l})$. Then we set
$E = \{f_{i, j, k}\} \cup \{g_{i, j, l}\}$. This does the job, because
the stratification (\ref{equation-stratify}) is the one whose strata are
labeled by the vanishing pattern of the elements of $E$ which
clearly refines the given stratification.
\end{proof}

\noindent
We continue the discussion.
Given a finite subset $E \subset A$ we set
\begin{equation}
\label{equation-ring}
A_E = \prod\nolimits_{E = E' \amalg E''} A_{Z(E', E'')}^\sim
\end{equation}
with notation as in Lemma \ref{lemma-localization}. This makes sense because
(\ref{equation-stratum}) shows that each $Z(E', E'')$ has the correct shape.
We take the spectrum of this ring and denote it
\begin{equation}
\label{equation-spectrum}
X_E = \Spec(A_E) = \coprod\nolimits_{E = E' \amalg E''} X_{E', E''}
\end{equation}
with $X_{E', E''} = \Spec(A_{Z(E', E'')}^\sim)$. Note that
\begin{equation}
\label{equation-closed}
Z_E = \coprod\nolimits_{E = E' \amalg E''} Z(E', E'')
\longrightarrow
X_E
\end{equation}
is a closed subscheme. By construction the closed subscheme $Z_E$
contains all the closed points of the affine scheme $X_E$ as every point
of $X_{E', E''}$ specializes to a point of $Z(E', E'')$.

\medskip\noindent
Let $I(A)$ be the partially ordered set of all finite subsets of $A$.
This is a directed partially ordered set. For $E_1 \subset E_2$ there
is a canonical transition map $A_{E_1} \to A_{E_2}$ of $A$-algebras.
Namely, given a decomposition $E_2 = E'_2 \amalg E''_2$ we set
$E'_1 = E_1 \cap E'_2$ and $E''_1 = E_1 \cap E''_2$. Then observe that
$Z(E'_1, E''_1) \subset Z(E'_2, E''_2)$ hence a unique $A$-algebra map
$A_{Z(E'_1, E''_1)}^\sim \to A_{Z(E'_2, E''_2)}^\sim$ by
Lemma \ref{lemma-localization}. Using these maps collectively we obtain
the desired ring map $A_{E_1} \to A_{E_2}$. Observe that the corresponding
map of affine schemes
\begin{equation}
\label{equation-transition}
X_{E_2} \longrightarrow X_{E_1}
\end{equation}
maps $Z_{E_2}$ into $Z_{E_1}$. By uniqueness we obtain a system of
$A$-algebras over $I(A)$ and we set
\begin{equation}
\label{equation-colimit-ring}
A_w = \colim_{E \in I(A)} A_E
\end{equation}
This $A$-algebra is ind-Zariski and faithfully flat over $A$.
Finally, we set $X_w = \Spec(A_w)$ and endow it with the closed subscheme
$Z = \lim_{E \in I(A)} Z_E$. In a formula
\begin{equation}
\label{equation-final}
X_w = \lim_{E \in I(A)} X_E \supset Z = \lim_{E \in I(A)} Z_E
\end{equation}

\begin{lemma}
\label{lemma-make-w-local}
Let $X = \Spec(A)$ be an affine scheme. With $A \to A_w$, $X_w = \Spec(A_w)$,
and $Z \subset X_w$ as above.
\begin{enumerate}
\item $A \to A_w$ is ind-Zariski and faithfully flat,
\item $X_w \to X$ induces a bijection $Z \to X$,
\item $Z$ is the set of closed points of $X_w$,
\item $Z$ is a reduced scheme, and
\item every point of $X_w$ specializes to a unique point of $Z$.
\end{enumerate}
In particular, $X_w$ is w-local (Definition \ref{definition-w-local}).
\end{lemma}

\begin{proof}
The map $A \to A_w$ is ind-Zariski by construction.
For every $E$ the morphism $Z_E \to X$ is a bijection, hence (2).
As $Z \subset X_w$ we conclude $X_w \to X$ is surjective and
$A \to A_w$ is faithfully flat by
Algebra, Lemma \ref{algebra-lemma-ff-rings}. This proves (1).

\medskip\noindent
Suppose that $y \in X_w$, $y \not \in Z$. Then there
exists an $E$ such that the image of $y$ in $X_E$ is not contained in
$Z_E$. Then for all $E \subset E'$ also $y$ maps to an element of $X_{E'}$
not contained in $Z_{E'}$. Let $T_{E'} \subset X_{E'}$ be the reduced
closed subscheme which is the closure of the image of $y$. It is
clear that $T = \lim_{E \subset E'} T_{E'}$ is the closure of $y$ in $X_w$.
For every $E \subset E'$ the scheme $T_{E'} \cap Z_{E'}$ is nonempty
by construction of $X_{E'}$. Hence $\lim T_{E'} \cap Z_{E'}$ is nonempty
and we conclude that $T \cap Z$ is nonempty. Thus $y$ is not a closed point.
It follows that every closed point of $X_w$ is in $Z$.

\medskip\noindent
Suppose that $y \in X_w$ specializes to $z, z' \in Z$. We will show that
$z = z'$ which will finish the proof of (3) and will imply (5).
Let $x, x' \in X$ be the images of $z$ and $z'$. Since $Z \to X$ is
bijective it suffices to show that $x = x'$. If $x \not = x'$, then
there exists an $f \in A$ such that $x \in D(f)$ and $x' \in V(f)$
(or vice versa). Set $E = \{f\}$ so that
$$
X_E = \Spec(A_f) \amalg \Spec(A_{V(f)}^\sim)
$$
Then we see that $z$ and $z'$ map $x_E$ and $x'_E$ which are in different
parts of the given decomposition of $X_E$ above. But then it impossible
for $x_E$ and $x'_E$ to be specializations of a common point.
This is the desired contradiction.

\medskip\noindent
Recall that given a finite subset $E \subset A$ we have $Z_E$
is a disjoint union of the locally closed subschemes $Z(E', E'')$
each isomorphic to the spectrum of $(A/I)_f$ where $I$ is the ideal
generated by $E''$ and $f$ the product of the elements of $E'$.
Any nilpotent element $b$ of $(A/I)_f$ is the class of $g/f^n$
for some $g \in A$. Then setting $E' = E \cup \{g\}$ the reader
verifies that $b$ is pulls back to zero under the transition map
$Z_{E'} \to Z_E$ of the system. This proves (4).
\end{proof}

\begin{remark}
\label{remark-size-w}
Let $A$ be a ring. Let $\kappa$ be an infinite cardinal bigger or
equal than the cardinality of $A$. Then the cardinality of $A_w$
(Lemma \ref{lemma-make-w-local})
is at most $\kappa$. Namely, each $A_E$ has cardinality at most
$\kappa$ and the set of finite subsets of $A$ has cardinality at most $\kappa$
as well. Thus the result follows as $\kappa \otimes \kappa = \kappa$, see
Sets, Section \ref{sets-section-cardinals}.
\end{remark}

\begin{lemma}[Universal property of the construction]
\label{lemma-universal}
Let $A$ be a ring. Let $A \to A_w$ be the ring map constructed in
Lemma \ref{lemma-make-w-local}. For any ring map $A \to B$ such that
$\Spec(B)$ is w-local, there is a unique factorization $A \to A_w \to B$
such that $\Spec(B) \to \Spec(A_w)$ is w-local.
\end{lemma}

\begin{proof}
Denote $Y = \Spec(B)$ and $Y_0 \subset Y$ the set of closed points.
Denote $f : Y \to X$ the given morphism.
Recall that $Y_0$ is profinite, in particular every constructible
subset of $Y_0$ is open and closed. Let $E \subset A$ be a finite subset.
Recall that $A_w = \colim A_E$ and that the set of closed points of
$\Spec(A_w)$ is the limit of the closed subsets $Z_E \subset X_E = \Spec(A_E)$.
Thus it suffices to show there is a unique factorization $A \to A_E \to B$
such that $Y \to X_E$ maps $Y_0$ into $Z_E$.
Since $Z_E \to X = \Spec(A)$ is bijective, and since the strata
$Z(E', E'')$ are constructible we see that
$$
Y_0 = \coprod f^{-1}(Z(E', E'')) \cap Y_0
$$
is a disjoint union decomposition into open and closed subsets.
As $Y_0 = \pi_0(Y)$ we obtain a corresponding decomposition of
$Y$ into open and closed pieces. Thus it suffices to construct
the factorization in case $f(Y_0) \subset Z(E', E'')$ for
some decomposition $E = E' \amalg E''$.
In this case $f(Y)$ is contained in the set of points of $X$
specializing to $Z(E', E'')$ which is homeomorphic to $X_{E', E''}$.
Thus we obtain a unique continuous map $Y \to X_{E', E''}$ over $X$. By
Lemma \ref{lemma-fully-faithful-spaces-over-X}
this corresponds to a unique morphism of schemes
$Y \to X_{E', E''}$ over $X$. This finishes the proof.
\end{proof}

\noindent
Recall that the spectrum of a ring is profinite if and only if
every point is closed. There are in fact a whole slew of equivalent
conditions that imply this. See
Algebra, Lemma \ref{algebra-lemma-ring-with-only-minimal-primes} or
Topology, Lemma \ref{topology-lemma-characterize-profinite-spectral}.

\begin{lemma}
\label{lemma-profinite-goes-up}
Let $A$ be a ring such that $\Spec(A)$ is profinite. Let $A \to B$ be a
ring map. Then $\Spec(B)$ is profinite in each of the following cases:
\begin{enumerate}
\item if $\mathfrak q,\mathfrak q' \subset B$ lie over the same
prime of $A$, then neither $\mathfrak q \subset \mathfrak q'$, nor
$\mathfrak q' \subset \mathfrak q$,
\item $A \to B$ induces algebraic extensions of residue fields,
\item $A \to B$ is a local isomorphism,
\item $A \to B$ identifies local rings,
\item $A \to B$ is weakly \'etale,
\item $A \to B$ is quasi-finite,
\item $A \to B$ is unramified,
\item $A \to B$ is \'etale,
\item $B$ is a filtered colimit of $A$-algebras as in (1) -- (8),
\item etc.
\end{enumerate}
\end{lemma}

\begin{proof}
By the references mentioned above
(Algebra, Lemma \ref{algebra-lemma-ring-with-only-minimal-primes} or
Topology, Lemma \ref{topology-lemma-characterize-profinite-spectral})
there are no specializations between distinct points of $\Spec(A)$ and
$\Spec(B)$ is profinite if and only if there are no specializations
between distinct points of $\Spec(B)$. These specializations can only
happen in the fibres of $\Spec(B) \to \Spec(A)$. In this way we see
that (1) is true.

\medskip\noindent
The assumption in (2) implies all primes of $B$ are maximal by
Algebra, Lemma \ref{algebra-lemma-finite-residue-extension-closed}.
Thus (2) holds.
If $A \to B$ is a local isomorphism or identifies local rings,
then the residue field extensions are trivial, so (3) and (4)
follow from (2).
If $A \to B$ is weakly \'etale, then More on Algebra, Lemma
\ref{more-algebra-lemma-weakly-etale-residue-field-extensions}
tells us it induces separable algebraic residue field extensions, so
(5) follows from (2).
If $A \to B$ is quasi-finite, then the fibres are finite discrete
topological spaces. Hence (6) follows from (1).
Hence (3) follows from (1). Cases (7) and (8)
follow from this as unramified and \'etale ring map are quasi-finite
(Algebra, Lemmas
\ref{algebra-lemma-unramified-quasi-finite} and
\ref{algebra-lemma-etale-quasi-finite}).
If $B = \colim B_i$ is a filtered colimit of $A$-algebras, then
$\Spec(B) = \colim \Spec(B_i)$, hence if each $\Spec(B_i)$
is profinite, so is $\Spec(B)$. This proves (9).
\end{proof}

\begin{lemma}
\label{lemma-localize-along-closed-profinite}
Let $A$ be a ring. Let $V(I) \subset \Spec(A)$ be a closed subset
which is a profinite topological space. Then there exists an
ind-Zariski ring map $A \to B$ such that $\Spec(B)$ is w-local,
the set of closed points is $V(IB)$, and $A/I \cong B/IB$.
\end{lemma}

\begin{proof}
Let $A \to A_w$ and $Z \subset Y = \Spec(A_w)$ as in
Lemma \ref{lemma-make-w-local}.
Let $T \subset Z$ be the inverse image of $V(I)$.
Then $T \to V(I)$ is a homeomorphism by
Topology, Lemma \ref{topology-lemma-bijective-map}.
Let $B = (A_w)_T^\sim$, see Lemma \ref{lemma-localization}.
It is clear that $B$ is w-local with closed points $V(IB)$.
The ring map $A/I \to B/IB$ is ind-Zariski
and induces a homeomorphism on underlying
topological spaces. Hence it is an isomorphism by
Lemma \ref{lemma-local-isomorphism-fully-faithful}.
\end{proof}

\begin{lemma}
\label{lemma-w-local-algebraic-residue-field-extensions}
Let $A$ be a ring such that $X = \Spec(A)$ is w-local. Let $I \subset A$
be the radical ideal cutting out the set $X_0$ of closed points in $X$.
Let $A \to B$ be a ring map inducing algebraic extensions on residue
fields at primes. Then
\begin{enumerate}
\item every point of $Z = V(IB)$ is a closed point of $\Spec(B)$,
\item there exists an ind-Zariski ring map $B \to C$ such that
\begin{enumerate}
\item $B/IB \to C/IC$ is an isomorphism,
\item the space $Y = \Spec(C)$ is w-local,
\item the induced map $p : Y \to X$ is w-local, and
\item $p^{-1}(X_0)$ is the set of closed points of $Y$.
\end{enumerate}
\end{enumerate}
\end{lemma}

\begin{proof}
By Lemma \ref{lemma-profinite-goes-up} applied to $A/I \to B/IB$
all points of $Z = V(IB) = \Spec(B/IB)$ are closed, in fact $\Spec(B/IB)$
is a profinite space.
To finish the proof we apply Lemma \ref{lemma-localize-along-closed-profinite}
to $IB \subset B$.
\end{proof}





\section{Identifying local rings versus ind-Zariski}
\label{section-connected-components}

\noindent
An ind-Zariski ring map $A \to B$ identifies local rings
(Lemma \ref{lemma-ind-zariski-implies}). The converse does not hold
(Examples, Section \ref{examples-section-not-ind-etale}).
However, it turns out that there is a kind of structure theorem for
ring maps which identify local rings in terms of ind-Zariski
ring maps, see Proposition \ref{proposition-maps-wich-identify-local-rings}.

\medskip\noindent
Let $A$ be a ring. Let $X = \Spec(A)$. The space of connected
components $\pi_0(X)$ is a profinite space by
Topology, Lemma \ref{topology-lemma-spectral-pi0}
(and Algebra, Lemma \ref{algebra-lemma-spec-spectral}).

\begin{lemma}
\label{lemma-construct}
Let $A$ be a ring. Let $X = \Spec(A)$. Let $T \subset \pi_0(X)$ be a
closed subset. There exists a surjective ind-Zariski ring map $A \to B$
such that $\Spec(B) \to \Spec(A)$ induces a homeomorphism of $\Spec(B)$
with the inverse image of $T$ in $X$.
\end{lemma}

\begin{proof}
Let $Z \subset X$ be the inverse image of $T$. Then $Z$ is the intersection
$Z = \bigcap Z_\alpha$ of the open and closed subsets of $X$ containing $Z$,
see Topology, Lemma \ref{topology-lemma-closed-union-connected-components}.
For each $\alpha$ we have $Z_\alpha = \Spec(A_\alpha)$ where
$A \to A_\alpha$ is a local isomorphism (a localization at an idempotent).
Setting $B = \colim A_\alpha$ proves the lemma.
\end{proof}

\begin{lemma}
\label{lemma-construct-profinite}
Let $A$ be a ring and let $X = \Spec(A)$. Let $T$ be a profinite space and
let $T \to \pi_0(X)$ be a continuous map. There exists an
ind-Zariski ring map $A \to B$ such that with $Y = \Spec(B)$ the diagram
$$
\xymatrix{
Y \ar[r] \ar[d] & \pi_0(Y) \ar[d] \\
X \ar[r] & \pi_0(X)
}
$$
is cartesian in the category of topological spaces and such that
$\pi_0(Y) = T$ as spaces over $\pi_0(X)$.
\end{lemma}

\begin{proof}
Namely, write $T = \lim T_i$ as the limit of an inverse system finite
discrete spaces over a directed set (see
Topology, Lemma \ref{topology-lemma-profinite}). For each $i$ let
$Z_i = \Im(T \to \pi_0(X) \times T_i)$. This is a closed subset.
Observe that $X \times T_i$ is the spectrum of $A_i = \prod_{t \in T_i} A$
and that $A \to A_i$ is a local isomorphism. By Lemma \ref{lemma-construct}
we see that $Z_i \subset \pi_0(X \times T_i) = \pi_0(X) \times T_i$
corresponds to a surjection $A_i \to B_i$ which is ind-Zariski
such that $\Spec(B_i) = X \times_{\pi_0(X)} Z_i$ as subsets of
$X \times T_i$. The transition maps $T_i \to T_{i'}$ induce maps
$Z_i \to Z_{i'}$ and $X \times_{\pi_0(X)} Z_i \to X \times_{\pi_0(X)} Z_{i'}$.
Hence ring maps $B_{i'} \to B_i$
(Lemmas \ref{lemma-local-isomorphism-fully-faithful} and
\ref{lemma-ind-zariski-implies}).
Set $B = \colim B_i$. Because $T = \lim Z_i$ we have
$X \times_{\pi_0(X)} T = \lim  X \times_{\pi_0(X)} Z_i$
and hence $Y = \Spec(B) = \lim \Spec(B_i)$
fits into the cartesian diagram
$$
\xymatrix{
Y \ar[r] \ar[d] & T \ar[d] \\
X \ar[r] & \pi_0(X)
}
$$
of topological spaces. By Lemma \ref{lemma-silly}
we conclude that $T = \pi_0(Y)$.
\end{proof}

\begin{example}
\label{example-construct-space}
Let $k$ be a field. Let $T$ be a profinite topological space.
There exists an ind-Zariski ring map $k \to A$ such that
$\Spec(A)$ is homeomorphic to $T$. Namely, just apply
Lemma \ref{lemma-construct-profinite} to $T \to \pi_0(\Spec(k)) = \{*\}$.
In fact, in this case we have
$$
A = \colim \text{Map}(T_i, k)
$$
whenever we write $T = \lim T_i$ as a filtered limit with each $T_i$ finite.
\end{example}

\begin{lemma}
\label{lemma-w-local-morphism-equal-points-stalks-is-iso}
Let $A \to B$ be ring map such that
\begin{enumerate}
\item $A \to B$ identifies local rings,
\item the topological spaces $\Spec(B)$, $\Spec(A)$ are w-local,
\item $\Spec(B) \to \Spec(A)$ is w-local, and
\item $\pi_0(\Spec(B)) \to \pi_0(\Spec(A))$ is bijective.
\end{enumerate}
Then $A \to B$ is an isomorphism
\end{lemma}

\begin{proof}
Let $X_0 \subset X = \Spec(A)$ and $Y_0 \subset Y = \Spec(B)$ be the
sets of closed points. By assumption $Y_0$ maps into $X_0$ and
the induced map $Y_0 \to X_0$ is a bijection.
As a space $\Spec(A)$ is the disjoint union of the spectra
of the local rings of $A$ at closed points.
Similarly for $B$. Hence $X \to Y$ is a bijection.
Since $A \to B$ is flat we have going down
(Algebra, Lemma \ref{algebra-lemma-flat-going-down}).
Thus Algebra, Lemma \ref{algebra-lemma-unique-prime-over-localize-below}
shows for any prime $\mathfrak q \subset B$ lying over
$\mathfrak p \subset A$ we have $B_\mathfrak q = B_\mathfrak p$.
Since $B_\mathfrak q = A_\mathfrak p$ by assumption, we
see that $A_\mathfrak p = B_\mathfrak p$ for all primes $\mathfrak p$
of $A$. Thus $A = B$ by
Algebra, Lemma \ref{algebra-lemma-characterize-zero-local}.
\end{proof}

\begin{lemma}
\label{lemma-w-local-morphism-equal-stalks-is-ind-zariski}
Let $A \to B$ be ring map such that
\begin{enumerate}
\item $A \to B$ identifies local rings,
\item the topological spaces $\Spec(B)$, $\Spec(A)$ are w-local, and
\item $\Spec(B) \to \Spec(A)$ is w-local.
\end{enumerate}
Then $A \to B$ is ind-Zariski.
\end{lemma}

\begin{proof}
Set $X = \Spec(A)$ and $Y = \Spec(B)$. Let $X_0 \subset X$ and
$Y_0 \subset Y$ be the set of closed points. Let $A \to A'$ be the ind-Zariski
morphism of affine schemes such that with $X' = \Spec(A')$ the diagram
$$
\xymatrix{
X' \ar[r] \ar[d] & \pi_0(X') \ar[d] \\
X \ar[r] & \pi_0(X)
}
$$
is cartesian in the category of topological spaces and such that
$\pi_0(X') = \pi_0(Y)$ as spaces over $\pi_0(X)$, see
Lemma \ref{lemma-construct-profinite}. By
Lemma \ref{lemma-silly} we see that $X'$ is w-local and
the set of closed points $X'_0 \subset X'$ is the inverse image of $X_0$.

\medskip\noindent
We obtain a continuous map $Y \to X'$ of underlying topological spaces
over $X$ identifying $\pi_0(Y)$ with $\pi_0(X')$. By
Lemma \ref{lemma-local-isomorphism-fully-faithful}
(and Lemma \ref{lemma-ind-zariski-implies})
this is corresponds to a morphism of affine schemes $Y \to X'$
over $X$. Since $Y \to X$ maps $Y_0$ into $X_0$ we see that
$Y \to X'$ maps $Y_0$ into $X'_0$, i.e., $Y \to X'$ is w-local.
By Lemma \ref{lemma-w-local-morphism-equal-points-stalks-is-iso}
we see that $Y \cong X'$ and we win.
\end{proof}

\noindent
The following proposition is a warm up for the type of result
we will prove later.

\begin{proposition}
\label{proposition-maps-wich-identify-local-rings}
Let $A \to B$ be a ring map which identifies local rings.
Then there exists a faithfully flat, ind-Zariski ring map
$B \to B'$ such that $A \to B'$ is ind-Zariski.
\end{proposition}

\begin{proof}
Let $A \to A_w$, resp. $B \to B_w$ be the faithfully flat, ind-Zariski ring
map constructed in Lemma \ref{lemma-make-w-local} for $A$, resp.\ $B$.
Since $\Spec(B_w)$ is w-local, there exists a unique factorization
$A \to A_w \to B_w$ such that $\Spec(B_w) \to \Spec(A_w)$ is w-local
by Lemma \ref{lemma-universal}. Note that $A_w \to B_w$ identifies
local rings, see
Lemma \ref{lemma-local-isomorphism-permanence}.
By Lemma \ref{lemma-w-local-morphism-equal-stalks-is-ind-zariski}
this means $A_w \to B_w$ is ind-Zariski. Since $B \to B_w$ is
faithfully flat, ind-Zariski (Lemma \ref{lemma-make-w-local})
and the composition $A \to B \to B_w$ is ind-Zariski
(Lemma \ref{lemma-composition-ind-zariski})
the proposition is proved.
\end{proof}

\noindent
The proposition above allows us to characterize the affine, weakly contractible
objects in the pro-Zariski site of an affine scheme.

\begin{lemma}
\label{lemma-w-local-extremally-disconnected}
Let $A$ be a ring. The following are equivalent
\begin{enumerate}
\item every faithfully flat ring map $A \to B$ identifying local rings
has a section,
\item every faithfully flat ind-Zariski ring map $A \to B$ has a section, and
\item $A$ satisfies
\begin{enumerate}
\item $\Spec(A)$ is w-local, and
\item $\pi_0(\Spec(A))$ is extremally disconnected.
\end{enumerate}
\end{enumerate}
\end{lemma}

\begin{proof}
The equivalence of (1) and (2) follows immediately from
Proposition \ref{proposition-maps-wich-identify-local-rings}.

\medskip\noindent
Assume (3)(a) and (3)(b). Let $A \to B$ be faithfully flat and ind-Zariski.
We will use without further mention the fact that a flat map
$A \to B$ is faithfully flat if and only if every closed point
of $\Spec(A)$ is in the image of $\Spec(B) \to \Spec(A)$
We will show that $A \to B$ has a section.

\medskip\noindent
Let $I \subset A$ be an ideal such that $V(I) \subset \Spec(A)$ is
the set of closed points of $\Spec(A)$. 
We may replace $B$ by the ring $C$ constructed in
Lemma \ref{lemma-w-local-algebraic-residue-field-extensions}
for $A \to B$ and $I \subset A$.
Thus we may assume $\Spec(B)$ is w-local such that the set of
closed points of $\Spec(B)$ is $V(IB)$.

\medskip\noindent
Assume $\Spec(B)$ is w-local and the set of closed points of $\Spec(B)$
is $V(IB)$. Choose a continuous section to the surjective
continuous map $V(IB) \to V(I)$. This is possible as
$V(I) \cong \pi_0(\Spec(A))$ is extremally disconnected, see
Topology, Proposition
\ref{topology-proposition-projective-in-category-hausdorff-qc}.
The image is a closed subspace $T \subset \pi_0(\Spec(B)) \cong V(JB)$
mapping homeomorphically onto $\pi_0(A)$. Replacing $B$ by the ind-Zariski
quotient ring constructed in Lemma \ref{lemma-construct}
we see that we may assume $\pi_0(\Spec(B)) \to \pi_0(\Spec(A))$
is bijective. At this point $A \to B$ is an isomorphism by
Lemma \ref{lemma-w-local-morphism-equal-points-stalks-is-iso}.

\medskip\noindent
Assume (1) or equivalently (2). Let $A \to A_w$ be the ring map constructed in
Lemma \ref{lemma-make-w-local}. By (1) there is a section $A_w \to A$.
Thus $\Spec(A)$ is homeomorphic to a closed subset of $\Spec(A_w)$. By
Lemma \ref{lemma-closed-subspace-w-local} we see (3)(a) holds.
Finally, let $T \to \pi_0(A)$ be a surjective map with $T$ an
extremally disconnected, quasi-compact, Hausdorff topological space
(Topology, Lemma \ref{topology-lemma-existence-projective-cover}).
Choose $A \to B$ as in Lemma \ref{lemma-construct-profinite}
adapted to $T \to \pi_0(\Spec(A))$. By (1) there is a section
$B \to A$. Thus we see that $T = \pi_0(\Spec(B)) \to \pi_0(\Spec(A))$
has a section. A formal categorical argument, using
Topology, Proposition
\ref{topology-proposition-projective-in-category-hausdorff-qc},
implies that $\pi_0(\Spec(A))$ is extremally disconnected.
\end{proof}

\begin{lemma}
\label{lemma-find-Zariski-w-contractible}
Let $A$ be a ring. There exists a faithfully flat, ind-Zariski ring
map $A \to B$ such that $B$ satisfies the equivalent conditions
of Lemma \ref{lemma-w-local-extremally-disconnected}.
\end{lemma}

\begin{proof}
We first apply Lemma \ref{lemma-make-w-local} to see that we may assume that
$\Spec(A)$ is w-local.
Choose an extremally disconnected space $T$ and a surjective
continuous map $T \to \pi_0(\Spec(A))$, see
Topology, Lemma \ref{topology-lemma-existence-projective-cover}.
Note that $T$ is profinite. Apply Lemma \ref{lemma-construct-profinite}
to find an ind-Zariski ring map $A \to B$ such that
$\pi_0(\Spec(B)) \to \pi_0(\Spec(A))$ realizes $T \to \pi_0(\Spec(A))$
and such that
$$
\xymatrix{
\Spec(B) \ar[r] \ar[d] & \pi_0(\Spec(B)) \ar[d] \\
\Spec(A) \ar[r] & \pi_0(\Spec(A))
}
$$
is cartesian in the category of topological spaces. Note that $\Spec(B)$
is w-local, that $\Spec(B) \to \Spec(A)$ is w-local, and that the
set of closed points of $\Spec(B)$ is the inverse image of the
set of closed points of $\Spec(A)$, see Lemma \ref{lemma-silly}.
Thus condition (3) of
Lemma \ref{lemma-w-local-extremally-disconnected}
holds for $B$.
\end{proof}

\begin{remark}
\label{remark-slightly-stronger}
In each of Lemmas \ref{lemma-construct}, \ref{lemma-construct-profinite},
Proposition \ref{proposition-maps-wich-identify-local-rings}, and
Lemma \ref{lemma-find-Zariski-w-contractible} we find an ind-Zariski ring
map with some properties. In the paper \cite{BS} the authors use the notion
of an ind-(Zariski localization) which is a filtered colimit of finite
products of principal localizations. It is possible to replace ind-Zariski
by ind-(Zariski localization) in each of the results listed above.
However, we do not need this and the notion of an ind-Zariski homomorphism
of rings as defined here has slightly better formal properties. Moreover,
the notion of an ind-Zariski ring map is the natural analogue of the
notion of an ind-\'etale ring map defined in the next section.
\end{remark}




\section{Ind-\'etale algebra}
\label{section-ind-etale}

\noindent
We start with a definition.

\begin{definition}
\label{definition-ind-etale}
A ring map $A \to B$ is said to be {\it ind-\'etale} if $B$ can be written
as a filtered colimit of \'etale $A$-algebras.
\end{definition}

\noindent
The category of ind-\'etale algebras is closed under a number of natural
operations.

\begin{lemma}
\label{lemma-base-change-ind-etale}
Let $A \to B$ and $A \to A'$ be ring maps. Let $B' = B \otimes_A A'$
be the base change of $B$.
If $A \to B$ is ind-\'etale, then $A' \to B'$ is ind-\'etale.
\end{lemma}

\begin{proof}
This is Algebra, Lemma \ref{algebra-lemma-base-change-colimit-etale}.
\end{proof}

\begin{lemma}
\label{lemma-composition-ind-etale}
Let $A \to B$ and $B \to C$ be ring maps. If $A \to B$ and $B \to C$
are ind-\'etale, then $A \to C$ is ind-\'etale.
\end{lemma}

\begin{proof}
This is Algebra, Lemma \ref{algebra-lemma-composition-colimit-etale}.
\end{proof}

\begin{lemma}
\label{lemma-ind-ind-etale}
A filtered colimit of ind-\'etale $A$-algebras is ind-\'etale over $A$.
\end{lemma}

\begin{proof}
This is Algebra, Lemma \ref{algebra-lemma-colimit-colimit-etale}.
\end{proof}

\begin{lemma}
\label{lemma-ind-etale-permanence}
Let $A$ be a ring. Let $B \to C$ be an $A$-algebra map of ind-\'etale
$A$-algebras. Then $C$ is an ind-\'etale $B$-algebra.
\end{lemma}

\begin{proof}
This is Algebra, Lemma \ref{algebra-lemma-colimits-of-etale}.
\end{proof}

\begin{lemma}
\label{lemma-ind-etale-implies}
Let $A \to B$ be ind-\'etale. Then $A \to B$ is weakly \'etale
(More on Algebra, Definition \ref{more-algebra-definition-weakly-etale}).
\end{lemma}

\begin{proof}
This follows from More on Algebra, Lemma
\ref{more-algebra-lemma-when-weakly-etale}.
\end{proof}

\begin{lemma}
\label{lemma-lift-ind-etale}
Let $A$ be a ring and let $I \subset A$ be an ideal. The base change functor
$$
\text{ind-\'etale }A\text{-algebras}
\longrightarrow
\text{ind-\'etale }A/I\text{-algebras},\quad
C \longmapsto C/IC
$$
has a fully faithful right adjoint $v$. In particular, given
an ind-\'etale $A/I$-algebra $\overline{C}$ there exists
an ind-\'etale $A$-algebra $C = v(\overline{C})$ such that
$\overline{C} = C/IC$.
\end{lemma}

\begin{proof}
Let $\overline{C}$ be an ind-\'etale $A/I$-algebra.
Consider the category $\mathcal{C}$ of factorizations
$A \to B \to \overline{C}$ where $A \to B$ is \'etale.
(We ignore some set theoretical issues in this proof.)
We will show that this category is directed and that
$C = \colim_\mathcal{C} B$ is an ind-\'etale $A$-algebra
such that $\overline{C} = C/IC$.

\medskip\noindent
We first prove that $\mathcal{C}$ is directed
(Categories, Definition \ref{categories-definition-directed}).
The category is nonempty as $A \to A \to \overline{C}$ is an object.
Suppose that $A \to B \to \overline{C}$ and $A \to B' \to \overline{C}$
are two objects of $\mathcal{C}$. Then $A \to B \otimes_A B' \to \overline{C}$
is another (use Algebra, Lemma \ref{algebra-lemma-etale}).
Suppose that $f, g : B \to B'$ are two maps between
objects $A \to B \to \overline{C}$ and $A \to B' \to \overline{C}$
of $\mathcal{C}$. Then a coequalizer is
$A \to B' \otimes_{f, B, g} B' \to \overline{C}$.
This is an object of $\mathcal{C}$ by
Algebra, Lemmas \ref{algebra-lemma-etale} and
\ref{algebra-lemma-map-between-etale}.
Thus the category $\mathcal{C}$ is directed.

\medskip\noindent
Write $\overline{C} = \colim \overline{B_i}$ as a filtered colimit with
$\overline{B_i}$ \'etale over $A/I$. For every $i$
there exists $A \to B_i$ \'etale with $\overline{B_i} = B_i/IB_i$, see
Algebra, Lemma \ref{algebra-lemma-lift-etale}.
Thus $C \to \overline{C}$ is surjective.
Since $C/IC \to \overline{C}$ is ind-\'etale
(Lemma \ref{lemma-ind-etale-permanence})
we see that it is flat. Hence $\overline{C}$ is a localization of
$C/IC$ at some multiplicative subset $S \subset C/IC$
(Algebra, Lemma \ref{algebra-lemma-pure}).
Take an $f \in C$ mapping to an element of $S \subset C/IC$.
Choose $A \to B \to \overline{C}$ in $\mathcal{C}$ and $g \in B$
mapping to $f$ in the colimit. Then we see that $A \to B_g \to \overline{C}$
is an object of $\mathcal{C}$ as well. Thus $f$ is an invertible
element of $C$. It follows that $C/IC = \overline{C}$.

\medskip\noindent
Next, we claim that for an ind-\'etale algebra $D$ over $A$ we have
$$
\Mor_A(D, C) = \Mor_{A/I}(D/ID, \overline{C})
$$
Namely, let $D/ID \to \overline{C}$ be an $A/I$-algebra map.
Write $D = \colim_{i \in I} D_i$ as a colimit over a directed set $I$
with $D_i$ \'etale over $A$. By choice of $\mathcal{C}$
we obtain a transformation $I \to \mathcal{C}$ and hence a map
$D \to C$ compatible with maps to $\overline{C}$. Whence the claim.

\medskip\noindent
It follows that the functor $v$ defined by the rule
$$
\overline{C} 
\longmapsto
v(\overline{C}) = \colim_{A \to B \to \overline{C}} B
$$
is a right adjoint to the base change functor $u$ as required by the lemma.
The functor $v$ is fully faithful because
$u \circ v = \text{id}$ by construction, see
Categories, Lemma \ref{categories-lemma-adjoint-fully-faithful}.
\end{proof}









\section{Constructing ind-\'etale algebras}
\label{section-construction-ind-etale}

\noindent
Let $A$ be a ring. Recall that any \'etale ring map $A \to B$ is isomorphic
to a standard smooth ring map of relative dimension $0$. Such a ring map
is of the form
$$
A \longrightarrow A[x_1, \ldots, x_n]/(f_1, \ldots, f_n)
$$
where the determinant of the $n \times n$-matrix with entries
$\partial f_i/\partial x_j$ is invertible in the quotient ring. See
Algebra, Lemma \ref{algebra-lemma-etale-standard-smooth}.

\medskip\noindent
Let $S(A)$ be the set of all {\it faithfully flat}\footnote{In the presence
of flatness, e.g., for smooth or \'etale ring maps,
this just means that the induced map on spectra is surjective. See
Algebra, Lemma \ref{algebra-lemma-ff-rings}.}
standard smooth $A$-algebras of relative dimension $0$.
Let $I(A)$ be the partially ordered (by inclusion) set of finite
subsets $E$ of $S(A)$. Note that $I(A)$ is a directed partially
ordered set. For $E = \{A \to B_1, \ldots, A \to B_n\}$ set
$$
B_E = B_1 \otimes_A \ldots \otimes_A B_n
$$
Observe that $B_E$ is a faithfully flat \'etale $A$-algebra.
For $E \subset E'$, there is a canonical transition map $B_E \to B_{E'}$
of \'etale $A$-algebras. Namely, say $E = \{A \to B_1, \ldots, A \to B_n\}$
and $E' = \{A \to B_1, \ldots, A \to B_{n + m}\}$ then
$B_E \to B_{E'}$ sends $b_1 \otimes \ldots \otimes b_n$ to the
element $b_1 \otimes \ldots \otimes b_n \otimes 1 \otimes \ldots \otimes 1$
of $B_{E'}$. This construction defines a system of faithfully flat
\'etale $A$-algebras over $I(A)$ and we set
$$
T(A) = \colim_{E \in I(A)} B_E
$$
Observe that $T(A)$ is a faithfully flat ind-\'etale $A$-algebra
(Algebra, Lemma \ref{algebra-lemma-colimit-faithfully-flat}). By construction
given any faithfully flat \'etale $A$-algebra $B$ there is a (non-unique)
$A$-algebra map $B \to T(A)$. Namely, pick some $(A \to B_0) \in S(A)$
and an isomorphism $B \cong B_0$. Then the canonical coprojection
$$
B \to B_0 \to 
T(A) = \colim_{E \in I(A)} B_E
$$
is the desired map.

\begin{lemma}
\label{lemma-first-construction}
Given a ring $A$ there exists a faithfully flat ind-\'etale $A$-algebra $C$
such that every faithfully flat \'etale ring map $C \to B$ has a section.
\end{lemma}

\begin{proof}
Set $T^1(A) = T(A)$ and $T^{n + 1}(A) = T(T^n(A))$. Let
$$
C = \colim T^n(A)
$$
This algebra is faithfully flat over each $T^n(A)$ and in particular
over $A$, see
Algebra, Lemma \ref{algebra-lemma-colimit-faithfully-flat}.
Moreover, $C$ is ind-\'etale over $A$ by Lemma \ref{lemma-ind-ind-etale}.
If $C \to B$ is \'etale, then there exists an $n$ and an \'etale
ring map $T^n(A) \to B'$ such that $B = C \otimes_{T^n(A)} B'$, see
Algebra, Lemma \ref{algebra-lemma-etale}.
If $C \to B$ is faithfully flat, then $\Spec(B) \to \Spec(C) \to \Spec(T^n(A))$
is surjective, hence $\Spec(B') \to \Spec(T^n(A))$ is surjective.
In other words, $T^n(A) \to B'$ is faithfully flat.
By our construction, there is a $T^n(A)$-algebra map
$B' \to T^{n + 1}(A)$. This induces a $C$-algebra map $B \to C$
which finishes the proof.
\end{proof}

\begin{remark}
\label{remark-size-T}
Let $A$ be a ring. Let $\kappa$ be an infinite cardinal bigger or
equal than the cardinality of $A$. Then the cardinality of $T(A)$
is at most $\kappa$. Namely, each $B_E$ has cardinality at most
$\kappa$ and the index set $I(A)$ has cardinality at most $\kappa$
as well. Thus the result follows as $\kappa \otimes \kappa = \kappa$, see
Sets, Section \ref{sets-section-cardinals}. It follows that the
ring constructed in the proof of Lemma \ref{lemma-first-construction}
has cardinality at most $\kappa$ as well.
\end{remark}

\begin{remark}
\label{remark-first-construction-functorial}
The construction $A \mapsto T(A)$ is functorial in the following sense:
If $A \to A'$ is a ring map, then we can construct a commutative diagram
$$
\xymatrix{
A \ar[r] \ar[d] & T(A) \ar[d] \\
A' \ar[r] & T(A')
}
$$
Namely, given $(A \to A[x_1, \ldots, x_n]/(f_1, \ldots, f_n))$ in
$S(A)$ we can use the ring map $\varphi : A \to A'$ to obtain a corresponding
element $(A' \to A'[x_1, \ldots, x_n]/(f^\varphi_1, \ldots, f^\varphi_n))$
of $S(A')$ where $f^\varphi$ means the polynomial obtained by applying
$\varphi$ to the coefficients of the polynomial $f$.
Moreover, there is a commutative diagram
$$
\xymatrix{
A \ar[r] \ar[d] & A[x_1, \ldots, x_n]/(f_1, \ldots, f_n) \ar[d] \\
A' \ar[r] & A'[x_1, \ldots, x_n]/(f^\varphi_1, \ldots, f^\varphi_n)
}
$$
which is a in the category of rings. For $E \subset S(A)$ finite, set
$E' = \varphi(E)$ and define $B_E \to B_{E'}$ in the obvious manner.
Taking the colimit gives the desired map $T(A) \to T(A')$, see
Categories, Lemma \ref{categories-lemma-functorial-colimit}.
\end{remark}

\begin{lemma}
\label{lemma-have-sections-quotient}
Let $A$ be a ring such that every faithfully flat \'etale ring map
$A \to B$ has a section. Then the same is true for every quotient ring
$A/I$.
\end{lemma}

\begin{proof}
Omitted.
\end{proof}

\begin{lemma}
\label{lemma-have-sections-strictly-henselian}
Let $A$ be a ring such that every faithfully flat \'etale ring map
$A \to B$ has a section. Then every local ring of $A$ at a maximal
ideal is strictly henselian.
\end{lemma}

\begin{proof}
Let $\mathfrak m$ be a maximal ideal of $A$. Let $A \to B$ be an
\'etale ring map and let $\mathfrak q \subset B$ be a prime
lying over $\mathfrak m$. By the description of the strict henselization
$A_\mathfrak m^{sh}$ in
Algebra, Lemma \ref{algebra-lemma-strict-henselization-different}
it suffices to show that $A_\mathfrak m = B_\mathfrak q$.
Note that there are finitely many primes
$\mathfrak q = \mathfrak q_1, \mathfrak q_2, \ldots, \mathfrak q_n$
lying over $\mathfrak m$ and there are no specializations
between them as an \'etale ring map is quasi-finite, see
Algebra, Lemma \ref{algebra-lemma-etale-quasi-finite}.
Thus $\mathfrak q_i$ is a maximal ideal and we can find
$g \in \mathfrak q_2 \cap \ldots \cap \mathfrak q_n$, $g \not \in \mathfrak q$
(Algebra, Lemma \ref{algebra-lemma-silly}).
After replacing $B$ by $B_g$ we see that $\mathfrak q$
is the only prime of $B$ lying over $\mathfrak m$.
The image $U \subset \Spec(A)$ of $\Spec(B) \to \Spec(A)$ is
open (Algebra, Proposition \ref{algebra-proposition-fppf-open}).
Thus the complement $\Spec(A) \setminus U$ is closed
and we can find $f \in A$, $f \not \in \mathfrak p$ such that
$\Spec(A) = U \cup D(f)$. The ring map $A \to B \times A_f$
is faithfully flat and \'etale, hence has a section
$\sigma : B \times A_f \to A$ by assumption on $A$.
Observe that $\sigma$ is \'etale, hence flat as a map between \'etale
$A$-algebras (Algebra, Lemma \ref{algebra-lemma-map-between-etale}).
Since $\mathfrak q$ is the only prime of $B \times A_f$ lying
over $A$ we find that $A_\mathfrak p \to B_\mathfrak q$ has
a section which is also flat. Thus
$A_\mathfrak p \to B_\mathfrak q \to A_\mathfrak p$
are flat local ring maps whose composition is the identity. Since
a flat local homomorphism of local rings is injective we conclude these
maps are isomorphisms as desired.
\end{proof}

\begin{lemma}
\label{lemma-have-sections-localize}
Let $A$ be a ring such that every faithfully flat \'etale ring map
$A \to B$ has a section. Let $Z \subset \Spec(A)$ be a closed subscheme
of the form $D(f) \cap V(I)$ and let $A \to A_Z^\sim$ be as constructed
in Lemma \ref{lemma-localization}.
Then every faithfully flat \'etale ring map $A_Z^\sim \to C$ has
a section.
\end{lemma}

\begin{proof}
There exists an \'etale ring map $A \to B'$ such that
$C = B' \otimes_A A_Z^\sim$ as $A_Z^\sim$-algebras.
The image $U' \subset \Spec(A)$ of $\Spec(B') \to \Spec(A)$
is open and contains $V(I)$, hence we can find $f \in I$ such
that $\Spec(A) = U' \cup D(f)$. Then $A \to B' \times A_f$
is \'etale and faithfully flat. By assumption there is a section
$B' \times A_f \to A$. Localizing we obtain the desired section
$C \to A_Z^\sim$.
\end{proof}

\begin{lemma}
\label{lemma-get-w-local-algebraic-residue-field-extensions}
Let $A \to B$ be a ring map inducing algebraic extensions on residue fields.
There exists a commutative diagram
$$
\xymatrix{
B \ar[r] & D \\
A \ar[r] \ar[u] & C \ar[u]
}
$$
with the following properties:
\begin{enumerate}
\item $A \to C$ is faithfully flat and ind-\'etale,
\item $B \to D$ is faithfully flat and ind-\'etale,
\item $\Spec(C)$ is w-local,
\item $\Spec(D)$ is w-local,
\item $\Spec(D) \to \Spec(C)$ is w-local,
\item the set of closed points of $\Spec(D)$ is the inverse image
of the set of closed points of $\Spec(C)$,
\item the set of closed points of $\Spec(C)$ surjects onto $\Spec(A)$,
\item the set of closed points of $\Spec(D)$ surjects onto $\Spec(B)$,
\item for $\mathfrak m \subset C$ maximal the local ring
$C_\mathfrak m$ is strictly henselian.
\end{enumerate}
\end{lemma}

\begin{proof}
There is a faithfully flat, ind-Zariski ring map $A \to A'$ such that
$\Spec(A')$ is w-local and such that the set of closed points of
$\Spec(A')$ maps onto $\Spec(A)$, see Lemma \ref{lemma-make-w-local}.
Let $I \subset A'$ be the ideal such that $V(I)$ is the set
of closed points of $\Spec(A')$.
Choose $A' \to C'$ as in Lemma \ref{lemma-first-construction}.
Note that the local rings $C'_{\mathfrak m'}$ at maximal ideals
$\mathfrak m' \subset C'$ are strictly henselian by
Lemma \ref{lemma-have-sections-strictly-henselian}.
We apply Lemma \ref{lemma-w-local-algebraic-residue-field-extensions}
to $A' \to C'$ and $I \subset A'$ to get $C' \to C$ with $C'/IC' \cong C/IC$.
Note that since $A' \to C'$ is faithfully flat, $\Spec(C'/IC')$
surjects onto the set of closed points of $A'$ and in particular
onto $\Spec(A)$. Moreover, as $V(IC) \subset \Spec(C)$
is the set of closed points of $C$ and $C' \to C$ is ind-Zariski
(and identifies local rings) we obtain properties (1), (3), (7), and (9).

\medskip\noindent
Denote $J \subset C$ the ideal such that $V(J)$ is the set of closed
points of $\Spec(C)$. Set $D' = B \otimes_A C$. The ring
map $C \to D'$ induces algebraic residue field extensions. Keep in mind that
since $V(J) \to \Spec(A)$ is surjective the map $T = V(JD) \to \Spec(B)$
is surjective too. Apply
Lemma \ref{lemma-w-local-algebraic-residue-field-extensions}
to $C \to D'$ and $J \subset C$ to get 
$D' \to D$ with $D'/JD' \cong D/JD$.
All of the remaining properties given in the lemma are
immediate from the results of
Lemma \ref{lemma-w-local-algebraic-residue-field-extensions}.
\end{proof}








\section{Weakly \'etale versus pro-\'etale}
\label{section-weakly-etale}

\noindent
Recall that a ring homomorphism $A \to B$ is {\it weakly \'etale}
if $A \to B$ is flat and $B \otimes_A B \to B$ is flat. We have
proved some properties of such ring maps in
More on Algebra, Section \ref{more-algebra-section-weakly-etale}.
In particular, if $A \to B$ is a local homomorphism, and $A$ is a
strictly henselian local rings, then $A = B$, see
More on Algebra, Theorem \ref{more-algebra-theorem-olivier}.
Using this theorem and the work we've done above we obtain
the following structure theorem for weakly \'etale ring maps.

\begin{proposition}
\label{proposition-weakly-etale}
Let $A \to B$ be a weakly \'etale ring map.
Then there exists a faithfully flat, ind-\'etale ring map
$B \to B'$ such that $A \to B'$ is ind-\'etale.
\end{proposition}

\begin{proof}
The ring map $A \to B$ induces (separable) algebraic extensions of
residue fields, see More on Algebra, Lemma
\ref{more-algebra-lemma-weakly-etale-residue-field-extensions}.
Thus we may apply
Lemma \ref{lemma-get-w-local-algebraic-residue-field-extensions}
and choose a diagram
$$
\xymatrix{
B \ar[r] & D \\
A \ar[r] \ar[u] & C \ar[u]
}
$$
with the properties as listed in the lemma. Note that $C \to D$
is weakly \'etale by
More on Algebra, Lemma \ref{more-algebra-lemma-weakly-etale-permanence}.
Pick a maximal ideal $\mathfrak m \subset D$. By construction
this lies over a maximal ideal $\mathfrak m' \subset C$.
By More on Algebra, Theorem \ref{more-algebra-theorem-olivier}
the ring map $C_{\mathfrak m'} \to D_\mathfrak m$ is an isomorphism.
As every point of $\Spec(C)$ specializes to a closed point we conclude that
$C \to D$ identifies local rings.
Thus Proposition \ref{proposition-maps-wich-identify-local-rings}
applies to the ring map $C \to D$. Pick $D \to D'$ faithfully flat
and ind-Zariski such that $C \to D'$ is ind-Zariski. Then
$B \to D'$ is a solution to the problem posed in the proposition.
\end{proof}








\section{Constructing w-contractible covers}
\label{section-w-contractible}

\noindent
In this section we construct w-contractible covers of affine schemes.

\begin{definition}
\label{definition-w-contractible}
Let $A$ be a ring. We say $A$ is {\it w-contractible} if every
faithfully flat weakly-etale ring map $A \to B$ has a section.
\end{definition}

\noindent
We remark that by Proposition \ref{proposition-weakly-etale}
an equivalent definition would be to ask that every faithfully
flat, ind-\'etale ring map $A \to B$ has a section.
Here is a key observation that will allow us to construct
w-contractible rings.

\begin{lemma}
\label{lemma-w-local-strictly-henselian-extremally-disconnected}
Let $A$ be a ring. The following are equivalent
\begin{enumerate}
\item $A$ is w-contractible,
\item every faithfully flat, ind-\'etale ring map $A \to B$ has
a section, and
\item $A$ satisfies
\begin{enumerate}
\item $\Spec(A)$ is w-local,
\item $\pi_0(\Spec(A))$ is extremally disconnected, and
\item for every maximal ideal $\mathfrak m \subset A$ the
local ring $A_\mathfrak m$ is strictly henselian.
\end{enumerate}
\end{enumerate}
\end{lemma}

\begin{proof}
The equivalence of (1) and (2) follows immediately from
Proposition \ref{proposition-weakly-etale}.

\medskip\noindent
Assume (3)(a), (3)(b), and (3)(c). Let $A \to B$ be faithfully flat
and ind-\'etale. We will use without further mention the fact that a flat map
$A \to B$ is faithfully flat if and only if every closed point
of $\Spec(A)$ is in the image of $\Spec(B) \to \Spec(A)$
We will show that $A \to B$ has a section.

\medskip\noindent
Let $I \subset A$ be an ideal such that $V(I) \subset \Spec(A)$ is
the set of closed points of $\Spec(A)$. 
We may replace $B$ by the ring $C$ constructed in
Lemma \ref{lemma-w-local-algebraic-residue-field-extensions}
for $A \to B$ and $I \subset A$.
Thus we may assume $\Spec(B)$ is w-local such that the set of
closed points of $\Spec(B)$ is $V(IB)$. In this case $A \to B$
identifies local rings by condition (3)(c) as it suffices to check
this at maximal ideals of $B$ which lie over maximal ideals of $A$.
Thus $A \to B$ has a section by
Lemma \ref{lemma-w-local-extremally-disconnected}.

\medskip\noindent
Assume (1) or equivalently (2). We have (3)(c) by
Lemma \ref{lemma-have-sections-strictly-henselian}.
Properties (3)(a) and (3)(b) follow from
Lemma \ref{lemma-w-local-extremally-disconnected}.
\end{proof}

\begin{proposition}
\label{proposition-find-w-contractible}
For every ring $A$ there exists a faithfully flat, ind-\'etale ring
map $A \to D$ such that $D$ is w-contractible.
\end{proposition}

\begin{proof}
Applying Lemma \ref{lemma-get-w-local-algebraic-residue-field-extensions}
to $\text{id}_A : A \to A$ we find a faithfully flat, ind-\'etale ring map
$A \to C$ such that $C$ is w-local and such that every local ring at a
maximal ideal of $C$ is strictly henselian.
Choose an extremally disconnected space $T$ and a surjective
continuous map $T \to \pi_0(\Spec(C))$, see
Topology, Lemma \ref{topology-lemma-existence-projective-cover}.
Note that $T$ is profinite. Apply Lemma \ref{lemma-construct-profinite}
to find an ind-Zariski ring map $C \to D$ such that
$\pi_0(\Spec(D)) \to \pi_0(\Spec(C))$ realizes $T \to \pi_0(\Spec(C))$
and such that
$$
\xymatrix{
\Spec(D) \ar[r] \ar[d] & \pi_0(\Spec(D)) \ar[d] \\
\Spec(C) \ar[r] & \pi_0(\Spec(C))
}
$$
is cartesian in the category of topological spaces. Note that $\Spec(D)$
is w-local, that $\Spec(D) \to \Spec(C)$ is w-local, and that the
set of closed points of $\Spec(D)$ is the inverse image of the
set of closed points of $\Spec(C)$, see Lemma \ref{lemma-silly}.
Thus it is still true that the local rings of $D$ at its maximal
ideals are strictly henselian (as they are isomorphic to the
local rings at the corresponding maximal ideals of $C$).
It follows from
Lemma \ref{lemma-w-local-strictly-henselian-extremally-disconnected}
that $D$ is w-contractible.
\end{proof}

\begin{remark}
\label{remark-size-w-contractible}
Let $A$ be a ring. Let $\kappa$ be an infinite cardinal bigger or
equal than the cardinality of $A$. Then the cardinality of the
ring $D$ constructed in Proposition \ref{proposition-find-w-contractible}
is at most
$$
\kappa^{2^{2^{2^\kappa}}}.
$$
Namely, the ring map $A \to D$ is
constructed as a composition
$$
A \to A_w = A' \to C' \to C \to D.
$$
Here the first three steps of the construction are carried out
in the first paragraph of the proof of
Lemma \ref{lemma-get-w-local-algebraic-residue-field-extensions}.
For the first step we have $|A_w| \leq \kappa$ by
Remark \ref{remark-size-w}.
We have $|C'| \leq \kappa$ by
Remark \ref{remark-size-T}.
Then $|C| \leq \kappa$ because $C$ is a localization of $(C')_w$
(it is constructed from $C'$ by an application of
Lemma \ref{lemma-localize-along-closed-profinite}
in the proof of Lemma \ref{lemma-w-local-algebraic-residue-field-extensions}).
Thus $C$ has at most $2^\kappa$ maximal ideals.
Finally, the ring map $C \to D$ identifies local rings and the
cardinality of the set of maximal ideals of $D$ is at most
$2^{2^{2^\kappa}}$ by
Topology, Remark \ref{topology-remark-size-projective-cover}.
Since $D \subset \prod_{\mathfrak m \subset D} D_\mathfrak m$ we see
that $D$ has at most the size displayed above.
\end{remark}

\begin{lemma}
\label{lemma-finite-finitely-presented-over-extremally-disconnected}
Let $A \to B$ be a quasi-finite and finitely presented ring map.
If the residue fields of $A$ are separably algebraically closed
and $\Spec(A)$ is extremally disconnected, then $\Spec(B)$ is
extremally disconnected.
\end{lemma}

\begin{proof}
Set $X = \Spec(A)$ and $Y = \Spec(B)$. Choose a finite partition
$X = \coprod X_i$ and $X'_i \to X_i$ as in
\'Etale Cohomology, Lemma
\ref{etale-cohomology-lemma-decompose-quasi-finite-morphism}.
Because $X$ is extremally disconnected, every constructible
locally closed subset is open and closed, hence we see that $X$
is topologically the disjoint union of the strata $X_i$. Thus we may
replace $X$ by the $X_i$ and assume there exists a surjective finite
locally free morphism $X' \to X$ such that $(X' \times_X Y)_{red}$
is isomorphic to a finite disjoint union of copies of $X'_{red}$.
Picture
$$
\xymatrix{
\coprod_{i = 1, \ldots, r} X' \ar[r] \ar[d] & Y \ar[d] \\
X' \ar[r] & X
}
$$
The assumption on the residue fields of $A$ implies that
this diagram is a fibre product diagram on underlying sets
of points (details omitted).
Since $X$ is extremally disconnected and $X'$ is Hausdorff
(Lemma \ref{lemma-profinite-goes-up}), the continuous map
$X' \to X$ has a continuous section $\sigma$. Then
$\coprod_{i = 1, \ldots, r} \sigma(X) \to Y$ is a bijective
continuous map. By
Topology, Lemma \ref{topology-lemma-bijective-map}
we see that it is a homeomorphism and the proof is done.
\end{proof}

\begin{lemma}
\label{lemma-finite-finitely-presented-over-w-contractible}
Let $A \to B$ be a finite and finitely presented ring map.
If $A$ is w-contractible, so is $B$.
\end{lemma}

\begin{proof}
We will use the criterion of
Lemma \ref{lemma-w-local-strictly-henselian-extremally-disconnected}.
Set $X = \Spec(A)$ and $Y = \Spec(B)$.
As $Y \to X$ is a finite morphism, we see that the set of closed
points $Y_0$ of $Y$ is the inverse image of the set of closed points
$X_0$ of $X$. Moreover, every point of $Y$ specializes to a unique
point of $Y_0$ as (a) this is true for $X$ and (b) the map
$X \to Y$ is separated. For every $y \in Y_0$ with image $x \in X_0$
we see that $\mathcal{O}_{Y, y}$ is strictly henselian by
Algebra, Lemma \ref{algebra-lemma-finite-over-henselian}
applied to $\mathcal{O}_{X, x} \to B \otimes_A \mathcal{O}_{X, x}$.
It remains to show that $Y_0$ is extremally disconnected.
To do this we look at $X_0 \times_X Y \to X_0$
where $X_0 \subset X$ is the reduced induced scheme structure.
Note that the underlying topological space of
$X_0 \times_X Y$ agrees with $Y_0$. Now the desired result follows from
Lemma \ref{lemma-finite-finitely-presented-over-extremally-disconnected}.
\end{proof}

\begin{lemma}
\label{lemma-localization-w-contractible}
Let $A$ be a ring. Let $Z \subset \Spec(A)$ be a closed subset
of the form $Z = V(f_1, \ldots, f_r)$. Set $B = A_Z^\sim$, see
Lemma \ref{lemma-localization}. If $A$ is w-contractible, so is $B$.
\end{lemma}

\begin{proof}
Let $A_Z^\sim \to B$ be a weakly \'etale faithfully flat ring map.
Consider the ring map
$$
A \longrightarrow A_{f_1} \times \ldots \times A_{f_r} \times B
$$
this is faithful flat and weakly \'etale. If $A$ is w-contractible,
then there is a section $\sigma$. Consider the morphism
$$
\Spec(A_Z^\sim) \to \Spec(A) \xrightarrow{\Spec(\sigma)}
\coprod \Spec(A_{f_i}) \amalg \Spec(B)
$$
Every point of $Z \subset \Spec(A_Z^\sim)$ maps into the component
$\Spec(B)$. Since every point of $\Spec(A_Z^\sim)$ specializes to a
point of $Z$ we find a morphism $\Spec(A_Z^\sim) \to \Spec(B)$
as desired.
\end{proof}






\section{The pro-\'etale site}
\label{section-proetale}

\noindent
The (small) pro-\'etale site of a scheme has some remarkable properties.
In particular, it has enough w-contractible objects which implies
a number of useful consequences for the derived category
of abelian sheaves and for inverse systems of sheaves. Thus it is
well adapted to deal with some of the intricacies of working
with $\ell$-adic sheaves.

\medskip\noindent
On the other hand, the pro-\'etale topology is a bit like
the fpqc topology (see Topologies, Section \ref{topologies-section-fpqc})
in that the topos of sheaves on the small pro-\'etale site of a scheme
depends on the choice of the underlying category of schemes. Thus we cannot
speak of {\it the} pro-\'etale topos of a scheme. However, it will be
true that the cohomology groups of a sheaf are unchanged if we enlarge
our underlying category of schemes.

\medskip\noindent
Another curiosity is that we define pro-\'etale coverings using weakly
\'etale morphisms of schemes, see
More on Morphisms, Section \ref{more-morphisms-section-weakly-etale}.
The reason is that, on the one hand, it is somewhat awkward to define
the notion of a pro-\'etale morphism of schemes, and on the other,
Proposition \ref{proposition-weakly-etale}
assures us that we obtain the same sheaves with the
definition that follows.

\begin{definition}
\label{definition-fpqc-covering}
Let $T$ be a scheme. A {\it pro-\'etale covering of $T$} is a family
of morphisms $\{f_i : T_i \to T\}_{i \in I}$ of schemes
such that each $f_i$ is weakly-\'etale and such that for every affine open
$U \subset T$ there exists $n \geq 0$, a map
$a : \{1, \ldots, n\} \to I$ and affine opens
$V_j \subset T_{a(j)}$, $j = 1, \ldots, n$
with $\bigcup_{j = 1}^n f_{a(j)}(V_j) = U$.
\end{definition}

\noindent
To be sure this condition implies that $T = \bigcup f_i(T_i)$.
Here is a lemma that will allow us to recognize pro-\'etale coverings.
It will also allow us to reduce many lemmas about pro-\'etale coverings
to the corresponding results for fpqc coverings.

\begin{lemma}
\label{lemma-recognize-proetale-covering}
Let $T$ be a scheme. Let $\{f_i : T_i \to T\}_{i \in I}$ be a family of
morphisms of schemes with target $T$. The following are equivalent
\begin{enumerate}
\item $\{f_i : T_i \to T\}_{i \in I}$ is a pro-\'etale covering,
\item each $f_i$ is weakly \'etale and $\{f_i : T_i \to T\}_{i \in I}$
is an fpqc covering,
\item each $f_i$ is weakly \'etale and for every affine open $U \subset T$
there exist quasi-compact opens $U_i \subset T_i$ which are almost all empty,
such that $U = \bigcup f_i(U_i)$,
\item each $f_i$ is weakly \'etale and there exists an affine open covering
$T = \bigcup_{\alpha \in A} U_\alpha$ and for each $\alpha \in A$
there exist $i_{\alpha, 1}, \ldots, i_{\alpha, n(\alpha)} \in I$
and quasi-compact opens $U_{\alpha, j} \subset T_{i_{\alpha, j}}$ such that
$U_\alpha =
\bigcup_{j = 1, \ldots, n(\alpha)} f_{i_{\alpha, j}}(U_{\alpha, j})$.
\end{enumerate}
If $T$ is quasi-separated, these are also equivalent to
\begin{enumerate}
\item[(5)] each $f_i$ is weakly \'etale, and for every $t \in T$ there exist
$i_1, \ldots, i_n \in I$ and quasi-compact opens $U_j \subset T_{i_j}$
such that $\bigcup_{j = 1, \ldots, n} f_{i_j}(U_j)$ is a
(not necessarily open) neighbourhood of $t$ in $T$.
\end{enumerate}
\end{lemma}

\begin{proof}
The equivalence of (1) and (2) is immediate from the definitions.
Hence the lemma follows from
Topologies, Lemma \ref{topologies-lemma-recognize-fpqc-covering}.
\end{proof}

\begin{lemma}
\label{lemma-etale-proetale}
Any \'etale covering and any Zariski covering is a pro-\'etale covering.
\end{lemma}

\begin{proof}
This follows from the corresponding result for fpqc coverings
(Topologies, Lemma
\ref{topologies-lemma-zariski-etale-smooth-syntomic-fppf-fpqc}),
Lemma \ref{lemma-recognize-proetale-covering}, and
the fact that an \'etale morphism is a weakly \'etale morphism, see
More on Morphisms, Lemma \ref{more-morphisms-lemma-when-weakly-etale}.
\end{proof}

\begin{lemma}
\label{lemma-proetale}
Let $T$ be a scheme.
\begin{enumerate}
\item If $T' \to T$ is an isomorphism then $\{T' \to T\}$
is a pro-\'etale covering of $T$.
\item If $\{T_i \to T\}_{i\in I}$ is a pro-\'etale covering and for each
$i$ we have a pro-\'etale covering $\{T_{ij} \to T_i\}_{j\in J_i}$, then
$\{T_{ij} \to T\}_{i \in I, j\in J_i}$ is a pro-\'etale covering.
\item If $\{T_i \to T\}_{i\in I}$ is a pro-\'etale covering
and $T' \to T$ is a morphism of schemes then
$\{T' \times_T T_i \to T'\}_{i\in I}$ is a pro-\'etale covering.
\end{enumerate}
\end{lemma}

\begin{proof}
This follows from the fact that composition and base changes
of weakly \'etale morphisms are weakly \'etale
(More on Morphisms, Lemmas
\ref{more-morphisms-lemma-composition-weakly-etale} and
\ref{more-morphisms-lemma-base-change-weakly-etale}),
Lemma \ref{lemma-recognize-proetale-covering}, and
the corresponding results for fpqc coverings, see
Topologies, Lemma \ref{topologies-lemma-fpqc}.
\end{proof}

\begin{lemma}
\label{lemma-proetale-affine}
Let $T$ be an affine scheme. Let $\{T_i \to T\}_{i \in I}$ be a pro-\'etale
covering of $T$. Then there exists a pro-\'etale covering
$\{U_j \to T\}_{j = 1, \ldots, n}$ which is a refinement
of $\{T_i \to T\}_{i \in I}$ such that each $U_j$ is an affine
scheme. Moreover, we may choose each $U_j$ to be open affine
in one of the $T_i$.
\end{lemma}

\begin{proof}
This follows directly from the definition.
\end{proof}

\noindent
Thus we define the corresponding standard coverings of affines as follows.

\begin{definition}
\label{definition-standard-proetale}
Let $T$ be an affine scheme. A {\it standard pro-\'etale covering}
of $T$ is a family $\{f_i : T_i \to T\}_{i = 1, \ldots, n}$
where each $T_j$ is affine, each $f_i$ is weakly \'etale, and
$T = \bigcup f_i(T_i)$.
\end{definition}

\noindent
We interrupt the discussion for an explanation of the notion
of w-contractible rings in terms of pro-\'etale coverings.

\begin{lemma}
\label{lemma-w-contractible-proetale-cover}
Let $T = \Spec(A)$ be an affine scheme. The following are equivalent
\begin{enumerate}
\item $A$ is w-contractible, and
\item every pro-\'etale covering of $T$ can be refined by
a Zariski covering of the form $T = \coprod_{i = 1, \ldots, n} U_i$.
\end{enumerate}
\end{lemma}

\begin{proof}
Assume $A$ is w-contractible. By Lemma \ref{lemma-proetale-affine}
it suffices to prove we can refine every standard pro-\'etale covering
$\{f_i : T_i \to T\}_{i = 1, \ldots, n}$ by a Zariski covering of $T$.
The morphism $\coprod T_i \to T$ is a surjective weakly \'etale morphism
of affine schemes. Hence by Definition \ref{definition-w-contractible}
there exists a morphism $\sigma : T \to \coprod T_i$ over $T$.
Then the Zariski covering $T = \coprod \sigma^{-1}(T_i)$
refines $\{f_i : T_i \to T\}$.

\medskip\noindent
Conversely, assume (2). If $A \to B$ is faithfully flat and weakly \'etale,
then $\{\Spec(B) \to T\}$ is a pro-\'etale covering.
Hence there exists a Zariski covering $T = \coprod U_i$
and morphisms $U_i \to \Spec(B)$ over $T$. Since $T = \coprod U_i$
we obtain $T \to \Spec(B)$, i.e., an $A$-algebra map $B \to A$.
This means $A$ is w-contractible.
\end{proof}

\noindent
We follow the general outline given in
Topologies, Section \ref{topologies-section-procedure}
for constructing the big pro-\'etale site we will be working with.
However, because we need a bit larger rings to accommodate for the size
of certain constructions we modify the constructions slightly.

\begin{definition}
\label{definition-big-proetale-site}
A {\it big pro-\'etale site} is any site $\Sch_\proetale$ as in
Sites, Definition \ref{sites-definition-site} constructed as follows:
\begin{enumerate}
\item Choose any set of schemes $S_0$, and any set of pro-\'etale coverings
$\text{Cov}_0$ among these schemes.
\item Change the function $Bound$ of
Sets, Equation (\ref{sets-equation-bound}) into
$$
Bound(\kappa) = \max\{\kappa^{2^{2^{2^\kappa}}}, \kappa^{\aleph_0}, \kappa^+\}.
$$
\item As underlying category take any category $\Sch_\alpha$
constructed as in Sets, Lemma \ref{sets-lemma-construct-category}
starting with the set $S_0$ and the function $Bound$.
\item Choose any set of coverings as in
Sets, Lemma \ref{sets-lemma-coverings-site} starting with the
category $\Sch_\alpha$ and the class of pro-\'etale coverings,
and the set $\text{Cov}_0$ chosen above.
\end{enumerate}
\end{definition}

\noindent
See the remarks following
Topologies, Definition \ref{topologies-definition-big-zariski-site}
for motivation and explanation regarding the definition of big sites.

\medskip\noindent
Before we continue with the introduction of the big and small
pro-\'etale sites of a scheme, let us point out that (1) our category
contains many weakly contractible objects, and (2) the topology on a
big pro-\'etale site $\Sch_\proetale$ is in some sense induced from
the pro-\'etale topology on the category of all schemes.

\begin{lemma}
\label{lemma-w-contractible-is-weakly-contractible}
Let $\Sch_\proetale$ be a big pro-\'etale site as in
Definition \ref{definition-big-proetale-site}.
Let $T = \Spec(A)$ be an affine object of $\Sch_\proetale$.
If $A$ is w-contractible, then $T$ is a weakly contractible
(Sites, Definition \ref{sites-definition-w-contractible})
object of $\Sch_\proetale$.
\end{lemma}

\begin{proof}
Let $\mathcal{F} \to \mathcal{G}$ be a surjection of sheaves on
$\Sch_\proetale$. Let $s \in \mathcal{G}(T)$. We have to show that
$s$ is in the image of $\mathcal{F}(T) \to \mathcal{G}(T)$. We can find a
covering $\{T_i \to T\}$ of $\Sch_\proetale$ such that $s$ lifts
to a section of $\mathcal{F}$ over $T_i$
(Sites, Definition \ref{sites-definition-sheaves-injective-surjective}).
By Lemma \ref{lemma-w-contractible-proetale-cover}
we can refine $\{T_i \to T\}$ by a Zariski
covering of the form $T = \coprod_{j = 1, \ldots, m} V_j$.
Hence we get $t_j \in \mathcal{F}(U_j)$ mapping to $s|_{U_j}$.
Since Zariski coverings are coverings in $\Sch_\proetale$
(Lemma \ref{lemma-etale-proetale}) we conclude that
$\mathcal{F}(T) = \prod \mathcal{F}(U_j)$.
Thus, taking $t = (t_1, \ldots, t_m) \in \mathcal{F}(T)$
is a section mapping to $s$.
\end{proof}

\begin{lemma}
\label{lemma-get-many-weakly-contractible}
Let $\Sch_\proetale$ be a big pro-\'etale site as in
Definition \ref{definition-big-proetale-site}.
For every object $T$ of $\Sch_\proetale$ there exists
a covering $\{T_i \to T\}$ in $\Sch_\proetale$
with each $T_i$ affine and the spectrum of a w-contractible
ring. In particular, $T_i$ is weakly contractible in $\Sch_\proetale$.
\end{lemma}

\begin{proof}
For those readers who do not care about set-theoretical issues
this lemma is a trivial consequence of
Lemma \ref{lemma-w-contractible-is-weakly-contractible} and
Proposition \ref{proposition-find-w-contractible}.
Here are the details.
Choose an affine open covering $T = \bigcup U_i$. Write $U_i = \Spec(A_i)$.
Choose faithfully flat, ind-\'etale ring maps $A_i \to D_i$
such that $D_i$ is w-contractible as in
Proposition \ref{proposition-find-w-contractible}.
The family of morphisms $\{\Spec(D_i) \to T\}$ is a
pro-\'etale covering.
If we can show that $\Spec(D_i)$ is isomorphic to an object, say $T_i$,
of $\Sch_\proetale$, then $\{T_i \to T\}$ will be combinatorially
equivalent to a covering of $\Sch_\proetale$ by the construction
of $\Sch_\proetale$ in Definition \ref{definition-big-proetale-site}
and more precisely the application of
Sets, Lemma \ref{sets-lemma-coverings-site} in the last step.
To prove $\Spec(D_i)$ is isomorphic to an object of
$\Sch_\proetale$, it suffices to prove that
$|D_i| \leq Bound(\text{size}(T))$ by the construction
of $\Sch_\proetale$ in Definition \ref{definition-big-proetale-site}
and more precisely the application of
Sets, Lemma \ref{sets-lemma-construct-category} in step (3).
Since $|A_i| \leq \text{size}(U_i) \leq \text{size}(T)$
by Sets, Lemmas \ref{sets-lemma-bound-affine} and
\ref{sets-lemma-bound-finite-type} we get
$|D_i| \leq \kappa^{2^{2^{2^\kappa}}}$ where $\kappa = \text{size}(T)$
by Remark \ref{remark-size-w-contractible}.
Thus by our choice of the function $Bound$ in
Definition \ref{definition-big-proetale-site} we win.
\end{proof}

\begin{lemma}
\label{lemma-proetale-induced}
Let $\Sch_\proetale$ be a big pro-\'etale site as in
Definition \ref{definition-big-proetale-site}.
Let $T \in \Ob(\Sch_\proetale)$.
Let $\{T_i \to T\}_{i \in I}$ be an arbitrary pro-\'etale covering of $T$.
There exists a covering $\{U_j \to T\}_{j \in J}$ of $T$ in the site
$\Sch_\proetale$ which refines $\{T_i \to T\}_{i \in I}$.
\end{lemma}

\begin{proof}
Namely, we first let $\{V_k \to T\}$ be a covering as in
Lemma \ref{lemma-get-many-weakly-contractible}.
Then the pro-\'etale coverings $\{T_i \times_T V_k \to V_k\}$
can be refined by a finite disjoint open covering
$V_k = V_{k, 1} \amalg \ldots \amalg V_{k, n_k}$, see
Lemma \ref{lemma-w-contractible-proetale-cover}.
Then $\{V_{k, i} \to T\}$ is a covering of $\Sch_\proetale$
which refines $\{T_i \to T\}_{i \in I}$.
\end{proof}

\begin{definition}
\label{definition-big-small-proetale}
Let $S$ be a scheme. Let $\Sch_\proetale$ be a big pro-\'etale
site containing $S$.
\begin{enumerate}
\item The {\it big pro-\'etale site of $S$}, denoted
$(\Sch/S)_\proetale$, is the site $\Sch_\proetale/S$
introduced in Sites, Section \ref{sites-section-localize}.
\item The {\it small pro-\'etale site of $S$}, which we denote
$S_\proetale$, is the full subcategory of $(\Sch/S)_\proetale$
whose objects are those $U/S$ such that $U \to S$ is weakly \'etale.
A covering of $S_\proetale$ is any covering $\{U_i \to U\}$ of
$(\Sch/S)_\proetale$ with $U \in \Ob(S_\proetale)$.
\item The {\it big affine pro-\'etale site of $S$}, denoted
$(\textit{Aff}/S)_\proetale$, is the full subcategory of
$(\Sch/S)_\proetale$ whose objects are affine $U/S$.
A covering of $(\textit{Aff}/S)_\proetale$ is any covering
$\{U_i \to U\}$ of $(\Sch/S)_\proetale$ which is a
standard pro-\'etale covering.
\end{enumerate}
\end{definition}

\noindent
It is not completely clear that the small pro-\'etale site and
the big affine pro-\'etale site are sites. We check this now.

\begin{lemma}
\label{lemma-verify-site-proetale}
Let $S$ be a scheme. Let $\Sch_\proetale$ be a big pro-\'etale site
containing $S$. Both $S_\proetale$ and $(\textit{Aff}/S)_\proetale$ are sites.
\end{lemma}

\begin{proof}
Let us show that $S_\proetale$ is a site. It is a category with a
given set of families of morphisms with fixed target. Thus we
have to show properties (1), (2) and (3) of
Sites, Definition \ref{sites-definition-site}.
Since $(\Sch/S)_\proetale$ is a site, it suffices to prove
that given any covering $\{U_i \to U\}$ of $(\Sch/S)_\proetale$
with $U \in \Ob(S_\proetale)$ we also have $U_i \in \Ob(S_\proetale)$.
This follows from the definitions
as the composition of weakly \'etale morphisms is weakly \'etale.

\medskip\noindent
To show that $(\textit{Aff}/S)_\proetale$ is a site, reasoning as above,
it suffices to show that the collection of standard pro-\'etale coverings
of affines satisfies properties (1), (2) and (3) of
Sites, Definition \ref{sites-definition-site}.
This follows from Lemma \ref{lemma-recognize-proetale-covering}
and the corresponding result for standard fpqc coverings
(Topologies, Lemma \ref{topologies-lemma-fpqc-affine-axioms}).
\end{proof}

\begin{lemma}
\label{lemma-fibre-products-proetale}
Let $S$ be a scheme. Let $\Sch_\proetale$ be a big pro-\'etale
site containing $S$. Let $\Sch$ be the category of all schemes.
\begin{enumerate}
\item The categories $\Sch_\proetale$, $(\Sch/S)_\proetale$,
$S_\proetale$, and $(\textit{Aff}/S)_\proetale$ have fibre products
agreeing with fibre products in $\Sch$.
\item The categories $\Sch_\proetale$, $(\Sch/S)_\proetale$,
$S_\proetale$ have equalizers agreeing with equalizers in $\Sch$.
\item The categories $(\Sch/S)_\proetale$, and $S_\proetale$ both have
a final object, namely $S/S$.
\item The category $\Sch_\proetale$ has a final object agreeing
with the final object of $\Sch$, namely $\Spec(\mathbf{Z})$.
\end{enumerate}
\end{lemma}

\begin{proof}
The category $\Sch_\proetale$ contains $\Spec(\mathbf{Z})$ and
is closed under products and fibre products by construction, see
Sets, Lemma \ref{sets-lemma-what-is-in-it}.
Suppose we have $U \to S$, $V \to U$, $W \to U$ morphisms
of schemes with $U, V, W \in \Ob(\Sch_\proetale)$.
The fibre product $V \times_U W$ in $\Sch_\proetale$
is a fibre product in $\Sch$ and
is the fibre product of $V/S$ with $W/S$ over $U/S$ in
the category of all schemes over $S$, and hence also a
fibre product in $(\Sch/S)_\proetale$.
This proves the result for $(\Sch/S)_\proetale$.
If $U \to S$, $V \to U$ and $W \to U$ are weakly \'etale then so is
$V \times_U W \to S$ (see
More on Morphisms, Section \ref{more-morphisms-section-weakly-etale})
and hence we get fibre products for $S_\proetale$.
If $U, V, W$ are affine, so is $V \times_U W$ and hence we
get fibre products for $(\textit{Aff}/S)_\proetale$.

\medskip\noindent
Let $a, b : U \to V$ be two morphisms in $\Sch_\proetale$.
In this case the equalizer of $a$ and $b$ (in the category of schemes) is
$$
V
\times_{\Delta_{V/\Spec(\mathbf{Z})}, V \times_{\Spec(\mathbf{Z})} V, (a, b)}
(U \times_{\Spec(\mathbf{Z})} U)
$$
which is an object of $\Sch_\proetale$ by what we saw above.
Thus $\Sch_\proetale$ has equalizers. If $a$ and $b$ are morphisms over $S$,
then the equalizer (in the category of schemes) is also given by
$$
V \times_{\Delta_{V/S}, V \times_S V, (a, b)} (U \times_S U)
$$
hence we see that $(\Sch/S)_\proetale$ has equalizers. Moreover, if
$U$ and $V$ are weakly-\'etale over $S$, then so is the equalizer
above as a fibre product of schemes weakly \'etale over $S$.
Thus $S_\proetale$ has equalizers. The statements on final objects
is clear.
\end{proof}

\noindent
Next, we check that the big affine pro-\'etale site defines the same
topos as the big pro-\'etale site.

\begin{lemma}
\label{lemma-affine-big-site-proetale}
Let $S$ be a scheme. Let $\Sch_\proetale$ be a big pro-\'etale
site containing $S$.
The functor $(\textit{Aff}/S)_\proetale \to (\Sch/S)_\proetale$
is a special cocontinuous functor. Hence it induces an equivalence
of topoi from $\Sh((\textit{Aff}/S)_\proetale)$ to
$\Sh((\Sch/S)_\proetale)$.
\end{lemma}

\begin{proof}
The notion of a special cocontinuous functor is introduced in
Sites, Definition \ref{sites-definition-special-cocontinuous-functor}.
Thus we have to verify assumptions (1) -- (5) of
Sites, Lemma \ref{sites-lemma-equivalence}.
Denote the inclusion functor
$u : (\textit{Aff}/S)_\proetale \to (\Sch/S)_\proetale$.
Being cocontinuous just means that any pro-\'etale covering of
$T/S$, $T$ affine, can be refined by a standard pro-\'etale
covering of $T$. This is the content of
Lemma \ref{lemma-proetale-affine}.
Hence (1) holds. We see $u$ is continuous simply because a standard
pro-\'etale covering is a pro-\'etale covering. Hence (2) holds.
Parts (3) and (4) follow immediately from the fact that $u$ is
fully faithful. And finally condition (5) follows from the
fact that every scheme has an affine open covering.
\end{proof}

\begin{lemma}
\label{lemma-put-in-T}
Let $\Sch_\proetale$ be a big pro-\'etale site.
Let $f : T \to S$ be a morphism in $\Sch_\proetale$.
The functor $T_\proetale \to (\Sch/S)_\proetale$
is cocontinuous and induces a morphism of topoi
$$
i_f :
\Sh(T_\proetale)
\longrightarrow
\Sh((\Sch/S)_\proetale)
$$
For a sheaf $\mathcal{G}$ on $(\Sch/S)_\proetale$
we have the formula $(i_f^{-1}\mathcal{G})(U/T) = \mathcal{G}(U/S)$.
The functor $i_f^{-1}$ also has a left adjoint $i_{f, !}$ which commutes
with fibre products and equalizers.
\end{lemma}

\begin{proof}
Denote the functor $u : T_\proetale \to (\Sch/S)_\proetale$.
In other words, given a weakly \'etale morphism $j : U \to T$ corresponding
to an object of $T_\proetale$ we set $u(U \to T) = (f \circ j : U \to S)$.
This functor commutes with fibre products, see
Lemma \ref{lemma-fibre-products-proetale}.
Moreover, $T_\proetale$ has equalizers and $u$ commutes with them
by Lemma \ref{lemma-fibre-products-proetale}.
It is clearly cocontinuous.
It is also continuous as $u$ transforms coverings to coverings and
commutes with fibre products. Hence the lemma follows from
Sites, Lemmas \ref{sites-lemma-when-shriek}
and \ref{sites-lemma-preserve-equalizers}.
\end{proof}

\begin{lemma}
\label{lemma-at-the-bottom}
Let $S$ be a scheme. Let $\Sch_\proetale$ be a big pro-\'etale
site containing $S$.
The inclusion functor $S_\proetale \to (\Sch/S)_\proetale$
satisfies the hypotheses of Sites, Lemma \ref{sites-lemma-bigger-site}
and hence induces a morphism of sites
$$
\pi_S : (\Sch/S)_\proetale \longrightarrow S_\proetale
$$
and a morphism of topoi
$$
i_S : \Sh(S_\proetale) \longrightarrow \Sh((\Sch/S)_\proetale)
$$
such that $\pi_S \circ i_S = \text{id}$. Moreover, $i_S = i_{\text{id}_S}$
with $i_{\text{id}_S}$ as in Lemma \ref{lemma-put-in-T}. In particular the
functor $i_S^{-1} = \pi_{S, *}$ is described by the rule
$i_S^{-1}(\mathcal{G})(U/S) = \mathcal{G}(U/S)$.
\end{lemma}

\begin{proof}
In this case the functor $u : S_\proetale \to (\Sch/S)_\proetale$,
in addition to the properties seen in the proof of
Lemma \ref{lemma-put-in-T} above, also is fully faithful
and transforms the final object into the final object.
The lemma follows from Sites, Lemma \ref{sites-lemma-bigger-site}.
\end{proof}

\begin{definition}
\label{definition-restriction-small-proetale}
In the situation of
Lemma \ref{lemma-at-the-bottom}
the functor $i_S^{-1} = \pi_{S, *}$ is often
called the {\it restriction to the small pro-\'etale site}, and for a sheaf
$\mathcal{F}$ on the big pro-\'etale site we denote
$\mathcal{F}|_{S_\proetale}$ this restriction.
\end{definition}

\noindent
With this notation in place we have for a sheaf $\mathcal{F}$ on the
big site and a sheaf $\mathcal{G}$ on the big site that
\begin{align*}
\Mor_{\Sh(S_\proetale)}(\mathcal{F}|_{S_\proetale}, \mathcal{G})
& =
\Mor_{\Sh((\Sch/S)_\proetale)}(\mathcal{F},
i_{S, *}\mathcal{G}) \\
\Mor_{\Sh(S_\proetale)}(\mathcal{G}, \mathcal{F}|_{S_\proetale})
& =
\Mor_{\Sh((\Sch/S)_\proetale)}(\pi_S^{-1}\mathcal{G}, \mathcal{F})
\end{align*}
Moreover, we have $(i_{S, *}\mathcal{G})|_{S_\proetale} = \mathcal{G}$
and we have $(\pi_S^{-1}\mathcal{G})|_{S_\proetale} = \mathcal{G}$.

\begin{lemma}
\label{lemma-morphism-big}
Let $\Sch_\proetale$ be a big pro-\'etale site.
Let $f : T \to S$ be a morphism in $\Sch_\proetale$.
The functor
$$
u : (\Sch/T)_\proetale \longrightarrow (\Sch/S)_\proetale, \quad
V/T \longmapsto V/S
$$
is cocontinuous, and has a continuous right adjoint
$$
v : (\Sch/S)_\proetale \longrightarrow (\Sch/T)_\proetale, \quad
(U \to S) \longmapsto (U \times_S T \to T).
$$
They induce the same morphism of topoi
$$
f_{big} :
\Sh((\Sch/T)_\proetale)
\longrightarrow
\Sh((\Sch/S)_\proetale)
$$
We have $f_{big}^{-1}(\mathcal{G})(U/T) = \mathcal{G}(U/S)$.
We have $f_{big, *}(\mathcal{F})(U/S) = \mathcal{F}(U \times_S T/T)$.
Also, $f_{big}^{-1}$ has a left adjoint $f_{big!}$ which commutes with
fibre products and equalizers.
\end{lemma}

\begin{proof}
The functor $u$ is cocontinuous, continuous, and commutes with fibre products
and equalizers (details omitted; compare with proof of
Lemma \ref{lemma-put-in-T}). Hence
Sites, Lemmas \ref{sites-lemma-when-shriek} and
\ref{sites-lemma-preserve-equalizers}
apply and we deduce the formula
for $f_{big}^{-1}$ and the existence of $f_{big!}$. Moreover,
the functor $v$ is a right adjoint because given $U/T$ and $V/S$
we have $\Mor_S(u(U), V) = \Mor_T(U, V \times_S T)$
as desired. Thus we may apply
Sites, Lemmas \ref{sites-lemma-have-functor-other-way} and
\ref{sites-lemma-have-functor-other-way-morphism}
to get the formula for $f_{big, *}$.
\end{proof}

\begin{lemma}
\label{lemma-morphism-big-small}
Let $\Sch_\proetale$ be a big pro-\'etale site.
Let $f : T \to S$ be a morphism in $\Sch_\proetale$.
\begin{enumerate}
\item We have $i_f = f_{big} \circ i_T$ with $i_f$ as in
Lemma \ref{lemma-put-in-T} and $i_T$ as in
Lemma \ref{lemma-at-the-bottom}.
\item The functor $S_\proetale \to T_\proetale$,
$(U \to S) \mapsto (U \times_S T \to T)$ is continuous and induces
a morphism of topoi
$$
f_{small} : \Sh(T_\proetale) \longrightarrow \Sh(S_\proetale).
$$
We have $f_{small, *}(\mathcal{F})(U/S) = \mathcal{F}(U \times_S T/T)$.
\item We have a commutative diagram of morphisms of sites
$$
\xymatrix{
T_\proetale \ar[d]_{f_{small}} &
(\Sch/T)_\proetale \ar[d]^{f_{big}} \ar[l]^{\pi_T}\\
S_\proetale &
(\Sch/S)_\proetale \ar[l]_{\pi_S}
}
$$
so that $f_{small} \circ \pi_T = \pi_S \circ f_{big}$ as morphisms of topoi.
\item We have $f_{small} = \pi_S \circ f_{big} \circ i_T = \pi_S \circ i_f$.
\end{enumerate}
\end{lemma}

\begin{proof}
The equality $i_f = f_{big} \circ i_T$ follows from the
equality $i_f^{-1} = i_T^{-1} \circ f_{big}^{-1}$ which is
clear from the descriptions of these functors above.
Thus we see (1).

\medskip\noindent
The functor $u : S_\proetale \to T_\proetale$,
$u(U \to S) = (U \times_S T \to T)$
transforms coverings into coverings and commutes with fibre products,
see Lemmas \ref{lemma-proetale} and \ref{lemma-fibre-products-proetale}.
Moreover, both $S_\proetale$, $T_\proetale$ have final objects,
namely $S/S$ and $T/T$ and $u(S/S) = T/T$. Hence by
Sites, Proposition \ref{sites-proposition-get-morphism}
the functor $u$ corresponds to a morphism of sites
$T_\proetale \to S_\proetale$. This in turn gives rise to the
morphism of topoi, see
Sites, Lemma \ref{sites-lemma-morphism-sites-topoi}. The description
of the pushforward is clear from these references.

\medskip\noindent
Part (3) follows because $\pi_S$ and $\pi_T$ are given by the
inclusion functors and $f_{small}$ and $f_{big}$ by the
base change functors $U \mapsto U \times_S T$.

\medskip\noindent
Statement (4) follows from (3) by precomposing with $i_T$.
\end{proof}

\noindent
In the situation of the lemma, using the terminology of
Definition \ref{definition-restriction-small-proetale}
we have: for $\mathcal{F}$ a sheaf on the big pro-\'etale site of $T$
$$
(f_{big, *}\mathcal{F})|_{S_\proetale} =
f_{small, *}(\mathcal{F}|_{T_\proetale}),
$$
This equality is clear from the commutativity of the diagram of
sites of the lemma, since restriction to the small pro-\'etale site of
$T$, resp.\ $S$ is given by $\pi_{T, *}$, resp.\ $\pi_{S, *}$. A similar
formula involving pullbacks and restrictions is false.

\begin{lemma}
\label{lemma-composition-proetale}
Given schemes $X$, $Y$, $Y$ in $\Sch_\proetale$
and morphisms $f : X \to Y$, $g : Y \to Z$ we have
$g_{big} \circ f_{big} = (g \circ f)_{big}$ and
$g_{small} \circ f_{small} = (g \circ f)_{small}$.
\end{lemma}

\begin{proof}
This follows from the simple description of pushforward
and pullback for the functors on the big sites from
Lemma \ref{lemma-morphism-big}. For the functors
on the small sites this follows from the description of
the pushforward functors in Lemma \ref{lemma-morphism-big-small}.
\end{proof}

\noindent
We can think about a sheaf on the big pro-\'etale site of $S$ as a collection
of sheaves on the small pro-\'etale site on schemes over $S$.

\begin{lemma}
\label{lemma-characterize-sheaf-big}
Let $S$ be a scheme contained in a big pro-\'etale site $\Sch_\proetale$.
A sheaf $\mathcal{F}$ on the big pro-\'etale site $(\Sch/S)_\proetale$
is given by the following data:
\begin{enumerate}
\item for every $T/S \in \Ob((\Sch/S)_\proetale)$ a sheaf
$\mathcal{F}_T$ on $T_\proetale$,
\item for every $f : T' \to T$ in
$(\Sch/S)_\proetale$ a map
$c_f : f_{small}^{-1}\mathcal{F}_T \to \mathcal{F}_{T'}$.
\end{enumerate}
These data are subject to the following conditions:
\begin{enumerate}
\item[(a)] given any $f : T' \to T$ and $g : T'' \to T'$ in
$(\Sch/S)_\proetale$ the composition
$g_{small}^{-1}c_f \circ c_g$ is equal to $c_{f \circ g}$, and
\item[(b)] if $f : T' \to T$ in $(\Sch/S)_\proetale$
is weakly \'etale then $c_f$ is an isomorphism.
\end{enumerate}
\end{lemma}

\begin{proof}
Identical to the proof of
Topologies, Lemma \ref{topologies-lemma-characterize-sheaf-big-etale}.
\end{proof}

\begin{lemma}
\label{lemma-alternative}
Let $S$ be a scheme. Let $S_{affine, \proetale}$ denote the full subcategory
of $S_\proetale$ consisting of affine objects. A covering of
$S_{affine, \proetale}$ will be a standard \'etale covering, see
Definition \ref{definition-standard-proetale}.
Then restriction
$$
\mathcal{F} \longmapsto \mathcal{F}|_{S_{affine, \etale}}
$$
defines an equivalence of topoi
$\Sh(S_\proetale) \cong \Sh(S_{affine, \proetale})$.
\end{lemma}

\begin{proof}
This you can show directly from the definitions, and is a good exercise.
But it also follows immediately from
Sites, Lemma \ref{sites-lemma-equivalence}
by checking that the inclusion functor
$S_{affine, \proetale} \to S_\proetale$
is a special cocontinuous functor (see
Sites, Definition \ref{sites-definition-special-cocontinuous-functor}).
\end{proof}

\begin{lemma}
\label{lemma-affine-alternative}
Let $S$ be an affine scheme. Let $S_{app}$ denote the full subcategory
of $S_\proetale$ consisting of affine objects $U$ such that
$\mathcal{O}(S) \to \mathcal{O}(U)$ is ind-\'etale. A covering of
$S_{app}$ will be a standard pro-\'etale covering, see
Definition \ref{definition-standard-proetale}.
Then restriction
$$
\mathcal{F} \longmapsto \mathcal{F}|_{S_{app}}
$$
defines an equivalence of topoi $\Sh(S_\proetale) \cong \Sh(S_{app})$.
\end{lemma}

\begin{proof}
By Lemma \ref{lemma-alternative} we may replace $S_\proetale$ by
$S_{affine, \proetale}$.
The lemma follows from Sites, Lemma \ref{sites-lemma-equivalence}
by checking that the inclusion functor $S_{app} \to S_{affine, \proetale}$
is a special cocontinuous functor, see
Sites, Definition \ref{sites-definition-special-cocontinuous-functor}.
The conditions of Sites, Lemma \ref{sites-lemma-equivalence}
follow immediately from the definition and the facts
(a) any object $U$ of $S_{affine, \proetale}$ has a covering
$\{V \to U\}$ with $V$ ind-\'etale over $X$
(Proposition \ref{proposition-weakly-etale})
and (b) the functor $u$ is fully faithful.
\end{proof}

\noindent
Next we show that cohomology of sheaves is independent of the choice
of a partial universe. Namely, the functor $g_*$ of the lemma below
is an embedding of pro-\'etale topoi which does not change cohomology.

\begin{lemma}
\label{lemma-proetale-cohomology-independent-partial-universe}
Let $S$ be a scheme. Let $S_\proetale \subset S_\proetale'$ be
two small pro-\'etale sites of $S$ as constructed in
Definition \ref{definition-big-small-proetale}. Then the inclusion functor
satisfies the assumptions of 
Sites, Lemma \ref{sites-lemma-bigger-site}.
Hence there exist morphisms of topoi
$$
\xymatrix{
\Sh(S_\proetale) \ar[r]^g &
\Sh(S_\proetale') \ar[r]^f &
\Sh(S_\proetale)
}
$$
whose composition is isomorphic to the identity and with $f_* = g^{-1}$.
Moreover,
\begin{enumerate}
\item for $\mathcal{F}' \in \textit{Ab}(S_\proetale')$ we have
$H^p(S_\proetale', \mathcal{F}') = H^p(S_\proetale, g^{-1}\mathcal{F}')$,
\item for $\mathcal{F} \in \textit{Ab}(S_\proetale)$ we have
$$
H^p(S_\proetale, \mathcal{F}) =
H^p(S_\proetale', g_*\mathcal{F}) =
H^p(S_\proetale', f^{-1}\mathcal{F}).
$$
\end{enumerate}
\end{lemma}

\begin{proof}
The inclusion functor is fully faithful and continuous.
We have seen that $S_\proetale$ and $S_\proetale'$ have fibre products
and final objects and that our functor commutes with these
(Lemma \ref{lemma-fibre-products-proetale}).
It follows from Lemma \ref{lemma-proetale-induced}
that the inclusion functor is cocontinuous.
Hence the existence of $f$ and $g$ follows from
Sites, Lemma \ref{sites-lemma-bigger-site}.
The equality in (1) is
Cohomology on Sites, Lemma \ref{sites-cohomology-lemma-cohomology-bigger-site}.
Part (2) follows from (1) as
$\mathcal{F} = g^{-1}g_*\mathcal{F} = g^{-1}f^{-1}\mathcal{F}$.
\end{proof}

\begin{lemma}
\label{lemma-proetale-subcanonical}
Let $S$ be a scheme. The topology on each of the pro-\'etale sites
$S_\proetale$, $(\Sch/S)_\proetale$, $S_{affine, \proetale}$, and
$(\textit{Aff}/S)_\proetale$ is subcanonical.
\end{lemma}

\begin{proof}
Combine Lemma \ref{lemma-recognize-proetale-covering} and
Descent, Lemma \ref{descent-lemma-fpqc-universal-effective-epimorphisms}.
\end{proof}

\begin{lemma}
\label{lemma-proetale-enough-w-contractible}
Let $S$ be a scheme. The pro-\'etale sites
$S_\proetale$, $(\Sch/S)_\proetale$, $S_{affine, \proetale}$, and
$(\textit{Aff}/S)_\proetale$ and if $S$ is affine $S_{app}$
have enough quasi-compact, weakly contractible
objects, see Sites, Definition \ref{sites-definition-w-contractible}.
\end{lemma}

\begin{proof}
Follows immediately from Lemma \ref{lemma-get-many-weakly-contractible}.
\end{proof}







\section{Points of the pro-\'etale site}
\label{section-points}

\noindent
We first apply Deligne's criterion to show that there are enough points.

\begin{lemma}
\label{lemma-points-proetale}
Let $S$ be a scheme. The pro-\'etale sites
$S_\proetale$, $(\Sch/S)_\proetale$, $S_{affine, \proetale}$, and
$(\textit{Aff}/S)_\proetale$ have enough points.
\end{lemma}

\begin{proof}
The big topos is equivalent to the topos defined by
$(\textit{Aff}/S)_\proetale$, see
Lemma \ref{lemma-affine-big-site-proetale}.
The topos of sheaves on $S_\proetale$ is equivalent to the topos
associated to $S_{affine, \proetale}$, see
Lemma \ref{lemma-alternative}.
The result for the sites $(\textit{Aff}/S)_\proetale$ and
$S_{affine, \proetale}$ follows immediately from Deligne's result
Sites, Proposition \ref{sites-proposition-criterion-points}.
\end{proof}

\noindent
Let $S$ be a scheme. Let $\overline{s} : \Spec(k) \to S$ be a geometric
point. We define a {\it pro-\'etale neighbourhood} of $\overline{s}$
to be a commutative diagram
$$
\xymatrix{
\Spec(k) \ar[r]_-{\overline{u}} \ar[rd]_{\overline{s}} & U \ar[d] \\
& S
}
$$
with $U \to S$ weakly \'etale. In exactly the same manner as in
\'Etale Cohomology, Lemma \ref{etale-cohomology-lemma-cofinal-etale}
one shows that the category of pro-\'etale
neighbourhoods of $\overline{s}$ is cofiltered. Moreover, if
$(U, \overline{u})$ is a pro-\'etale neighbourhood, and if $\{U_i \to U\}$
is a pro-\'etale covering, then there exists an $i$ and a lift of
$\overline{u}$ to a geometric point $\overline{u}_i$ of $U_i$.
For $\mathcal{F}$ in $\Sh(S_\proetale)$ define the {\it stalk
of $\mathcal{F}$ at $\overline{s}$} by the formula
$$
\mathcal{F}_{\overline{s}} = \colim_{(U, \overline{u})} \mathcal{F}(U)
$$
where the colimit is over all pro-\'etale neighbourhoods $(U, \overline{u})$
of $\overline{s}$ with $U \in \Ob(S_\proetale)$.
A formal argument using the facts above shows the functor
$\mathcal{F} \mapsto \mathcal{F}_{\overline{s}}$
defines a point of the topos $\Sh(S_\proetale)$:
it is an exact functor which commutes with arbitrary colimits.
In fact, this functor has another description.

\begin{lemma}
\label{lemma-classical-point}
In the situation above the scheme $\Spec(\mathcal{O}_{S, \overline{s}}^{sh})$
is an object of $X_\proetale$ and there is a canonical isomorphism
$$
\mathcal{F}(\Spec(\mathcal{O}_{S, \overline{s}}^{sh})) =
\mathcal{F}_{\overline{s}}
$$
functorial in $\mathcal{F}$.
\end{lemma}

\begin{proof}
The first statement is clear from the construction of the strict henselization
as a filtered colimit of \'etale algebras over $S$, or by the characterization
of weakly \'etale morphisms of
More on Morphisms, Lemma
\ref{more-morphisms-lemma-weakly-etale-strictly-henselian-local-rings}.
The second statement follows as by Olivier's theorem
(More on Algebra, Theorem \ref{more-algebra-theorem-olivier})
the scheme $\Spec(\mathcal{O}_{S, \overline{s}}^{sh})$
is an initial object of the category of pro-\'etale neighbourhoods
of $\overline{s}$.
\end{proof}

\noindent
Contrary to the situation with the \'etale topos of $S$ it is not true
that every point of $\Sh(S_\proetale)$ is of this form, and it is not
true that the collection of points associated to geometric points is
conservative. Namely, suppose that $S = \Spec(k)$ where $k$ is an
algebraically closed field. Let $A$ be an abelian group.
Consider the sheaf $\mathcal{F}$ on $S_\proetale$ defined by the rule
$$
\mathcal{F}(U) = \frac{\{\text{functions }U \to A\}}{\{\text{locally constant functions}\}}
$$
Then $\mathcal{F}(U) = 0$ if $U = S = \Spec(k)$ but in general $\mathcal{F}$
is not zero. Namely, $S_\proetale$ contains quasi-compact objects
with infinitely many
points. For example, let $E = \lim E_n$ be an inverse limit of
finite sets with surjective transition maps,
e.g., $E = \lim \mathbf{Z}/n\mathbf{Z}$.
The scheme $\Spec(\colim \text{Map}(E_n, k))$
is an object of $S_\proetale$ because $\colim \text{Map}(E_n, k)$
is weakly \'etale (even ind-Zariski) over $k$.
Thus $\mathcal{F}$ is a nonzero abelian sheaf whose stalk at the
unique geometric point of $S$ is zero.

\medskip\noindent
The solution is to use the existence of quasi-compact, weakly contractible
objects. First, there are enough quasi-compact, weakly contractible objects by
Lemma \ref{lemma-proetale-enough-w-contractible}.
Second, if $W \in \Ob(S_\proetale)$ is quasi-compact, weakly contractible,
then the functor
$$
\Sh(S_\proetale) \longrightarrow \textit{Sets},\quad
\mathcal{F} \longmapsto \mathcal{F}(W)
$$
is an exact functor $\Sh(S_\proetale) \to \textit{Sets}$ which commutes
with all limits. The functor
$$
\textit{Ab}(S_\proetale) \longrightarrow \textit{Ab},\quad
\mathcal{F} \longmapsto \mathcal{F}(W)
$$
is exact and commutes with direct sums (as $W$ is quasi-compact, see
Sites, Lemma \ref{sites-lemma-directed-colimits-sections}), hence
commutes with all limits and colimits. Moreover, we can check exactness of
a complex of abelian sheaves by evaluation at the
quasi-compact, weakly contractible objects of $S_\proetale$, see
Cohomology on Sites, Proposition
\ref{sites-cohomology-proposition-enough-weakly-contractibles}.




\section{Compact generation}
\label{section-compact-generation}

\noindent
Let $S$ be a scheme. The site $S_\proetale$ has enough quasi-compact,
weakly contractible objects $U$. For any sheaf of rings $\mathcal{A}$
on $S_\proetale$ the corresponding objects $j_{U!}\mathcal{A}_U$
are compact objects of the derived category $D(\mathcal{A})$, see
Cohomology on Sites, Lemma
\ref{sites-cohomology-lemma-quasi-compact-weakly-contractible-compact}.
Since every complex of $\mathcal{A}$-modules is quasi-isomorphic to
a complex whose terms are direct sums of the modules
$j_{U!}\mathcal{A}_U$ (details omitted). Thus we see that
$D(\mathcal{A})$ is generated by its compact objects.

\medskip\noindent
The same argument works for the big pro-\'etale site of $S$.







\section{Generalities on derived completion}
\label{section-derived-completion}

\noindent
We urge the reader to skip this section on a first reading.

\medskip\noindent
The algebra version of this material can be found in
More on Algebra, Section \ref{more-algebra-section-derived-completion}.
Let $\mathcal{O}$ be a sheaf of rings on a site $\mathcal{C}$.
Let $f$ be a global section of $\mathcal{O}$. We denote
$\mathcal{O}_f$ the sheaf associated to the presheaf of localizations
$U \mapsto \mathcal{O}(U)_f$.

\begin{lemma}
\label{lemma-map-twice-localize}
Let $(\mathcal{C}, \mathcal{O})$ be a ringed site. Let $f$ be a global
section of $\mathcal{O}$.
\begin{enumerate}
\item For $L, N \in D(\mathcal{O}_f)$ we have
$R\SheafHom_\mathcal{O}(L, N) = R\SheafHom_{\mathcal{O}_f}(L, N)$.
In particular the two $\mathcal{O}_f$-structures on
$R\SheafHom_\mathcal{O}(L, N)$ agree.
\item For $K \in D(\mathcal{O})$ and
$L \in D(\mathcal{O}_f)$ we have
$$
R\SheafHom_\mathcal{O}(L, K) =
R\SheafHom_{\mathcal{O}_f}(L, R\SheafHom_\mathcal{O}(\mathcal{O}_f, K))
$$
In particular
$R\SheafHom_\mathcal{O}(\mathcal{O}_f,
R\SheafHom_\mathcal{O}(\mathcal{O}_f, K)) =
R\SheafHom_\mathcal{O}(\mathcal{O}_f, K)$.
\item If $g$ is a second global
section of $\mathcal{O}$, then
$$
R\SheafHom_\mathcal{O}(\mathcal{O}_f, R\SheafHom_\mathcal{O}(\mathcal{O}_g, K))
= R\SheafHom_\mathcal{O}(\mathcal{O}_{gf}, K).
$$
\end{enumerate}
\end{lemma}

\begin{proof}
Proof of (1). Let $\mathcal{J}^\bullet$ be a K-injective complex of
$\mathcal{O}_f$-modules representing $N$. By Cohomology on Sites, Lemma
\ref{sites-cohomology-lemma-K-injective-flat} it follows that
$\mathcal{J}^\bullet$ is a K-injective complex of
$\mathcal{O}$-modules as well. Let $\mathcal{F}^\bullet$ be a complex of
$\mathcal{O}_f$-modules representing $L$. Then
$$
R\SheafHom_\mathcal{O}(L, N) =
R\SheafHom_\mathcal{O}(\mathcal{F}^\bullet, \mathcal{J}^\bullet) =
R\SheafHom_{\mathcal{O}_f}(\mathcal{F}^\bullet, \mathcal{J}^\bullet)
$$
by
Modules on Sites, Lemma \ref{sites-modules-lemma-epimorphism-modules}
because $\mathcal{J}^\bullet$ is a K-injective complex of $\mathcal{O}$
and of $\mathcal{O}_f$-modules.

\medskip\noindent
Proof of (2). Let $\mathcal{I}^\bullet$ be a K-injective complex of
$\mathcal{O}$-modules representing $K$.
Then $R\SheafHom_\mathcal{O}(\mathcal{O}_f, K)$ is represented by
$\SheafHom_\mathcal{O}(\mathcal{O}_f, \mathcal{I}^\bullet)$ which is
a K-injective complex of $\mathcal{O}_f$-modules and of
$\mathcal{O}$-modules by
Cohomology on Sites, Lemmas \ref{sites-cohomology-lemma-hom-K-injective} and
\ref{sites-cohomology-lemma-K-injective-flat}.
Let $\mathcal{F}^\bullet$ be a complex of $\mathcal{O}_f$-modules
representing $L$. Then
$$
R\SheafHom_\mathcal{O}(L, K) =
R\SheafHom_\mathcal{O}(\mathcal{F}^\bullet, \mathcal{I}^\bullet) =
R\SheafHom_{\mathcal{O}_f}(\mathcal{F}^\bullet,
\SheafHom_\mathcal{O}(\mathcal{O}_f, \mathcal{I}^\bullet))
$$
by Modules on Sites, Lemma \ref{sites-modules-lemma-adjoint-hom-restrict}
and because $\SheafHom_\mathcal{O}(\mathcal{O}_f, \mathcal{I}^\bullet)$ is a
K-injective complex of $\mathcal{O}_f$-modules.

\medskip\noindent
Proof of (3). This follows from the fact that
$R\SheafHom_\mathcal{O}(\mathcal{O}_g, \mathcal{I}^\bullet)$
is K-injective as a complex of $\mathcal{O}$-modules and the fact that
$\SheafHom_\mathcal{O}(\mathcal{O}_f,
\SheafHom_\mathcal{O}(\mathcal{O}_g, \mathcal{H})) = 
\SheafHom_\mathcal{O}(\mathcal{O}_{gf}, \mathcal{H})$
for all sheaves of $\mathcal{O}$-modules $\mathcal{H}$.
\end{proof}

\noindent
Let $K \in D(\mathcal{O})$. We denote
$T(K, f)$ a derived limit (Derived Categories, Definition
\ref{derived-definition-derived-limit}) of the system
$$
\ldots \to K \xrightarrow{f} K \xrightarrow{f} K
$$
in $D(\mathcal{O})$.

\begin{lemma}
\label{lemma-hom-from-Af}
Let $(\mathcal{C}, \mathcal{O})$ be a ringed site. Let $f$ be a global
section of $\mathcal{O}$. Let $K \in D(\mathcal{O})$.
The following are equivalent
\begin{enumerate}
\item $R\SheafHom_\mathcal{O}(\mathcal{O}_f, K) = 0$,
\item $R\SheafHom_\mathcal{O}(L, K) = 0$ for all $L$ in $D(\mathcal{O}_f)$,
\item $T(K, f) = 0$.
\end{enumerate}
\end{lemma}

\begin{proof}
It is clear that (2) implies (1). The implication (1) $\Rightarrow$ (2)
follows from Lemma \ref{lemma-map-twice-localize}.
A free resolution of the $\mathcal{O}$-module $\mathcal{O}_f$ is given by
$$
0 \to \bigoplus\nolimits_{n \in \mathbf{N}} \mathcal{O} \to
\bigoplus\nolimits_{n \in \mathbf{N}} \mathcal{O}
\to \mathcal{O}_f \to 0
$$
where the first map sends a local section $(x_0, x_1, \ldots)$ to
$(fx_0 - x_1, fx_1 - x_2, \ldots)$ and the second map sends
$(x_0, x_1, \ldots)$ to $x_0 + x_1/f + x_2/f^2 + \ldots$.
Applying $\SheafHom_\mathcal{O}(-, \mathcal{I}^\bullet)$
where $\mathcal{I}^\bullet$ is a K-injective complex of $\mathcal{O}$-modules
representing $K$ we get a short exact sequence of complexes
$$
0 \to \SheafHom_\mathcal{O}(\mathcal{O}_f, \mathcal{I}^\bullet) \to
\prod \mathcal{I}^\bullet \to \prod \mathcal{I}^\bullet \to 0
$$
because $\mathcal{I}^n$ is an injective $\mathcal{O}$-module.
The products are products in $D(\mathcal{O})$, see
Injectives, Lemma \ref{injectives-lemma-derived-products}.
This means that the object $T(K, f)$ is a representative of
$R\SheafHom_\mathcal{O}(\mathcal{O}_f, K)$ in $D(\mathcal{O})$.
Thus the equivalence of (1) and (3).
\end{proof}

\begin{lemma}
\label{lemma-ideal-of-elements-complete-wrt}
Let $(\mathcal{C}, \mathcal{O})$ be a ringed site. Let $K \in D(\mathcal{O})$.
The rule which associates to $U$ the set $\mathcal{I}(U)$
of sections $f \in \mathcal{O}(U)$ such that $T(K|_U, f) = 0$
is a sheaf of ideals in $\mathcal{O}$.
\end{lemma}

\begin{proof}
We will use the results of Lemma \ref{lemma-hom-from-Af} without further
mention. If $f \in \mathcal{I}(U)$, and $g \in \mathcal{O}(U)$, then
$\mathcal{O}_{U, gf}$ is an $\mathcal{O}_{U, f}$-module
hence $R\SheafHom_\mathcal{O}(\mathcal{O}_{U, gf}, K|_U) = 0$, hence
$gf \in \mathcal{I}(U)$. Suppose $f, g \in \mathcal{O}(U)$.
Then there is a short exact sequence
$$
0 \to \mathcal{O}_{U, f + g} \to
\mathcal{O}_{U, f(f + g)} \oplus \mathcal{O}_{U, g(f + g)} \to
\mathcal{O}_{U, gf(f + g)} \to 0
$$
because $f, g$ generate the unit ideal in $\mathcal{O}(U)_{f + g}$.
This follows from
Algebra, Lemma \ref{algebra-lemma-standard-covering}
and the easy fact that the last arrow is surjective.
Because $R\SheafHom_\mathcal{O}( - , K|_U)$ is an exact functor
of triangulated categories the vanishing of
$R\SheafHom_{\mathcal{O}_U}(\mathcal{O}_{U, f(f + g)}, K|_U)$,
$R\SheafHom_{\mathcal{O}_U}(\mathcal{O}_{U, g(f + g)}, K|_U)$, and
$R\SheafHom_{\mathcal{O}_U}(\mathcal{O}_{U, gf(f + g)}, K|_U)$,
implies the vanishing of 
$R\SheafHom_{\mathcal{O}_U}(\mathcal{O}_{U, f + g}, K|_U)$.
We omit the verification of the sheaf condition.
\end{proof}

\noindent
We can make the following definition for any ringed site.

\begin{definition}
\label{definition-derived-complete}
Let $(\mathcal{C}, \mathcal{O})$ be a ringed site.
Let $\mathcal{I} \subset \mathcal{O}$ be a sheaf of ideals.
Let $K \in D(\mathcal{O})$. We say that $K$ is
{\it derived complete with respect to $\mathcal{I}$}
if for every object $U$ of $\mathcal{C}$ and $f \in \mathcal{I}(U)$
the object $T(K|_U, f)$ of $D(\mathcal{O}_U)$ is zero.
\end{definition}

\noindent
It is clear that the full subcategory
$D_{comp}(\mathcal{O}) = D_{comp}(\mathcal{O}, \mathcal{I}) \subset
D(\mathcal{O})$ consisting of derived complete objects
is a saturated triangulated subcategory, see
Derived Categories, Definitions
\ref{derived-definition-triangulated-subcategory} and
\ref{derived-definition-saturated}. This subcategory is preserved
under products and homotopy limits in $D(\mathcal{O})$.
But it is not preserved under countable direct sums in general.

\begin{lemma}
\label{lemma-derived-complete-internal-hom}
Let $(\mathcal{C}, \mathcal{O})$ be a ringed site.
Let $\mathcal{I} \subset \mathcal{O}$ be a sheaf of ideals.
If $K \in D(\mathcal{O})$ and $L \in D_{comp}(\mathcal{O})$, then
$R\SheafHom_\mathcal{O}(K, L) \in D_{comp}(\mathcal{O})$.
\end{lemma}

\begin{proof}
Let $U$ be an object of $\mathcal{C}$ and let $f \in \mathcal{I}(U)$.
Recall that
$$
\Hom_{D(\mathcal{O}_U)}(\mathcal{O}_{U, f}, R\SheafHom_\mathcal{O}(K, L)|_U)
=
\Hom_{D(\mathcal{O}_U)}(
K|_U \otimes_{\mathcal{O}_U}^\mathbf{L} \mathcal{O}_{U, f}, L|_U)
$$
by Cohomology on Sites, Lemma \ref{sites-cohomology-lemma-internal-hom}.
The right hand side is zero by Lemma \ref{lemma-hom-from-Af}
and the relationship between internal hom and actual hom, see
Cohomology on Sites, Lemma \ref{sites-cohomology-lemma-section-RHom-over-U}.
The same vanishing holds for all $U'/U$. Thus the object
$R\SheafHom_{\mathcal{O}_U}(\mathcal{O}_{U, f},
R\SheafHom_\mathcal{O}(K, L)|_U)$ of $D(\mathcal{O}_U)$ has vanishing
$0$th cohomology sheaf (by locus citatus). Similarly for the other
cohomology sheaves, i.e., $R\SheafHom_{\mathcal{O}_U}(\mathcal{O}_{U, f},
R\SheafHom_\mathcal{O}(K, L)|_U)$ is zero in $D(\mathcal{O}_U)$.
By Lemma \ref{lemma-hom-from-Af} we conclude.
\end{proof}

\begin{lemma}
\label{lemma-restriction-derived-complete}
Let $\mathcal{C}$ be a site. Let $\mathcal{O} \to \mathcal{O}'$
be a homomorphism of sheaves of rings. Let $\mathcal{I} \subset \mathcal{O}$
be a sheaf of ideals. The inverse image of $D_{comp}(\mathcal{O}, \mathcal{I})$
under the restriction functor $D(\mathcal{O}') \to D(\mathcal{O})$ is
$D_{comp}(\mathcal{O}', \mathcal{I}\mathcal{O}')$.
\end{lemma}

\begin{proof}
Using Lemma \ref{lemma-ideal-of-elements-complete-wrt}
we see that $K' \in D(\mathcal{O}')$ is in
$D_{comp}(\mathcal{O}', \mathcal{I}\mathcal{O}')$
if and only if $T(K'|_U, f)$ is zero for every local section
$f \in \mathcal{I}(U)$. Observe that the cohomology sheaves of
$T(K'|_U, f)$ are computed in the category of abelian sheaves,
so it doesn't matter whether we think of $f$ as a section of
$\mathcal{O}$ or take the image of $f$ as a section of $\mathcal{O}'$.
The lemma follows immediately from this and the
definition of derived complete objects.
\end{proof}

\begin{lemma}
\label{lemma-pushforward-derived-complete}
Let $f : (\Sh(\mathcal{D}), \mathcal{O}') \to (\Sh(\mathcal{C}), \mathcal{O})$
be a morphism of ringed topoi. Let $\mathcal{I} \subset \mathcal{O}$
and $\mathcal{I}' \subset \mathcal{O}'$ be sheaves of ideals such
that $f^\sharp$ sends $f^{-1}\mathcal{I}$ into $\mathcal{I}'$.
Then $Rf_*$ sends $D_{comp}(\mathcal{O}', \mathcal{I}')$
into $D_{comp}(\mathcal{O}, \mathcal{I})$.
\end{lemma}

\begin{proof}
We may assume $f$ is given by a morphism of ringed sites corresponding
to a continuous functor $\mathcal{C} \to \mathcal{D}$
(Modules on Sites, Lemma
\ref{sites-modules-lemma-morphism-ringed-topoi-comes-from-morphism-ringed-sites}
).
Let $U$ be an object of $\mathcal{C}$ and let $g$ be a section of
$\mathcal{I}$ over $U$. We have to show that
$\Hom_{D(\mathcal{O}_U)}(\mathcal{O}_{U, g}, Rf_*K|_U) = 0$
whenever $K$ is derived complete with respect to $\mathcal{I}'$.
Namely, by Cohomology on Sites, Lemma
\ref{sites-cohomology-lemma-section-RHom-over-U}
this, applied to all objects over $U$ and all shifts of $K$,
will imply that $R\SheafHom_{\mathcal{O}_U}(\mathcal{O}_{U, g}, Rf_*K|_U)$
is zero, which implies that $T(Rf_*K|_U, g)$ is zero
(Lemma \ref{lemma-hom-from-Af}) which is what we have to show
(Definition \ref{definition-derived-complete}).
Let $V$ in $\mathcal{D}$ be the image of $U$. Then
$$
\Hom_{D(\mathcal{O}_U)}(\mathcal{O}_{U, g}, Rf_*K|_U) =
\Hom_{D(\mathcal{O}'_V)}(\mathcal{O}'_{V, g'}, K|_V) = 0
$$
where $g' = f^\sharp(g) \in \mathcal{I}'(V)$. The second equality
because $K$ is derived complete and the first equality because
the derived pullback of $\mathcal{O}_{U, g}$ is $\mathcal{O}'_{V, g'}$
and
Cohomology on Sites, Lemma \ref{sites-cohomology-lemma-adjoint}.
\end{proof}

\noindent
The following lemma is the simplest case where one has derived completion.

\begin{lemma}
\label{lemma-derived-completion}
Let $(\mathcal{C}, \mathcal{O})$ be a ringed on a site. Let $f_1, \ldots, f_r$
be global sections of $\mathcal{O}$. Let $\mathcal{I} \subset \mathcal{O}$ be
the ideal sheaf generated by $f_1, \ldots, f_r$.
Then the inclusion functor $D_{comp}(\mathcal{O}) \to D(\mathcal{O})$
has a left adjoint, i.e., given any object $K$ of $D(\mathcal{O})$
there exists a map $K \to K^\wedge$ with $K^\wedge$ in $D_{comp}(\mathcal{O})$
such that the map
$$
\Hom_{D(\mathcal{O})}(K^\wedge, E) \longrightarrow \Hom_{D(\mathcal{O})}(K, E)
$$
is bijective whenever $E$ is in $D_{comp}(\mathcal{O})$. In fact
we have
$$
K^\wedge =
R\SheafHom_\mathcal{O}
(\mathcal{O} \to \prod\nolimits_{i_0} \mathcal{O}_{f_{i_0}} \to
\prod\nolimits_{i_0 < i_1} \mathcal{O}_{f_{i_0}f_{i_1}} \to
\ldots \to \mathcal{O}_{f_1\ldots f_r}, K)
$$
functorially in $K$.
\end{lemma}

\begin{proof}
Define $K^\wedge$ by the last displayed formula of the lemma.
There is a map of complexes
$$
(\mathcal{O} \to \prod\nolimits_{i_0} \mathcal{O}_{f_{i_0}} \to
\prod\nolimits_{i_0 < i_1} \mathcal{O}_{f_{i_0}f_{i_1}} \to
\ldots \to \mathcal{O}_{f_1\ldots f_r}) \longrightarrow \mathcal{O}
$$
which induces a map $K \to K^\wedge$. It suffices to prove that
$K^\wedge$ is derived complete and that $K \to K^\wedge$ is an
isomorphism if $K$ is derived complete.

\medskip\noindent
Let $f$ be a global section of $\mathcal{O}$.
By Lemma \ref{lemma-map-twice-localize} the object
$R\SheafHom_\mathcal{O}(\mathcal{O}_f, K^\wedge)$
is equal to
$$
R\SheafHom_\mathcal{O}(
(\mathcal{O}_f \to \prod\nolimits_{i_0} \mathcal{O}_{ff_{i_0}} \to
\prod\nolimits_{i_0 < i_1} \mathcal{O}_{ff_{i_0}f_{i_1}} \to
\ldots \to \mathcal{O}_{ff_1\ldots f_r}), K)
$$
If $f = f_i$ for some $i$, then $f_1, \ldots, f_r$ generate the
unit ideal in $\mathcal{O}_f$, hence the extended alternating
{\v C}ech complex
$$
\mathcal{O}_f \to \prod\nolimits_{i_0} \mathcal{O}_{ff_{i_0}} \to
\prod\nolimits_{i_0 < i_1} \mathcal{O}_{ff_{i_0}f_{i_1}} \to
\ldots \to \mathcal{O}_{ff_1\ldots f_r}
$$
is zero (even homotopic to zero). In this way we see that $K^\wedge$
is derived complete.

\medskip\noindent
If $K$ is derived complete, then $R\SheafHom_\mathcal{O}(\mathcal{O}_f, K)$
is zero for all $f = f_{i_0} \ldots f_{i_p}$, $p \geq 0$. Thus
$K \to K^\wedge$ is an isomorphism in $D(\mathcal{O})$.
\end{proof}

\noindent
Next we explain why derived completion is a completion.

\begin{lemma}
\label{lemma-derived-completion-koszul}
Let $(\mathcal{C}, \mathcal{O})$ be a ringed on a site. Let $f_1, \ldots, f_r$
be global sections of $\mathcal{O}$. Let $\mathcal{I} \subset \mathcal{O}$ be
the ideal sheaf generated by $f_1, \ldots, f_r$. Let $K \in D(\mathcal{O})$.
The derived completion $K^\wedge$ of Lemma \ref{lemma-derived-completion}
is given by the formula
$$
K^\wedge = R\lim K \otimes^\mathbf{L}_\mathcal{O} K_n
$$
where $K_n = K(\mathcal{O}, f_1^n, \ldots, f_r^n)$
is the Koszul complex on $f_1^n, \ldots, f_r^n$ over $\mathcal{O}$.
\end{lemma}

\begin{proof}
In More on Algebra, Lemma
\ref{more-algebra-lemma-extended-alternating-Cech-is-colimit-koszul}
we have seen that the extended alternating {\v C}ech complex
$$
\mathcal{O} \to \prod\nolimits_{i_0} \mathcal{O}_{f_{i_0}} \to
\prod\nolimits_{i_0 < i_1} \mathcal{O}_{f_{i_0}f_{i_1}} \to
\ldots \to \mathcal{O}_{f_1\ldots f_r}
$$
is a colimit of the Koszul complexes
$K^n = K(\mathcal{O}, f_1^n, \ldots, f_r^n)$ sitting in
degrees $0, \ldots, r$. Note that $K^n$ is a finite chain complex
of finite free $\mathcal{O}$-modules with dual
$\SheafHom_\mathcal{O}(K^n, \mathcal{O}) = K_n$ where $K_n$ is the Koszul
cochain complex sitting in degrees $-r, \ldots, 0$ (as usual). By
Lemma \ref{lemma-derived-completion}
the functor $E \mapsto E^\wedge$ is gotten by taking
$R\SheafHom$ from the extended alternating {\v C}ech complex into $E$:
$$
E^\wedge = R\SheafHom(\colim K^n, E)
$$
This is equal to $R\lim (E \otimes_\mathcal{O}^\mathbf{L} K_n)$
by
Cohomology on Sites, Lemma \ref{sites-cohomology-lemma-colim-and-lim-of-duals}.
\end{proof}

\begin{lemma}
\label{lemma-all-rings}
There exist a way to construct
\begin{enumerate}
\item for every pair $(A, I)$ consisting of a ring $A$ and a finitely
generated ideal $I \subset A$ a complex $K(A, I)$ of $A$-modules,
\item a map $K(A, I) \to A$ of complexes of $A$-modules,
\item for every ring map $A \to B$ and finitely generated ideal $I \subset A$
a map of complexes $K(A, I) \to K(B, IB)$,
\end{enumerate}
such that
\begin{enumerate}
\item[(a)] for $A \to B$ and $I \subset A$ finitely generated the diagram
$$
\xymatrix{
K(A, I) \ar[r] \ar[d] & A \ar[d] \\
K(B, IB) \ar[r] & B
}
$$
commutes,
\item[(b)] for $A \to B \to C$ and $I \subset A$ finitely generated
the composition of the maps
$K(A, I) \to K(B, IB) \to K(C, IC)$ is the map $K(A, I) \to K(C, IC)$.
\item[(c)] for $A \to B$ and a finitely generated ideal $I \subset A$
the induced map $K(A, I) \otimes_A^\mathbf{L} B \to K(B, IB)$
is an isomorphism in $D(B)$, and
\item[(d)] if $I = (f_1, \ldots, f_r) \subset A$ then there is a commutative
diagram
$$
\xymatrix{
(A \to \prod\nolimits_{i_0} A_{f_{i_0}} \to
\prod\nolimits_{i_0 < i_1} A_{f_{i_0}f_{i_1}} \to
\ldots \to A_{f_1\ldots f_r}) \ar[r] \ar[d] &  K(A, I) \ar[d] \\
A \ar[r]^1 & A
}
$$
in $D(A)$ whose horizontal arrows are isomorphisms.
\end{enumerate}
\end{lemma}

\begin{proof}
Let $S$ be the set of rings $A_0$ of the form
$A_0 = \mathbf{Z}[x_1, \ldots, x_n]/J$.
Every finite type $\mathbf{Z}$-algebra is isomorphic to
an element of $S$. Let $\mathcal{A}_0$ be the category whose objects
are pairs $(A_0, I_0)$ where $A_0 \in S$ and $I_0 \subset A_0$
is an ideal and whose morphisms $(A_0, I_0) \to (B_0, J_0)$ are
ring maps $\varphi : A_0 \to B_0$ such that $J_0 = \varphi(I_0)B_0$.

\medskip\noindent
Suppose we can construct $K(A_0, I_0) \to A_0$ functorially for
objects of $\mathcal{A}_0$ having properties (a), (b), (c), and (d).
Then we take
$$
K(A, I) = \colim_{\varphi : (A_0, I_0) \to (A, I)} K(A_0, I_0)
$$
where the colimit is over ring maps $\varphi : A_0 \to A$ such
that $\varphi(I_0)A = I$ with $(A_0, I_0)$ in $\mathcal{A}_0$.
A morphism between $(A_0, I_0) \to (A, I)$ and $(A_0', I_0') \to (A, I)$
are given by maps $(A_0, I_0) \to (A_0', I_0')$ in $\mathcal{A}_0$
commuting with maps to $A$.
The category of these $(A_0, I_0) \to (A, I)$ is filtered
(details omitted). Moreover, $\colim_{\varphi : (A_0, I_0) \to (A, I)} A_0 = A$
so that $K(A, I)$ is a complex of $A$-modules.
Finally, given $\varphi : A \to B$ and $I \subset A$
for every $(A_0, I_0) \to (A, I)$ in the colimit, the composition
$(A_0, I_0) \to (B, IB)$ lives in the colimit for $(B, IB)$.
In this way we get a map on colimits. Properties (a), (b), (c), and (d)
follow readily from this and the corresponding
properties of the complexes $K(A_0, I_0)$.

\medskip\noindent
Endow $\mathcal{C}_0 = \mathcal{A}_0^{opp}$ with the chaotic topology.
We equip $\mathcal{C}_0$ with the sheaf of rings
$\mathcal{O} : (A, I) \mapsto A$. The ideals $I$ fit together to give a
sheaf of ideals $\mathcal{I} \subset \mathcal{O}$.
Choose an injective resolution $\mathcal{O} \to \mathcal{J}^\bullet$.
Consider the object
$$
\mathcal{F}^\bullet = \bigcup\nolimits_n \mathcal{J}^\bullet[\mathcal{I}^n]
$$
Let $U = (A, I) \in \Ob(\mathcal{C}_0)$.
Since the topology in $\mathcal{C}_0$ is chaotic, the value
$\mathcal{J}^\bullet(U)$ is a resolution of $A$ by injective
$A$-modules. Hence the value $\mathcal{F}^\bullet(U)$ is an
object of $D(A)$ representing the image of $R\Gamma_I(A)$ in $D(A)$, see
Dualizing Complexes, Section \ref{dualizing-section-local-cohomology}.
Choose a complex of $\mathcal{O}$-modules $\mathcal{K}^\bullet$
and a commutative diagram
$$
\xymatrix{
\mathcal{O} \ar[r] & \mathcal{J}^\bullet \\
\mathcal{K}^\bullet \ar[r] \ar[u] & \mathcal{F}^\bullet \ar[u]
}
$$
where the horizontal arrows are quasi-isomorphisms. This is possible
by the construction of the derived category $D(\mathcal{O})$.
Set $K(A, I) = \mathcal{K}^\bullet(U)$ where $U = (A, I)$.
Properties (a) and (b) are clear and properties (c) and (d)
follow from Dualizing Complexes, Lemmas
\ref{dualizing-lemma-compute-local-cohomology-noetherian} and
\ref{dualizing-lemma-local-cohomology-change-rings}.
\end{proof}

\begin{lemma}
\label{lemma-global-extended-cech-complex}
Let $(\mathcal{C}, \mathcal{O})$ be a ringed site. Let
$\mathcal{I} \subset \mathcal{O}$ be a finite type sheaf of ideals.
There exists a map $K \to \mathcal{O}$ in $D(\mathcal{O})$
such that for every $U \in \Ob(\mathcal{C})$ such that
$\mathcal{I}|_U$ is generated by $f_1, \ldots, f_r \in \mathcal{I}(U)$
there is an isomorphism
$$
(\mathcal{O}_U \to \prod\nolimits_{i_0} \mathcal{O}_{U, f_{i_0}} \to
\prod\nolimits_{i_0 < i_1} \mathcal{O}_{U, f_{i_0}f_{i_1}} \to
\ldots \to \mathcal{O}_{U, f_1\ldots f_r}) \longrightarrow K|_U
$$
compatible with maps to $\mathcal{O}_U$.
\end{lemma}

\begin{proof}
Let $\mathcal{C}' \subset \mathcal{C}$ be the full subcategory
of objects $U$ such that $\mathcal{I}|_U$ is generated by
finitely many sections. Then $\mathcal{C}' \to \mathcal{C}$
is a special cocontinuous functor
(Sites, Definition \ref{sites-definition-special-cocontinuous-functor}).
Hence it suffices to work with $\mathcal{C}'$, see
Sites, Lemma \ref{sites-lemma-equivalence}.
In other words we may assume that for every
object $U$ of $\mathcal{C}$ there exists a finitely generated
ideal $I \subset \mathcal{I}(U)$ such that
$\mathcal{I}|_U = \Im(I \otimes \mathcal{O}_U \to \mathcal{O}_U)$.
We will say that $I$ generates $\mathcal{I}|_U$.
Warning: We do not know that $\mathcal{I}(U)$ is a finitely generated
ideal in $\mathcal{O}(U)$.

\medskip\noindent
Let $U$ be an object and $I \subset \mathcal{O}(U)$ a finitely
generated ideal which generates $\mathcal{I}|_U$.
On the category $\mathcal{C}/U$ consider the complex of presheaves
$$
K_{U, I}^\bullet : U'/U \longmapsto K(\mathcal{O}(U'), I\mathcal{O}(U'))
$$
with $K(-, -)$ as in Lemma \ref{lemma-all-rings}.
We claim that the sheafification of this is independent of
the choice of $I$. Indeed, if $I' \subset \mathcal{O}(U)$
is a finitely generated ideal which also generates $\mathcal{I}|_U$, then
there exists a covering $\{U_j \to U\}$ such that
$I\mathcal{O}(U_j) = I'\mathcal{O}(U_j)$. (Hint: this works because
both $I$ and $I'$ are finitely generated and generate $\mathcal{I}|_U$.)
Hence $K_{U, I}^\bullet$ and $K_{U, I'}^\bullet$ are the {\it same}
for any object lying over one of the $U_j$. The statement
on sheafifications follows. Denote $K_U^\bullet$ the common value.

\medskip\noindent
The independence of choice of $I$ also shows that
$K_U^\bullet|_{\mathcal{C}/U'} = K_{U'}^\bullet$
whenever we are given a morphism
$U' \to U$ and hence a localization morphism
$\mathcal{C}/U' \to \mathcal{C}/U$. Thus the complexes
$K_U^\bullet$ glue to give a single well defined complex $K^\bullet$
of $\mathcal{O}$-modules. The existence of the map $K^\bullet \to \mathcal{O}$
and the quasi-isomorphism of the lemma follow immediately from
the corresponding properties of the complexes $K(-, -)$ in
Lemma \ref{lemma-all-rings}.
\end{proof}

\begin{proposition}
\label{proposition-derived-completion}
Let $(\mathcal{C}, \mathcal{O})$ be a ringed site.
Let $\mathcal{I} \subset \mathcal{O}$ be a finite type sheaf of
ideals. There exists a left adjoint to the inclusion
functor $D_{comp}(\mathcal{O}) \to D(\mathcal{O})$.
\end{proposition}

\begin{proof}
Let $K \to \mathcal{O}$ in $D(\mathcal{O})$ be as constructed in
Lemma \ref{lemma-global-extended-cech-complex}. Let $E \in D(\mathcal{O})$.
Then $E^\wedge = R\SheafHom(K, E)$ together with the map $E \to E^\wedge$
will do the job. Namely, locally on the site $\mathcal{C}$ we
recover the adjoint of Lemma \ref{lemma-derived-completion}.
This shows that $E^\wedge$ is always derived complete and that
$E \to E^\wedge$ is an isomorphism if $E$ is derived complete.
\end{proof}

\begin{remark}[Comparison with completion]
\label{remark-compare-with-completion}
Let $(\mathcal{C}, \mathcal{O})$ be a ringed site.
Let $\mathcal{I} \subset \mathcal{O}$ be a finite type sheaf of
ideals. Let $K \mapsto K^\wedge$ be the derived completion functor
of Proposition \ref{proposition-derived-completion}.
For any $n \geq 1$ the object
$K \otimes_\mathcal{O}^\mathbf{L} \mathcal{O}/\mathcal{I}^n$
is derived complete as it is annihilated by powers of
local sections of $\mathcal{I}$. Hence there is a canonical factorization
$$
K \to K^\wedge \to K \otimes_\mathcal{O}^\mathbf{L} \mathcal{O}/\mathcal{I}^n
$$
of the canonical map
$K \to K \otimes_\mathcal{O}^\mathbf{L} \mathcal{O}/\mathcal{I}^n$.
These maps are compatible for varying $n$ and we obtain a comparison map
$$
K^\wedge
\longrightarrow
R\lim \left(K \otimes_\mathcal{O}^\mathbf{L} \mathcal{O}/\mathcal{I}^n\right)
$$
The right hand side is more recognizable as a kind of completion.
In general this comparison map is not an isomorphism.
\end{remark}

\begin{remark}[Localization and derived completion]
\label{remark-localization-and-completion}
Let $(\mathcal{C}, \mathcal{O})$ be a ringed site.
Let $\mathcal{I} \subset \mathcal{O}$ be a finite type sheaf of
ideals. Let $K \mapsto K^\wedge$ be the derived completion functor
of Proposition \ref{proposition-derived-completion}. It follows
from the construction in the proof of the proposition that $K^\wedge|_U$
is the derived completion of $K|_U$ for any $U \in \Ob(\mathcal{C})$.
But we can also prove this as follows. From the definition
of derived complete objects it follows that $K^\wedge|_U$ is derived complete.
Thus we obtain a canonical map $a : (K|_U)^\wedge \to K^\wedge|_U$.
On the other hand, if $E$ is a derived complete object of
$D(\mathcal{O}_U)$, then $Rj_*E$ is a derived complete object of
$D(\mathcal{O})$ by Lemma \ref{lemma-pushforward-derived-complete}.
Here $j$ is the localization morphism
(Modules on Sites, Section \ref{sites-modules-section-localize}).
Hence we also obtain a canonical
map $b : K^\wedge \to Rj_*((K|_U)^\wedge)$. We omit the (formal) verification
that the adjoint of $b$ is the inverse of $a$.
\end{remark}

\begin{remark}[Completed tensor product]
\label{remark-completed-tensor-product}
Let $(\mathcal{C}, \mathcal{O})$ be a ringed site. Let
$\mathcal{I} \subset \mathcal{O}$ be a finite type sheaf of ideals. 
Denote $K \mapsto K^\wedge$ the adjoint of
Proposition \ref{proposition-derived-completion}.
Then we set
$$
K \otimes^\wedge_\mathcal{O} L = (K \otimes_\mathcal{O}^\mathbf{L} L)^\wedge
$$
This {\it completed tensor product} defines a functor
$D_{comp}(\mathcal{O}) \times D_{comp}(\mathcal{O}) \to D_{comp}(\mathcal{O})$
such that we have
$$
\Hom_{D_{comp}(\mathcal{O})}(K, R\SheafHom_\mathcal{O}(L, M))
=
\Hom_{D_{comp}(\mathcal{O})}(K \otimes_\mathcal{O}^\wedge L, M)
$$
for $K, L, M \in D_{comp}(\mathcal{O})$. Note that
$R\SheafHom_\mathcal{O}(L, M) \in D_{comp}(\mathcal{O})$ by
Lemma \ref{lemma-derived-complete-internal-hom}.
\end{remark}

\begin{lemma}
\label{lemma-map-identifies-koszul-and-cech-complexes}
Let $\mathcal{C}$ be a site.
Assume $\varphi : \mathcal{O} \to \mathcal{O}'$ is a flat homomorphism
of sheaves of rings. Let $f_1, \ldots, f_r$ be global sections
of $\mathcal{O}$ such that
$\mathcal{O}/(f_1, \ldots, f_r) \cong \mathcal{O}'/(f_1, \ldots, f_r)$.
Then the map of extended alternating {\v C}ech complexes
$$
\xymatrix{
\mathcal{O} \to
\prod_{i_0} \mathcal{O}_{f_{i_0}} \to
\prod_{i_0 < i_1} \mathcal{O}_{f_{i_0}f_{i_1}} \to \ldots \to
\mathcal{O}_{f_1\ldots f_r} \ar[d] \\
\mathcal{O}' \to
\prod_{i_0} \mathcal{O}'_{f_{i_0}} \to
\prod_{i_0 < i_1} \mathcal{O}'_{f_{i_0}f_{i_1}} \to \ldots \to
\mathcal{O}'_{f_1\ldots f_r}
}
$$
is a quasi-isomorphism.
\end{lemma}

\begin{proof}
Observe that the second complex is the tensor product of the first
complex with $\mathcal{O}'$. We can write the first extended
alternating {\v C}ech complex as a colimit of the Koszul complexes
$K_n = K(\mathcal{O}, f_1^n, \ldots, f_r^n)$, see
More on Algebra, Lemma
\ref{more-algebra-lemma-extended-alternating-Cech-is-colimit-koszul}.
Hence it suffices to prove $K_n \to K_n \otimes_\mathcal{O} \mathcal{O}'$
is a quasi-isomorphism. Since $\mathcal{O} \to \mathcal{O}'$ is flat
it suffices to show that $H^i \to H^i \otimes_\mathcal{O} \mathcal{O}'$
is an isomorphism where $H^i$ is the $i$th cohomology sheaf
$H^i = H^i(K_n)$. These sheaves are annihilated by $f_1^n, \ldots, f_r^n$, see
More on Algebra, Lemma \ref{more-algebra-lemma-homotopy-koszul}.
Thus it suffices to show that
$\mathcal{O}/(f_1^n, \ldots, f_r^n) \to \mathcal{O}'/(f_1^n, \ldots, f_r^n)$
is an isomorphism. Equivalently, we will show that
$\mathcal{O}/(f_1, \ldots, f_r)^n \to \mathcal{O}'/(f_1, \ldots, f_r)^n$
is an isomorphism for all $n$. This holds for $n = 1$ by assumption.
It follows for all $n$ by induction using
Modules on Sites, Lemma \ref{sites-modules-lemma-flat-over-thickening}
applied to the ring map
$\mathcal{O}/(f_1, \ldots, f_r)^{n + 1} \to \mathcal{O}/(f_1, \ldots, f_r)^n$
and the module $\mathcal{O}'/(f_1, \ldots, f_r)^{n + 1}$.
\end{proof}

\begin{lemma}
\label{lemma-restriction-derived-complete-equivalence}
Let $\mathcal{C}$ be a site. Let $\mathcal{O} \to \mathcal{O}'$ be a
homomorphism of sheaves of rings. Let $\mathcal{I} \subset \mathcal{O}$
be a finite type sheaf of ideals.
If $\mathcal{O} \to \mathcal{O}'$ is flat and
$\mathcal{O}/\mathcal{I} \cong \mathcal{O}'/\mathcal{I}\mathcal{O}'$,
then the restriction functor $D(\mathcal{O}') \to D(\mathcal{O})$
induces an equivalence
$D_{comp}(\mathcal{O}', \mathcal{I}\mathcal{O}') \to
D_{comp}(\mathcal{O}, \mathcal{I})$.
\end{lemma}

\begin{proof}
Lemma \ref{lemma-pushforward-derived-complete} implies
restriction $r : D(\mathcal{O}') \to D(\mathcal{O})$
sends $D_{comp}(\mathcal{O}', \mathcal{I}\mathcal{O}')$
into $D_{comp}(\mathcal{O}, \mathcal{I})$. We will construct a
quasi-inverse $E \mapsto E'$.

\medskip\noindent
Let $K \to \mathcal{O}$ be the morphism of $D(\mathcal{O})$
constructed in Lemma \ref{lemma-global-extended-cech-complex}. 
Set $K' = K \otimes_\mathcal{O}^\mathbf{L} \mathcal{O}'$ in $D(\mathcal{O}')$.
Then $K' \to \mathcal{O}'$ is a map in $D(\mathcal{O}')$ which
satisfies the conclusions of Lemma \ref{lemma-global-extended-cech-complex}
with respect to $\mathcal{I}' = \mathcal{I}\mathcal{O}'$.
The map $K \to r(K')$ is a quasi-isomorphism by
Lemma \ref{lemma-map-identifies-koszul-and-cech-complexes}.
Now, for $E \in D_{comp}(\mathcal{O}, \mathcal{I})$ we set
$$
E' = R\SheafHom_\mathcal{O}(r(K'), E)
$$
viewed as an object in $D(\mathcal{O}')$ using the $\mathcal{O}'$-module
structure on $K'$. Since $E$ is derived complete
we have $E = R\SheafHom_\mathcal{O}(K, E)$, see
proof of Proposition \ref{proposition-derived-completion}.
On the other hand, since $K \to r(K')$ is an isomorphism in
we see that there is an isomorphism
$E \to r(E')$ in $D(\mathcal{O})$. To finish the proof we
have to show that, if $E = r(M')$ for an object $M'$ of
$D_{comp}(\mathcal{O}', \mathcal{I}')$, then
$E' \cong M'$. To get a map we use
$$
M' = R\SheafHom_{\mathcal{O}'}(\mathcal{O}', M') \to
R\SheafHom_\mathcal{O}(r(\mathcal{O}'), r(M')) \to
R\SheafHom_\mathcal{O}(r(K'), r(M')) = E'
$$
where the second arrow uses the map $K' \to \mathcal{O}'$.
To see that this is an isomorphism, one shows that $r$ applied
to this arrow is the same as the isomorphism $E \to r(E')$ above.
Details omitted.
\end{proof}

\begin{lemma}
\label{lemma-pushforward-derived-complete-adjoint}
Let $f : (\Sh(\mathcal{D}), \mathcal{O}') \to (\Sh(\mathcal{C}), \mathcal{O})$
be a morphism of ringed topoi. Let $\mathcal{I} \subset \mathcal{O}$
and $\mathcal{I}' \subset \mathcal{O}'$ 
be finite type sheaves of ideals such that $f^\sharp$ sends
$f^{-1}\mathcal{I}$ into $\mathcal{I}'$.
Then $Rf_*$ sends $D_{comp}(\mathcal{O}', \mathcal{I}')$
into $D_{comp}(\mathcal{O}, \mathcal{I})$ and has a left adjoint
$Lf_{comp}^*$ which is $Lf^*$ followed by derived completion.
\end{lemma}

\begin{proof}
The first statement we have seen in
Lemma \ref{lemma-pushforward-derived-complete}.
Note that the second statement makes sense as we have a derived
completion functor $D(\mathcal{O}') \to D_{comp}(\mathcal{O}', \mathcal{I}')$
by Proposition \ref{proposition-derived-completion}.
OK, so now let $K \in D_{comp}(\mathcal{O}, \mathcal{I})$
and $M \in D_{comp}(\mathcal{O}', \mathcal{I}')$. Then we have
$$
\Hom(K, Rf_*M) = \Hom(Lf^*K, M) = \Hom(Lf_{comp}^*K, M)
$$
by the universal property of derived completion.
\end{proof}

\begin{lemma}
\label{lemma-pushforward-commutes-with-derived-completion}
\begin{reference}
Generalization of \cite[Lemma 6.5.9 (2)]{BS}. Compare with
\cite[Theorem 6.5]{HL-P} in the setting of quasi-coherent modules
and morphisms of (derived) algebraic stacks.
\end{reference}
Let $f : (\Sh(\mathcal{D}), \mathcal{O}') \to (\Sh(\mathcal{C}), \mathcal{O})$
be a morphism of ringed topoi. Let $\mathcal{I} \subset \mathcal{O}$
be a finite type sheaf of ideals. Let $\mathcal{I}' \subset \mathcal{O}'$
be the ideal generated by $f^\sharp(f^{-1}\mathcal{I})$.
Then $Rf_*$ commutes with derived completion, i.e.,
$Rf_*(K^\wedge) = (Rf_*K)^\wedge$.
\end{lemma}

\begin{proof}
By Proposition \ref{proposition-derived-completion} the derived completion
functors exist. By Lemma \ref{lemma-pushforward-derived-complete} the object
$Rf_*(K^\wedge)$ is derived complete, and hence we obtain a canonical map
$(Rf_*K)^\wedge \to Rf_*(K^\wedge)$ by the universal property of derived
completion. We may check this map is an isomorphism locally on $\mathcal{C}$.
Thus, since derived completion commutes with localization
(Remark \ref{remark-localization-and-completion}) we may assume
that $\mathcal{I}$ is generated by global sections $f_1, \ldots, f_r$.
Then $\mathcal{I}'$ is generated by $g_i = f^\sharp(f_i)$. By
Lemma \ref{lemma-derived-completion-koszul}
we have to prove that
$$
R\lim \left(
Rf_*K \otimes^\mathbf{L}_\mathcal{O} K(\mathcal{O}, f_1^n, \ldots, f_r^n)
\right)
=
Rf_*\left(
R\lim
K \otimes^\mathbf{L}_{\mathcal{O}'} K(\mathcal{O}', g_1^n, \ldots, g_r^n)
\right)
$$
Because $Rf_*$ commutes with $R\lim$
(Cohomology on Sites, Lemma
\ref{sites-cohomology-lemma-Rf-commutes-with-Rlim})
it suffices to prove that
$$
Rf_*K \otimes^\mathbf{L}_\mathcal{O} K(\mathcal{O}, f_1^n, \ldots, f_r^n) =
Rf_*\left(
K \otimes^\mathbf{L}_{\mathcal{O}'} K(\mathcal{O}', g_1^n, \ldots, g_r^n)
\right)
$$
This follows from the projection formula (Cohomology on Sites, Lemma
\ref{sites-cohomology-lemma-projection-formula}) and the fact that
$Lf^*K(\mathcal{O}, f_1^n, \ldots, f_r^n) =
K(\mathcal{O}', g_1^n, \ldots, g_r^n)$.
\end{proof}

\begin{lemma}
\label{lemma-formal-functions-general}
Let $A$ be a ring and let $I \subset A$ be a finitely generated ideal.
Let $\mathcal{C}$ be a site and let $\mathcal{O}$ be a sheaf
of $A$-algebras. Let $\mathcal{F}$ be a sheaf of $\mathcal{O}$-modules.
Then we have
$$
R\Gamma(\mathcal{C}, \mathcal{F})^\wedge =
R\Gamma(\mathcal{C}, \mathcal{F}^\wedge)
$$
in $D(A)$ where $\mathcal{F}^\wedge$ is the derived
completion of $\mathcal{F}$ with respect to $I\mathcal{O}$ and on the
left hand wide we have the derived completion with respect to $I$.
This produces two spectral sequences
$$
E_2^{i, j} = H^i(H^j(\mathcal{C}, \mathcal{F})^\wedge)
\quad\text{and}\quad
E_2^{p, q} = H^p(\mathcal{C}, H^q(\mathcal{F}^\wedge))
$$
both converging to
$H^*(R\Gamma(\mathcal{C}, \mathcal{F})^\wedge) =
H^*(\mathcal{C}, \mathcal{F}^\wedge)$
\end{lemma}

\begin{proof}
Apply Lemma \ref{lemma-pushforward-commutes-with-derived-completion}
to the morphism of ringed topoi $(\mathcal{C}, \mathcal{O}) \to (pt, A)$
and take cohomology to get the first statement. The second spectral sequence
is just the Leray spectral sequence for this morphism, see
Cohomology on Sites, Lemma \ref{sites-cohomology-lemma-Leray}.
The first spectral sequence is the spectral sequence of
More on Algebra, Example
\ref{more-algebra-example-derived-completion-spectral-sequence}
applied to $R\Gamma(\mathcal{C}, \mathcal{F})^\wedge$.
\end{proof}

\begin{remark}
\label{remark-local-calculation-derived-completion}
Let $(\mathcal{C}, \mathcal{O})$ be a ringed site.
Let $\mathcal{I} \subset \mathcal{O}$ be a finite type sheaf of
ideals. Let $K \mapsto K^\wedge$ be the derived completion of
Proposition \ref{proposition-derived-completion}.
Let $U \in \Ob(\mathcal{C})$ be an object such that $\mathcal{I}$
is generated as an ideal sheaf by $f_1, \ldots, f_r \in \mathcal{I}(U)$.
Set $A = \mathcal{O}(U)$ and $I = (f_1, \ldots, f_r) \subset A$.
Warning: it may not be the case that $I = \mathcal{I}(U)$.
Then we have
$$
R\Gamma(U, K^\wedge) = R\Gamma(U, K)^\wedge
$$
where the right hand side is the derived completion of
the object $R\Gamma(U, K)$ of $D(A)$ with respect to $I$.
This is true because derived completion commutes with localization
(Remark \ref{remark-localization-and-completion}) and
Lemma \ref{lemma-formal-functions-general}.
\end{remark}








\section{Application to theorem on formal functions}
\label{section-formal-functions}

\noindent
We interrupt the flow of the exposition to talk a little bit about
derived completion in the setting of quasi-coherent modules on schemes
and to use this to give a somewhat different proof of the theorem on
formal functions. We give some pointers to the literature in
Remark \ref{remark-references}.

\medskip\noindent
Lemma \ref{lemma-pushforward-commutes-with-derived-completion} is a
(very formal) derived version of the theorem on formal functions
(Cohomology of Schemes, Theorem \ref{coherent-theorem-formal-functions}).
To make this more explicit, suppose $f : X \to S$ is a morphism of schemes,
$\mathcal{I} \subset \mathcal{O}_S$ is a quasi-coherent sheaf of ideals
of finite type,
and $\mathcal{F}$ is a quasi-coherent sheaf on $X$. Then the lemma says that
\begin{equation}
\label{equation-formal-functions}
Rf_*(\mathcal{F}^\wedge) = (Rf_*\mathcal{F})^\wedge
\end{equation}
where $\mathcal{F}^\wedge$ is the derived completion of $\mathcal{F}$
with respect to $f^{-1}\mathcal{I} \cdot \mathcal{O}_X$ and the right
hand side is the derived completion of $\mathcal{F}$
with respect to $\mathcal{I}$. To see that this gives back the theorem
on formal functions we have to do a bit of work.

\begin{lemma}
\label{lemma-sections-derived-completion-pseudo-coherent}
Let $X$ be a locally Noetherian scheme. Let $\mathcal{I} \subset \mathcal{O}_X$
be a quasi-coherent sheaf of ideals. Let $K$ be a
pseudo-coherent object of $D(\mathcal{O}_X)$ with derived completion
$K^\wedge$. Then
$$
H^p(U, K^\wedge) = \lim H^p(U, K)/I^nH^p(U, K) =
H^p(U, K)^\wedge
$$
for any affine open $U \subset X$
where $I = \mathcal{I}(U)$ and where on the right we have the derived
completion with respect to $I$.
\end{lemma}

\begin{proof}
Write $U = \Spec(A)$. The ring $A$ is Noetherian
and hence $I \subset A$ is finitely generated. Then we have
$$
R\Gamma(U, K^\wedge) = R\Gamma(U, K)^\wedge
$$
by Remark \ref{remark-local-calculation-derived-completion}.
Now $R\Gamma(U, K)$ is a pseudo-coherent complex of $A$-modules
(Derived Categories of Schemes, Lemma
\ref{perfect-lemma-pseudo-coherent-affine}).
By More on Algebra, Lemma
\ref{more-algebra-lemma-derived-completion-pseudo-coherent}
we conclude that the $p$th cohomology module of $R\Gamma(U, K^\wedge)$
is equal to the $I$-adic completion of $H^p(U, K)$.
This proves the first equality. The second (less important) equality
follows immediately from a second application of the lemma just used.
\end{proof}

\begin{lemma}
\label{lemma-derived-completion-pseudo-coherent}
Let $X$ be a locally Noetherian scheme. Let $\mathcal{I} \subset \mathcal{O}_X$
be a quasi-coherent sheaf of ideals.
Let $K$ be an object of $D(\mathcal{O}_X)$. Then
\begin{enumerate}
\item the derived completion $K^\wedge$ is equal to
$R\lim (K \otimes_{\mathcal{O}_X}^\mathbf{L} \mathcal{O}_X/\mathcal{I}^n)$.
\end{enumerate}
Let $K$ is a pseudo-coherent object of $D(\mathcal{O}_X)$. Then
\begin{enumerate}
\item[(2)] the cohomology sheaf $H^q(K^\wedge)$ is equal to
$\lim H^q(K)/\mathcal{I}^nH^q(K)$.
\end{enumerate}
Let $\mathcal{F}$ be a coherent $\mathcal{O}_X$-module\footnote{For example
$H^q(K)$ for $K$ pseudo-coherent on our locally Noetherian $X$.}. Then
\begin{enumerate}
\item[(3)] the derived completion $\mathcal{F}^\wedge$ is equal to
$\lim \mathcal{F}/\mathcal{I}^n\mathcal{F}$,
\item[(4)]
$\lim \mathcal{F}/I^n \mathcal{F} = R\lim \mathcal{F}/I^n \mathcal{F}$,
\item[(5)] $H^p(U, \mathcal{F}^\wedge) = 0$ for $p \not = 0$ for all
affine opens $U \subset X$.
\end{enumerate}
\end{lemma}

\begin{proof}
Proof of (1). There is a canonical map
$$
K \longrightarrow
R\lim (K \otimes_{\mathcal{O}_X}^\mathbf{L} \mathcal{O}_X/\mathcal{I}^n),
$$
see Remark \ref{remark-compare-with-completion}.
Derived completion commutes with passing to open subschemes
(Remark \ref{remark-localization-and-completion}).
Formation of $R\lim$ commutes with passsing to open subschemes.
It follows that to check our map is an isomorphism, we may work locally.
Thus we may assume $X = U = \Spec(A)$. Say
Say $I = (f_1, \ldots, f_r)$. Let
$K_n = K(A, f_1^n, \ldots, f_r^n)$ be the Koszul complex.
By More on Algebra, Lemma \ref{more-algebra-lemma-sequence-Koszul-complexes}
we have seen that the pro-systems $\{K_n\}$ and
$\{A/I^n\}$ of $D(A)$ are isomorphic.
Using the equivalence $D(A) = D_{\QCoh}(\mathcal{O}_X)$
of Derived Categories of Schemes, Lemma
\ref{perfect-lemma-affine-compare-bounded}
we see that the pro-systems $\{K(\mathcal{O}_X, f_1^n, \ldots, f_r^n)\}$
and $\{\mathcal{O}_X/\mathcal{I}^n\}$ are isomorphic in
$D(\mathcal{O}_X)$. This proves the second equality in
$$
K^\wedge = R\lim \left(
K \otimes_{\mathcal{O}_X}^\mathbf{L} K(\mathcal{O}_X, f_1^n, \ldots, f_r^n)
\right) =
R\lim (K \otimes_{\mathcal{O}_X}^\mathbf{L} \mathcal{O}_X/\mathcal{I}^n)
$$
The first equality is
Lemma \ref{lemma-derived-completion-koszul}.

\medskip\noindent
Assume $K$ is pseudo-coherent. For $U \subset X$ affine open
we have $H^q(U, K^\wedge) = \lim H^q(U, K)/\mathcal{I}^n(U)H^q(U, K)$
by Lemma \ref{lemma-sections-derived-completion-pseudo-coherent}.
As this is true for every $U$ we see that
$H^q(K^\wedge) = \lim H^q(K)/\mathcal{I}^nH^q(K)$ as sheaves.
This proves (2).

\medskip\noindent
Part (3) is a special case of (2).
Parts (4) and (5) follow from
Derived Categories of Schemes, Lemma
\ref{perfect-lemma-Rlim-quasi-coherent}.
\end{proof}

\begin{lemma}
\label{lemma-formal-functions}
Let $A$ be a Noetherian ring and let $I \subset A$ be an ideal. Let $X$ be a
Noetherian scheme over $A$. Let $\mathcal{F}$ be a coherent
$\mathcal{O}_X$-module. Assume that $H^p(X, \mathcal{F})$ is
a finite $A$-module for all $p$. Then there are short exact sequences
$$
0 \to R^1\lim H^{p - 1}(X, \mathcal{F}/I^n\mathcal{F}) \to
H^p(X, \mathcal{F})^\wedge \to \lim H^p(X, \mathcal{F}/I^n\mathcal{F}) \to 0
$$
of $A$-modules where $H^p(X, \mathcal{F})^\wedge$ is the usual $I$-adic
completion. If $f$ is proper, then the $R^1\lim$ term is zero.
\end{lemma}

\begin{proof}
Consider the two spectral sequences of
Lemma \ref{lemma-formal-functions-general}.
The first degenerates by More on Algebra, Lemma
\ref{more-algebra-lemma-derived-completion-pseudo-coherent}.
We obtain $H^p(X, \mathcal{F})^\wedge$ in degree $p$.
This is where we use the assumption that $H^p(X, \mathcal{F})$ is
a finite $A$-module. The second degenerates because
$$
\mathcal{F}^\wedge = \lim \mathcal{F}/I^n\mathcal{F} =
R\lim \mathcal{F}/I^n\mathcal{F}
$$
is a sheaf by Lemma \ref{lemma-derived-completion-pseudo-coherent}.
We obtain $H^p(X, \lim \mathcal{F}/I^n\mathcal{F})$ in degree $p$.
Since $R\Gamma(X, -)$ commutes with derived limits
(Injectives, Lemma \ref{injectives-lemma-RF-commutes-with-Rlim})
we also get
$$
R\Gamma(X, \lim \mathcal{F}/I^n\mathcal{F}) =
R\Gamma(X, R\lim \mathcal{F}/I^n\mathcal{F}) =
R\lim R\Gamma(X, \mathcal{F}/I^n\mathcal{F})
$$
By More on Algebra, Remark
\ref{more-algebra-remark-how-unique}
we obtain exact sequences
$$
0 \to
R^1\lim H^{p - 1}(X, \mathcal{F}/I^n\mathcal{F}) \to
H^p(X, \lim \mathcal{F}/I^n\mathcal{F}) \to
\lim H^p(X, \mathcal{F}/I^n\mathcal{F}) \to 0
$$
of $A$-modules. Combining the above we get the first statement of the lemma.
The vanishing of the $R^1\lim$ term follows from
Cohomology of Schemes, Lemma \ref{coherent-lemma-ML-cohomology-powers-ideal}.
\end{proof}

\begin{remark}
\label{remark-references}
Here are some references to discussions of related material the literature.
It seems that a ``derived formal functions theorem'' for proper maps
goes back to \cite[Theorem 6.3.1]{lurie-thesis}.
There is the discussion in \cite{dag12}, especially
Chapter 4 which discusses the affine story, see
More on Algebra, Section \ref{more-algebra-section-derived-completion}.
In \cite[Section 2.9]{G-R} one finds a discussion of proper base change and
derived completion using (ind) coherent modules.
An analogue of (\ref{equation-formal-functions})
for complexes of quasi-coherent modules can be found as
\cite[Theorem 6.5]{HL-P}
\end{remark}



\section{Derived completion in the constant Noetherian case}
\label{section-derived-completion-noetherian}

\noindent
Let $\mathcal{C}$ be a site. Let $\Lambda$ be a Noetherian ring
and let $I \subset \Lambda$ be an ideal. Recall from
Modules on Sites, Lemma \ref{sites-modules-lemma-completion-flat}
that
$$
\underline{\Lambda}^\wedge = \lim \underline{\Lambda/I^n}
$$
is a flat $\underline{\Lambda}$-algebra and that the map
$\underline{\Lambda} \to \underline{\Lambda}^\wedge$ identifies
quotients by $I$. Hence
Lemma \ref{lemma-restriction-derived-complete-equivalence}
tells us that
$$
D_{comp}(\mathcal{C}, \Lambda) =
D_{comp}(\mathcal{C}, \underline{\Lambda}^\wedge)
$$
In particular the cohomology sheaves $H^i(K)$ of an object $K$ of
$D_{comp}(\mathcal{C}, \Lambda)$ are sheaves of
$\underline{\Lambda}^\wedge$-modules.
For notational convenience we often work with
$D_{comp}(\mathcal{C}, \Lambda)$.

\begin{lemma}
\label{lemma-naive-completion}
Let $\mathcal{C}$ be a site. Let $\Lambda$ be a Noetherian ring
and let $I \subset \Lambda$ be an ideal. The left adjoint
to the inclusion functor
$D_{comp}(\mathcal{C}, \Lambda) \to D(\mathcal{C}, \Lambda)$
of Proposition \ref{proposition-derived-completion} sends $K$ to
$$
K^\wedge = R\lim(K \otimes_\Lambda^\mathbf{L} \underline{\Lambda/I^n})
$$
In particular, $K$ is derived complete if and only if
$K = R\lim(K \otimes_\Lambda^\mathbf{L} \underline{\Lambda/I^n})$.
\end{lemma}

\begin{proof}
Choose generators $f_1, \ldots, f_r$ of $I$. By
Lemma \ref{lemma-derived-completion-koszul} we have
$$
K^\wedge = 
R\lim (K \otimes_\Lambda^\mathbf{L} \underline{K_n})
$$
where $K_n = K(\Lambda, f_1^n, \ldots, f_r^n)$.
In More on Algebra, Lemma \ref{more-algebra-lemma-sequence-Koszul-complexes}
we have seen that the pro-systems $\{K_n\}$ and
$\{\Lambda/I^n\}$ of $D(\Lambda)$
are isomorphic. Thus the lemma follows.
\end{proof}

\begin{lemma}
\label{lemma-pushforward-Noetherian-case}
Let $\Lambda$ be a Noetherian ring. Let $I \subset \Lambda$ be an ideal.
Let $f : \Sh(\mathcal{D}) \to \Sh(\mathcal{C})$ be a morphism of topoi.
Then
\begin{enumerate}
\item $Rf_*$ sends $D_{comp}(\mathcal{D}, \Lambda)$
into $D_{comp}(\mathcal{C}, \Lambda)$,
\item the map $Rf_* : D_{comp}(\mathcal{D}, \Lambda) \to
D_{comp}(\mathcal{C}, \Lambda)$ has a left adjoint
$Lf_{comp}^* : D_{comp}(\mathcal{C}, \Lambda) \to
D_{comp}(\mathcal{D}, \Lambda)$ which is $Lf^*$ followed by
derived completion,
\item $Rf_*$ commutes with derived completion,
\item for $K$ in $D_{comp}(\mathcal{D}, \Lambda)$ we have
$Rf_*K = R\lim Rf_*(K \otimes^\mathbf{L}_\Lambda \underline{\Lambda/I^n})$.
\item for $M$ in $D_{comp}(\mathcal{C}, \Lambda)$ we have
$Lf^*_{comp}M =
R\lim Lf^*(M \otimes^\mathbf{L}_\Lambda \underline{\Lambda/I^n})$.
\end{enumerate}
\end{lemma}

\begin{proof}
We have seen (1) and (2) in
Lemma \ref{lemma-pushforward-derived-complete-adjoint}.
Part (3) follows from
Lemma \ref{lemma-pushforward-commutes-with-derived-completion}.
For (4) let $K$ be derived complete. Then
$$
Rf_*K = Rf_*( R\lim K \otimes^\mathbf{L}_\Lambda \underline{\Lambda/I^n}) =
R\lim Rf_*(K \otimes^\mathbf{L}_\Lambda \underline{\Lambda/I^n})
$$
the first equality by Lemma \ref{lemma-naive-completion}
and the second because $Rf_*$ commutes with $R\lim$
(Cohomology on Sites, Lemma
\ref{sites-cohomology-lemma-Rf-commutes-with-Rlim}). This proves (4).
To prove (5), by Lemma \ref{lemma-naive-completion} we have
$$
Lf_{comp}^*M =
R\lim ( Lf^*M \otimes_\Lambda^\mathbf{L} \underline{\Lambda/I^n})
$$
Since $Lf^*$ commutes with derived tensor product by
Cohomology on Sites, Lemma \ref{sites-cohomology-lemma-pullback-tensor-product}
and since $Lf^*\underline{\Lambda/I^n} = \underline{\Lambda/I^n}$
we get (5).
\end{proof}







\section{Derived completion on the pro-\'etale site}
\label{section-derived-completion-proetale}

\noindent
Let $\mathcal{C}$ be a site. Let $\Lambda$ be a Noetherian ring.
Let $I \subset \Lambda$ be an ideal. Although the general theory
(see Sections \ref{section-derived-completion} and
\ref{section-derived-completion-noetherian})
concerning $D_{comp}(\mathcal{C}, \Lambda)$ is quite satisfactory
it is somewhat useless as it is hard to explicitly give
examples of derived complete complexes. We know that
\begin{enumerate}
\item every object $M$ of $D(\mathcal{C}, \Lambda/I^n)$ restricts to a
derived complete object of $D(\mathcal{C}, \Lambda)$, and
\item for every $K \in D(\mathcal{C}, \Lambda)$ the derived completion
$K^\wedge = R\lim (K \otimes_\Lambda^\mathbf{L} \underline{\Lambda/I^n})$
is derived complete.
\end{enumerate}
The first type of objects are trivially complete and perhaps not
interesting. The problem with (2) is that derived completion
in general is somewhat mysterious, even in case $K = \underline{\Lambda}$.
Namely, by definition of homotopy limits there
is a distinguished triangle
$$
R\lim(\underline{\Lambda/I^n}) \to
\prod \underline{\Lambda/I^n} \to
\prod \underline{\Lambda/I^n} \to
R\lim(\underline{\Lambda/I^n})[1]
$$
in $D(\mathcal{C}, \Lambda)$ where the products are in
$D(\mathcal{C}, \Lambda)$. These are computed by taking products
of injective resolutions
(Injectives, Lemma \ref{injectives-lemma-derived-products}),
so we see that the sheaf $H^p(\prod \underline{\Lambda/I^n})$
is the sheafification of the presheaf
$$
U \longmapsto \prod H^p(U, \Lambda/I^n).
$$
As an explicit example, if $X = \Spec(\mathbf{C}[t, t^{-1}])$,
$\mathcal{C} = X_\etale$, $\Lambda = \mathbf{Z}$, $I = (2)$, and
$p = 1$, then we get the sheafification of the presheaf
$$
U \mapsto \prod H^1(U_\etale, \mathbf{Z}/2^n\mathbf{Z})
$$
for $U$ \'etale over $X$. Note that $H^1(X_\etale, \mathbf{Z}/m\mathbf{Z})$
is cyclic of order $m$ with generator $\alpha_m$ given by the finite \'etale
$\mathbf{Z}/m\mathbf{Z}$-covering given by the equation $t = s^m$
(see \'Etale Cohomology, Section \ref{etale-cohomology-section-computation}).
Then the section
$$
\alpha = (\alpha_{2^n}) \in \prod H^1(X_\etale, \mathbf{Z}/2^n\mathbf{Z})
$$
of the presheaf above does not restrict to zero on any nonempty \'etale
scheme over $X$, whence the sheaf associated to the presheaf is not zero.

\medskip\noindent
However, on the pro-\'etale site this phenomenon does not occur.
The reason is that we have enough (quasi-compact) weakly contractible objects.
In the following proposition we collect some results about derived
completion in the Noetherian constant case for sites having enough
weakly contractible objects (see
Sites, Definition \ref{sites-definition-w-contractible}).

\begin{proposition}
\label{proposition-enough-weakly-contractibles}
Let $\mathcal{C}$ be a site. Assume $\mathcal{C}$ has enough
weakly contractible objects.
Let $\Lambda$ be a Noetherian ring. Let $I \subset \Lambda$ be an ideal.
\begin{enumerate}
\item The category of derived complete sheaves $\Lambda$-modules is a
weak Serre subcategory of $\textit{Mod}(\mathcal{C}, \Lambda)$.
\item A sheaf $\mathcal{F}$ of $\Lambda$-modules satisfies
$\mathcal{F} = \lim \mathcal{F}/I^n\mathcal{F}$ if and only if
$\mathcal{F}$ is derived complete and $\bigcap I^n\mathcal{F} = 0$.
\item The sheaf $\underline{\Lambda}^\wedge$ is derived complete.
\item If $\ldots \to \mathcal{F}_3 \to \mathcal{F}_2 \to \mathcal{F}_1$
is an inverse system of derived complete sheaves of $\Lambda$-modules,
then $\lim \mathcal{F}_n$ is derived complete.
\item An object $K \in D(\mathcal{C}, \Lambda)$ is derived complete if
and only if each cohomology sheaf $H^p(K)$ is derived complete.
\item An object $K \in D_{comp}(\mathcal{C}, \Lambda)$ is bounded above
if and only if $K \otimes_\Lambda^\mathbf{L} \underline{\Lambda/I}$
is bounded above.
\item An object $K \in D_{comp}(\mathcal{C}, \Lambda)$ is bounded
if $K \otimes_\Lambda^\mathbf{L} \underline{\Lambda/I}$ has finite
tor dimension.
\end{enumerate}
\end{proposition}

\begin{proof}
Let $\mathcal{B} \subset \Ob(\mathcal{C})$ be a subset such that every
$U \in \mathcal{B}$ is weakly contractible and every object of $\mathcal{C}$
has a covering by elements of $\mathcal{B}$.
We will use the results of Cohomology on Sites,
Lemma \ref{sites-cohomology-lemma-w-contractible} and
Proposition \ref{sites-cohomology-proposition-enough-weakly-contractibles}
without further mention.

\medskip\noindent
Recall that $R\lim$ commutes with $R\Gamma(U, -)$,
see Injectives, Lemma \ref{injectives-lemma-RF-commutes-with-Rlim}.
Let $f \in I$. Recall that $T(K, f)$ is the homotopy limit
of the system
$$
\ldots K \xrightarrow{f} K \xrightarrow{f} K
$$
in $D(\mathcal{C}, \Lambda)$. Thus
$$
R\Gamma(U, T(K, f)) = T(R\Gamma(U, K), f).
$$
Since we can test isomorphisms of maps between objects of
$D(\mathcal{C}, \Lambda)$ by evaluating at $U \in \mathcal{B}$
we conclude an object $K$ of $D(\mathcal{C}, \Lambda)$
is derived complete if and only if for every $U \in \mathcal{B}$ the
object $R\Gamma(U, K)$ is derived complete as an object of $D(\Lambda)$.

\medskip\noindent
The remark above implies that items (1), (5) follow from the corresponding
results for modules over rings, see
More on Algebra, Lemmas \ref{more-algebra-lemma-hom-from-Af} and
\ref{more-algebra-lemma-serre-subcategory}.
In the same way (2) can be deduced from
More on Algebra, Proposition
\ref{more-algebra-proposition-derived-complete-modules}
as $(I^n\mathcal{F})(U) = I^n \cdot \mathcal{F}(U)$
for $U \in \mathcal{B}$ (by exactness of evaluating at $U$).

\medskip\noindent
Proof of (4). The homotopy limit $R\lim \mathcal{F}_n$ is in
$D_{comp}(X, \Lambda)$ (see discussion following
Definition \ref{definition-derived-complete}).
By part (5) just proved we conclude that
$\lim \mathcal{F}_n = H^0(R\lim \mathcal{F}_n)$
is derived complete.
Part (3) is a special case of (4).

\medskip\noindent
Proof of (6) and (7). Follows from
Lemma \ref{lemma-naive-completion}
and
Cohomology on Sites, Lemma \ref{sites-cohomology-lemma-bounded}
and the computation of homotopy limits in Cohomology on Sites,
Proposition \ref{sites-cohomology-proposition-enough-weakly-contractibles}.
\end{proof}





\section{Comparison with the \'etale site}
\label{section-comparison}

\noindent
Let $X$ be a scheme. With suitable choices of sites (as in
Topologies, Remark \ref{topologies-remark-choice-sites})
the functor $u : X_\etale \to X_\proetale$ sending
$U/X$ to $U/X$ defines a morphism of sites
$$
\epsilon : X_\proetale \longrightarrow X_\etale
$$
This follows from Sites, Proposition \ref{sites-proposition-get-morphism}.
A fundamental fact about this comparison morphism is the following.

\begin{lemma}
\label{lemma-limit-pullback}
Let $X$ be a scheme. Let $Y = \lim Y_i$ be an inverse limit
of quasi-compact and quasi-separated schemes \'etale over $X$
with affine transition morphisms. For any sheaf $\mathcal{F}$
on $X_\etale$ we have
$\epsilon^{-1}\mathcal{F}(Y) = \colim \mathcal{F}(Y_i)$.
\end{lemma}

\begin{proof}
Let $\mathcal{F} = h_U$ be a representable sheaf on $X_\etale$
with $U$ an object of $X_\etale$. In this case
$\epsilon^{-1}h_U = h_{u(U)}$ where $u(U)$ is $U$ viewed as an object of
$X_\proetale$ (Sites, Lemma \ref{sites-lemma-pullback-representable-sheaf}).
Then
\begin{align*}
(\epsilon^{-1}h_U)(Y)
& = h_{u(U)}(Y) \\
& = \Mor_X(Y, U) \\
& = \colim \Mor_X(Y_i, U) \\
& = \colim h_{u(U)}(Y_i) \\
& = \colim (\epsilon^{-1}h_U)(Y_i)
\end{align*}
Here the only nonformal equality is the $3$rd which holds
by Limits, Proposition
\ref{limits-proposition-characterize-locally-finite-presentation}.
Hence the lemma holds for every representable sheaf. Since every sheaf
is a coequalizer of a map of coproducts of representable sheaves
(Sites, Lemma \ref{sites-lemma-sheaf-coequalizer-representable})
we obtain the result in general.
\end{proof}

\begin{lemma}
\label{lemma-fully-faithful}
Let $X$ be a scheme. For every sheaf $\mathcal{F}$ on $X_\etale$
the adjunction map $\mathcal{F} \to \epsilon_*\epsilon^{-1}\mathcal{F}$ is an
isomorphism.
\end{lemma}

\begin{proof}
Suppose that $U$ is a quasi-compact and quasi-separated scheme \'etale
over $X$. Then
$$
\epsilon_*\epsilon^{-1}\mathcal{F}(U) =
\epsilon^{-1}\mathcal{F}(U) =
\mathcal{F}(U)
$$
the second equality by (a special case of) Lemma \ref{lemma-limit-pullback}.
Since every object of $X_\etale$
has a covering by quasi-compact and quasi-separated objects we conclude.
\end{proof}

\begin{lemma}
\label{lemma-affine-vanishing}
Let $X$ be an affine scheme. For injective abelian sheaf $\mathcal{I}$ on
$X_\etale$ we have $H^p(X_\proetale, \epsilon^{-1}\mathcal{I}) = 0$
for $p > 0$.
\end{lemma}

\begin{proof}
We are going to use
Cohomology on Sites, Lemma \ref{sites-cohomology-lemma-cech-vanish-collection}
to prove this. The idea is simple: We show that every standard pro-\'etale
covering of $X$ is a limit of coverings in $X_\etale$.
If this holds then Lemma \ref{lemma-limit-pullback} will kick in
to show the {\v C}ech cohomology groups of $\epsilon^{-1}\mathcal{I}$
are colimits of those of $\mathcal{I}$ which are zero in positive degree.

\medskip\noindent
Here are the details.
Let $\mathcal{B} \subset \Ob(X_\proetale)$ be the set of affine
schemes $U$ over $X$ such that $\mathcal{O}(X) \to \mathcal{O}(U)$ is
ind-\'etale. Let $\text{Cov}$ be the set of
pro-\'etale coverings $\{U_i \to U\}_{i = 1, \ldots, n}$
with $U, U_i \in \mathcal{B}$ such that $\mathcal{O}(U) \to \mathcal{O}(U_i)$
is ind-\'etale for $i = 1, \ldots, n$. Properties (1) and (2) of
Cohomology on Sites, Lemma \ref{sites-cohomology-lemma-cech-vanish-collection}
hold for $\mathcal{B}$ and $\text{Cov}$ by 
Proposition \ref{proposition-weakly-etale}
(it also follows from Lemma \ref{lemma-get-many-weakly-contractible}).

\medskip\noindent
To check condition (3) suppose that $\{U_i \to U\}_{i = 1, \ldots, n}$
is an element of $\text{Cov}$. Then we can write
$U_i = \lim_{a \in A_i} U_{i, a}$ with $U_{i, a} \to U$ \'etale and
$U_{i, a}$ affine.
Next we write $U = \lim_{b \in B} U_b$ with $U_b$ affine and $U_b \to U$
\'etale. By Limits, Lemma \ref{limits-lemma-descend-finite-presentation}
for each $i$ and $a \in A_i$ we can choose a $b(i, a) \in B$
and for all $b \geq b(i, a)$ an affine scheme $U_{i, a, b}$
\'etale over $U_b$ such that
$U_{i, a} = \lim_{b \geq b(i, a)} U_{i, a, b}$\footnote{To be sure, we pick
$U_{i, a, b} = U_b \times_{U_{b(i, a)}} U_{i, a, b(i, a)}$
although this isn't necessary for what follows.}.
Moreover, any transition map $U_{i, a} \to U_{i, a'}$ comes from
an essentially unique morphism $U_{i, a, b} \to U_{i, a', b}$ for $b$
large enough (by the same reference).
Finally, given $a_1 \in A_1, \ldots, a_n \in A_n$ the morphism
$U_{1, a_1} \amalg \ldots \amalg U_{n, a_n} \to U$ is surjective, hence
for $b$ large enough the map
$U_{1, a_1, b} \amalg \ldots \amalg U_{n, a_n, b} \to U_b$
is surjective by Limits, Lemma \ref{limits-lemma-descend-surjective}.
Let $\mathcal{D}$ be the category of coverings
$\{U_{i, a_i, b} \to U_b\}_{i = 1, \ldots, n}$ so obtained. This
category is cofiltered.
We claim that, given $i_0, \ldots, i_p \in \{1, \ldots, n\}$ we have
$$
U_{i_0} \times_U U_{i_1} \times_U \ldots \times_U U_{i_p}
=
\lim_\mathcal{D}
U_{i_0, a_{i_0}, b} \times_{U_b}
U_{i_1, a_{i_1}, b} \times_{U_b} \ldots \times_{U_b} U_{i_p, a_{i_p}, b}
$$
This is clear from the fact that it holds for $p = -1$
(i.e., $U = \lim_\mathcal{D} U_b$) and for $p = 0$
(i.e., $U_i = \lim_\mathcal{D} U_{i, a_i, b}$)
and the fact that fibre products commute with limits.
Then finally it follows from
Lemma \ref{lemma-limit-pullback}
that
$$
\check{\mathcal{C}}^\bullet(\{U_i \to U\}, \epsilon^{-1}\mathcal{I}) =
\colim_{\mathcal{D}^{opp}}
\check{\mathcal{C}}^\bullet(\{U_{i, a_i, b} \to U_b\}, \mathcal{I})
$$
Since each of the {\v C}ech complexes on the right hand side is
acyclic in positive degrees
(Cohomology on Sites, Lemma
\ref{sites-cohomology-lemma-injective-trivial-cech})
it follows that the one on the left is too. This prove condition (3) of
Cohomology on Sites, Lemma \ref{sites-cohomology-lemma-cech-vanish-collection}.
Since $X \in \mathcal{B}$ the lemma follows.
\end{proof}

\begin{lemma}
\label{lemma-relative-comparison}
Let $X$ be a scheme. For an abelian sheaf $\mathcal{F}$ on $X_\etale$
we have $R\epsilon_*(\epsilon^{-1}\mathcal{F}) = \mathcal{F}$.
\end{lemma}

\begin{proof}
Let $\mathcal{I}$ be an injective abelian sheaf on $X_\etale$.
Recall that $R^q\epsilon_*(\epsilon^{-1}\mathcal{I})$ is the sheaf associated
to $U \mapsto H^q(U_\proetale, \epsilon^{-1}\mathcal{I})$, see
Cohomology on Sites, Lemma \ref{sites-cohomology-lemma-higher-direct-images}.
By Lemma \ref{lemma-affine-vanishing} we see that this is zero for $q > 0$
and $U$ affine and \'etale over $X$. Since every object of
$X_\etale$ has a covering by affine objects, it follows that
$R^q\epsilon_*(\epsilon^{-1}\mathcal{I}) = 0$ for $q > 0$.
Combined with Lemma \ref{lemma-fully-faithful} we conclude that
$R\epsilon_*\epsilon^{-1}\mathcal{I} = \mathcal{I}$
for every injective abelian sheaf. Since every abelian
sheaf has a resolution by injective sheaves, the result follows.
(Hint: use Leray acyclicity theorem -- Derived Categories, Lemma
\ref{derived-lemma-leray-acyclicity}.)
\end{proof}

\begin{lemma}
\label{lemma-compare-cohomology}
Let $X$ be a scheme. For an abelian sheaf $\mathcal{F}$ on $X_\etale$
we have
$$
H^i(X_\etale, \mathcal{F}) =
H^i(X_\proetale, \epsilon^{-1}\mathcal{F})
$$
for all $i$.
\end{lemma}

\begin{proof}
Immediate consequence of Lemma \ref{lemma-relative-comparison} and
the Leray spectral sequence (Cohomology on Sites, Lemma
\ref{sites-cohomology-lemma-apply-Leray}).
\end{proof}

\begin{lemma}
\label{lemma-compare-cohomology-nonabelian}
Let $X$ be a scheme. Let $\mathcal{G}$ be a sheaf of (possibly
noncommutative) groups on $X_\etale$. We have
$$
H^1(X_\etale, \mathcal{G}) =
H^1(X_\proetale, \epsilon^{-1}\mathcal{G})
$$
where $H^1$ is defined as the set of isomorphism classes of
torsors (see
Cohomology on Sites, Section \ref{sites-cohomology-section-h1-torsors}).
\end{lemma}

\begin{proof}
Since the functor $\epsilon^{-1}$ is fully faithful by
Lemma \ref{lemma-fully-faithful}
it is clear that the map
$H^1(X_\etale, \mathcal{G}) \to H^1(X_\proetale, \epsilon^{-1}\mathcal{G})$
is injective. To show surjectivity it suffices to show that
any $\epsilon^{-1}\mathcal{G}$-torsor $\mathcal{F}$ is \'etale
locally trivial. To do this we may assume that $X$ is affine.
Thus we reduce to proving surjectivity for $X$ affine.

\medskip\noindent
Choose a covering $\{U \to X\}$ with (a) $U$ affine, (b)
$\mathcal{O}(X) \to \mathcal{O}(U)$ ind-\'etale, and (c) $\mathcal{F}(U)$
nonempty. We can do this by Proposition \ref{proposition-weakly-etale}
and the fact that
standard pro-\'etale coverings of $X$ are cofinal among all pro-\'etale
coverings of $X$ (Lemma \ref{lemma-proetale-affine}).
Write $U = \lim U_i$ as a limit of affine schemes \'etale over $X$.
Pick $s \in \mathcal{F}(U)$. Let
$g \in \epsilon^{-1}\mathcal{G}(U \times_X U)$
be the unique section such that $g \cdot \text{pr}_1^*s = \text{pr}_2^*s$ in
$\mathcal{F}(U \times_X U)$. Then $g$ satisfies the cocycle condition
$$
\text{pr}_{12}^*g \cdot \text{pr}_{23}^*g = \text{pr}_{13}^*g
$$
in $\epsilon^{-1}\mathcal{G}(U \times_X U \times_X U)$. By
Lemma \ref{lemma-limit-pullback}
we have
$$
\epsilon^{-1}\mathcal{G}(U \times_X U) =
\colim \mathcal{G}(U_i \times_X U_i)
$$
and
$$
\epsilon^{-1}\mathcal{G}(U \times_X U \times_X U) =
\colim \mathcal{G}(U_i \times_X U_i \times_X U_i)
$$
hence we can find an $i$ and an element $g_i \in \mathcal{G}(U_i)$
mapping to $g$ satisfying the cocycle condition.
The cocycle $g_i$ then defines a torsor for $\mathcal{G}$ on
$X_\etale$ whose pullback is isomorphic to $\mathcal{F}$
by construction. Some details omitted (namely, the relationship
between torsors and 1-cocycles which should be added to the chapter
on cohomology on sites).
\end{proof}

\begin{lemma}
\label{lemma-compare-derived}
Let $X$ be a scheme. Let $\Lambda$ be a ring.
\begin{enumerate}
\item The essential image of
$\epsilon^{-1} : \textit{Mod}(X_\etale, \Lambda) \to
\textit{Mod}(X_\proetale, \Lambda)$
is a weak Serre subcategory $\mathcal{C}$.
\item The functor $\epsilon^{-1}$ defines an equivalence of categories
of $D^+(X_\etale, \Lambda)$ with $D^+_\mathcal{C}(X_\proetale, \Lambda)$.
\end{enumerate}
\end{lemma}

\begin{proof}
To prove (1) we will prove conditions (1) -- (4) of
Homology, Lemma \ref{homology-lemma-characterize-weak-serre-subcategory}.
Since $\epsilon^{-1}$ is fully faithful (Lemma \ref{lemma-fully-faithful})
and exact, everything is clear except for condition (4).
However, if
$$
0 \to \epsilon^{-1}\mathcal{F}_1 \to \mathcal{G} \to
\epsilon^{-1}\mathcal{F}_2 \to 0
$$
is a short exact sequence of sheaves of $\Lambda$-modules on $X_\proetale$,
then we get
$$
0 \to \epsilon_*\epsilon^{-1}\mathcal{F}_1 \to \epsilon_*\mathcal{G} \to
\epsilon_*\epsilon^{-1}\mathcal{F}_2 \to
R^1\epsilon_*\epsilon^{-1}\mathcal{F}_1
$$
which by Lemma \ref{lemma-relative-comparison}
is the same as a short exact sequence
$$
0 \to \mathcal{F}_1 \to \epsilon_*\mathcal{G} \to \mathcal{F}_2 \to 0
$$
Pulling pack we find that $\mathcal{G} = \epsilon^{-1}\epsilon_*\mathcal{G}$.
This proves (1).

\medskip\noindent
By (1) and the discussion in
Derived Categories, Section \ref{derived-section-triangulated-sub}
we obtain a strictly full, saturated, triangulated subcategory
$D_\mathcal{C}(X_\proetale, \Lambda)$. It is clear that $\epsilon^{-1}$
maps $D(X_\etale, \Lambda)$ into $D_\mathcal{C}(X_\proetale, \Lambda)$.
If $M$ is in $D^+(X_\etale, \Lambda)$, then
Lemma \ref{lemma-relative-comparison} shows that
$M \to R\epsilon_*\epsilon^{-1}M$ is an isomorphism.
If $K$ is in $D^+_\mathcal{C}(X_\proetale, \Lambda)$, then the
spectral sequence
$$
R^q\epsilon_*H^p(K) \Rightarrow H^{p + q}(R\epsilon_*K)
$$
and the vanishing in Lemma \ref{lemma-relative-comparison}
shows that $H^p(R\epsilon_*K) = R\epsilon_*H^p(K)$.
Since $\epsilon$ is a flat morphism of ringed sites (ringed
by the constant sheaf $\underline{\Lambda}$) we see that
$\epsilon^{-1}R\epsilon_*K$ has cohomology sheaves
$\epsilon^{-1}R\epsilon_*H^p(K)$. Since we've assumed
$H^p(K)$ is in $\mathcal{C}$ we
conclude by Lemma \ref{lemma-relative-comparison}
once more that
$\epsilon^{-1}R\epsilon_*K \to K$ is an isomorphism.
In this way we see that $\epsilon^{-1}$ and $R\epsilon_*$
are quasi-inverse functors proving (2).
\end{proof}

\noindent
Let $\Lambda$ be a ring. In
Modules on Sites, Section \ref{sites-modules-section-locally-constant}
we have defined the notion of a locally constant sheaf of $\Lambda$-modules
on a site. If $M$ is a $\Lambda$-module, then $\underline{M}$ is of finite
presentation as a sheaf of $\underline{\Lambda}$-modules if and only
if $M$ is a finitely presented $\Lambda$-module, see
Modules on Sites, Lemma \ref{sites-modules-lemma-locally-constant-finite-type}.

\begin{lemma}
\label{lemma-compare-locally-constant}
Let $X$ be a scheme. Let $\Lambda$ be a ring.
The functor $\epsilon^{-1}$ defines an equivalence of categories
$$
\left\{
\begin{matrix}
\text{locally constant sheaves}\\
\text{of }\Lambda\text{-modules on }X_\etale\\
\text{of finite presentation}
\end{matrix}
\right\}
\longleftrightarrow
\left\{
\begin{matrix}
\text{locally constant sheaves}\\
\text{of }\Lambda\text{-modules on }X_\proetale\\
\text{of finite presentation}
\end{matrix}
\right\}
$$
\end{lemma}

\begin{proof}
Let $\mathcal{F}$ be a locally constant sheaf of $\Lambda$-modules
on $X_\proetale$ of finite presentation. Choose a pro-\'etale covering
$\{U_i \to X\}$ such that $\mathcal{F}|_{U_i}$ is constant, say
$\mathcal{F}|_{U_i} \cong \underline{M_i}_{U_i}$.
Observe that $U_i \times_X U_j$ is empty if $M_i$ is not isomorphic
to $M_j$.
For each $\Lambda$-module $M$ let $I_M = \{i \in I \mid M_i \cong M\}$.
As pro-\'etale coverings are fpqc coverings and by
Descent, Lemma \ref{descent-lemma-open-fpqc-covering}
we see that $U_M = \bigcup_{i \in I_M} \Im(U_i \to X)$
is an open subset of $X$. Then $X = \coprod U_M$ is a disjoint
open covering of $X$. We may replace $X$ by $U_M$ for some $M$ and
assume that $M_i = M$ for all $i$.

\medskip\noindent
Consider the sheaf $\mathcal{I} = \mathit{Isom}(\underline{M}, \mathcal{F})$.
This sheaf is a torsor for
$\mathcal{G} = \mathit{Isom}(\underline{M}, \underline{M})$.
By Modules on Sites, Lemma \ref{sites-modules-lemma-locally-constant}
we have $\mathcal{G} = \underline{G}$
where $G = \mathit{Isom}_\Lambda(M, M)$.
Since torsors for the \'etale topology
and the pro-\'etale topology agree by
Lemma \ref{lemma-compare-cohomology-nonabelian}
it follows that $\mathcal{I}$ has sections \'etale locally on $X$.
Thus $\mathcal{F}$ is \'etale locally a constant sheaf which is
what we had to show.
\end{proof}

\begin{lemma}
\label{lemma-compare-locally-constant-derived}
Let $X$ be a scheme. Let $\Lambda$ be a Noetherian ring.
Let $D_{flc}(X_\etale, \Lambda)$, resp.\ $D_{flc}(X_\proetale, \Lambda)$
be the full subcategory of
$D(X_\etale, \Lambda)$, resp.\ $D(X_\proetale, \Lambda)$
consisting of those complexes whose cohomology sheaves are locally
constant sheaves of $\Lambda$-modules of finite type. Then
$$
\epsilon^{-1} :
D_{flc}^+(X_\etale, \Lambda)
\longrightarrow
D_{flc}^+(X_\proetale, \Lambda)
$$
is an equivalence of categories.
\end{lemma}

\begin{proof}
The categories $D_{flc}(X_\etale, \Lambda)$ and $D_{flc}(X_\proetale, \Lambda)$
are strictly full, saturated, triangulated subcategories of
$D(X_\etale, \Lambda)$ and $D(X_\proetale, \Lambda)$
by Modules on Sites, Lemma
\ref{sites-modules-lemma-kernel-finite-locally-constant}
and
Derived Categories, Section \ref{derived-section-triangulated-sub}
The statement of the lemma follows by combining
Lemmas \ref{lemma-compare-derived} and
\ref{lemma-compare-locally-constant}.
\end{proof}

\begin{lemma}
\label{lemma-compare-truncations}
Let $X$ be a scheme. Let $\Lambda$ be a Noetherian ring.
Let $K$ be an object of $D(X_\proetale, \Lambda)$.
Set $K_n = K \otimes_\Lambda^\mathbf{L} \underline{\Lambda/I^n}$.
If $K_1$ is
\begin{enumerate}
\item in the essential image of
$\epsilon^{-1} :D(X_\etale, \Lambda/I) \to D(X_\proetale, \Lambda/I)$, and
\item has tor amplitude in $[a,\infty)$ for some $a \in \mathbf{Z}$,
\end{enumerate}
then (1) and (2) hold for $K_n$ as an object of $D(X_\proetale, \Lambda/I^n)$.
\end{lemma}

\begin{proof}
For assertion (2) this follows from the more general
Cohomology on Sites, Lemma \ref{sites-cohomology-lemma-bounded}.
The second assertion follows from the fact that
the essential image of $\epsilon^{-1}$ is a triangulated
subcategory of $D^+(X_\proetale, \Lambda/I^n)$
(Lemma \ref{lemma-compare-derived}),
the distinguished triangles
$$
K \otimes_\Lambda^\mathbf{L} \underline{I^n/I^{n + 1}} \to
K_{n + 1} \to
K_n \to
K \otimes_\Lambda^\mathbf{L} \underline{I^n/I^{n + 1}}[1]
$$
and the isomorphism
$$
K \otimes_\Lambda^\mathbf{L} \underline{I^n/I^{n + 1}} =
K_1 \otimes_{\Lambda/I}^\mathbf{L} \underline{I^n/I^{n + 1}}
$$
\end{proof}






\section{Cohomology of a point}
\label{section-cohomology-point}

\noindent
Let $\Lambda$ be a Noetherian ring complete with respect to an ideal
$I \subset \Lambda$. Let $k$ be a field. In this section we ``compute''
$$
H^i(\Spec(k)_\proetale, \underline{\Lambda}^\wedge)
$$
where $\underline{\Lambda}^\wedge = \lim \underline{\Lambda/I^n}$ as before.
Let $k^{sep}$ be a separable algebraic closure of $k$.
Then
$$
\mathcal{U} = \{\Spec(k^{sep}) \to \Spec(k)\}
$$
is a pro-\'etale covering of $\Spec(k)$. We will use the {\v C}ech
to cohomology spectral sequence with respect to this covering.
Set $U_0 = \Spec(k^{sep})$ and
\begin{align*}
U_n & =
\Spec(k^{sep}) \times_{\Spec(k)}
\Spec(k^{sep}) \times_{\Spec(k)} \ldots
\times_{\Spec(k)} \Spec(k^{sep}) \\
& =
\Spec(k^{sep} \otimes_k k^{sep} \otimes_k \ldots \otimes_k k^{sep})
\end{align*}
($n + 1$ factors). Note that the underlying topological space
$|U_0|$ of $U_0$ is a singleton and for $n \geq 1$ we have
$$
|U_n| = G \times \ldots \times G\quad (n\text{ factors})
$$
as profinite spaces where $G = \text{Gal}(k^{sep}/k)$. Namely, every
point of $U_n$ has residue field $k^{sep}$ and we identify
$(\sigma_1, \ldots, \sigma_n)$ with the point corresponding to the
surjection
$$
k^{sep} \otimes_k k^{sep} \otimes_k \ldots \otimes_k k^{sep}
\longrightarrow k^{sep}, \quad
\lambda_0 \otimes \lambda_1 \otimes \ldots \lambda_n
\longmapsto \lambda_0 \sigma_1(\lambda_1) \ldots \sigma_n(\lambda_n)
$$
Then we compute
\begin{align*}
R\Gamma((U_n)_\proetale, \underline{\Lambda}^\wedge)
& =
R\lim R\Gamma((U_n)_\proetale, \underline{\Lambda/I^n}) \\
& =
R\lim R\Gamma((U_n)_\etale, \underline{\Lambda/I^n}) \\
& =
\lim H^0(U_n, \underline{\Lambda/I^n}) \\
& = 
\text{Maps}_{cont}(G \times \ldots \times G, \Lambda)
\end{align*}
The first equality because $R\Gamma$ commutes with derived limits
and as $\Lambda^\wedge$ is the derived limit of the sheaves
$\underline{\Lambda/I^n}$ by
Proposition \ref{proposition-enough-weakly-contractibles}.
The second equality by Lemma \ref{lemma-compare-cohomology}.
The third equality by \'Etale Cohomology, Lemma
\ref{etale-cohomology-lemma-affine-only-closed-points}.
The fourth equality uses
\'Etale Cohomology, Remark
\ref{etale-cohomology-remark-constant-locally-constant-maps}
to identify sections of the constant sheaf $\underline{\Lambda/I^n}$.
Then it uses the fact that $\Lambda$ is complete with respect to $I$
and hence equal to $\lim \Lambda/I^n$ as a topological space, to see that
$\lim \text{Map}_{cont}(G, \Lambda/I^n) = \text{Map}_{cont}(G, \Lambda)$
and similarly for higher powers of $G$.
At this point Cohomology on Sites, Lemmas
\ref{sites-cohomology-lemma-cech-cohomology}  and
\ref{sites-cohomology-lemma-cech-spectral-sequence-application}
tell us that
$$
\Lambda \to \text{Maps}_{cont}(G, \Lambda) \to
\text{Maps}_{cont}(G \times G, \Lambda) \to \ldots
$$
computes the pro-\'etale cohomology. In other words, we see that
$$
H^i(\Spec(k)_\proetale, \underline{\Lambda}^\wedge)
=
H^i_{cont}(G, \Lambda)
$$
where the right hand side is continuous cohomology as defined by
Tate in \cite{Tate}. Of course, this is as it should be.

\begin{lemma}
\label{lemma-more-general-point}
Let $k$ be a field. Let $G = \text{Gal}(k^{sep}/k)$ be its absolute
Galois group. Further, 
\begin{enumerate}
\item let $M$ be a profinite abelian group with a continuous
$G$-action, or
\item let $\Lambda$ be a Noetherian ring and $I \subset \Lambda$ an ideal
an let $M$ be an $I$-adically complete $\Lambda$-module with continuous
$G$-action.
\end{enumerate}
Then there is a canonical sheaf $\underline{M}^\wedge$ on
$\Spec(k)_\proetale$ associated to $M$ such that
$$
H^i(\Spec(k), \underline{M}^\wedge) = H^i_{cont}(G, M)
$$
as abelian groups or $\Lambda$-modules.
\end{lemma}

\begin{proof}
Proof in case (2). Set $M_n = M/I^nM$. Then $M = \lim M_n$ as $M$ is
assumed $I$-adically complete. Since the action of $G$ is continuous
we get continuous actions of $G$ on $M_n$. By \'Etale Cohomology, Theorem
\ref{etale-cohomology-theorem-equivalence-sheaves-point}
this action corresponds to a (locally constant) sheaf
$\underline{M_n}$ of $\Lambda/I^n$-modules on $\Spec(k)_\etale$.
Pull back to $\Spec(k)_\proetale$ by the comparison morphism
$\epsilon$ and take the limit
$$
\underline{M}^\wedge = \lim \epsilon^{-1}\underline{M_n}
$$
to get the sheaf promised in the lemma. Exactly the same argument as
given in the introduction of this section gives the comparison
with Tate's continuous Galois cohomology.
\end{proof}






\section{Weakly contractible hypercoverings}
\label{section-hypercovering}

\noindent
Let $X$ be a scheme. For every object $U \in \Ob(X_\proetale)$ there exists
a covering $\{V \to U\}$ of $X_\proetale$ with $V$ weakly contractible. This
follows from Lemma \ref{lemma-get-many-weakly-contractible} and the elementary
fact that a disjoint union of weakly contractible objects in $X_\proetale$
is weakly contractible (discussion of set theoretic issues omitted). This
observation leads to the existence of hypercoverings made up out weakly
contractible objects.

\begin{lemma}
\label{lemma-w-contractible-hypercovering}
Let $X$ be a scheme.
\begin{enumerate}
\item For every object $U$ of $X_\proetale$ there exists a hypercovering
$K$ of $U$ in $X_\proetale$ such that each term $K_n$ consists of a
single weakly contractible object of $X_\proetale$ covering $U$.
\item For every quasi-compact and quasi-separated object $U$ of $X_\proetale$
there exists a hypercovering $K$ of $U$ in $X_\proetale$ such that each
term $K_n$ consists of a single affine and weakly contractible object of
$X_\proetale$ covering $U$.
\end{enumerate}
\end{lemma}

\begin{proof}
Let $\mathcal{B} \subset \Ob(X_\proetale)$ be the
set of weakly contractible objects of $X_\proetale$.
Every object of $X_\proetale$ has a covering by an element of
$\mathcal{B}$ by Lemma \ref{lemma-get-many-weakly-contractible}
and the elementary fact that a disjoint union of weakly contractible
objects is weakly contractible.
We apply Hypercoverings, Lemma \ref{hypercovering-lemma-w-contractible}
to get a hypercovering $K$ of $U$ such that $K_n = \{U_{n, i}\}_{i \in I_n}$
with $I_n$ finite and $U_{n, i}$ weakly contractible.
Then we can replace $K$ by the hypercovering of $U$
given by $\{U_n\}$ in degree $n$ where $U_n = \coprod_{i \in I_n} U_{n, i}$.
This is allowed by
Hypercoverings, Remark \ref{hypercovering-remark-take-unions-hypercovering-X}.

\medskip\noindent
Let $X_{qcqs, \proetale} \subset X_\proetale$ be the full subcategory
consisting of quasi-compact and quasi-separated objects.
A covering of $X_{qcqs, \proetale}$ will be a finite pro-\'etale covering.
Then $X_{qcqs, \proetale}$ is a site, has fibre products, and
the inclusion functor $X_{qcqs, \proetale} \to X_\proetale$ is continuous
and commutes with fibre products.
In particular, if $K$ is a hypercovering of an object $U$ in
$X_{qcqs, \proetale}$ then $K$ is a hypercovering of $U$ in $X_\proetale$
by Hypercoverings, Lemma
\ref{hypercovering-lemma-hypercovering-continuous-functor}.
Let $\mathcal{B} \subset \Ob(X_{qcqs, \proetale})$ be the set of
affine and weakly contractible objects. By 
Lemma \ref{lemma-get-many-weakly-contractible}
and the fact that finite unions of affines are affine,
for every object $U$ of $X_{qcqs, \proetale}$ there exists a covering
$\{V \to U\}$ of $X_{qcqs, \proetale}$ with $V \in \mathcal{B}$.
By Hypercoverings, Lemma \ref{hypercovering-lemma-w-contractible}
we get a hypercovering $K$ of $U$ such that $K_n = \{U_{n, i}\}_{i \in I_n}$
with $I_n$ finite and $U_{n, i}$ affine and weakly contractible.
Then we can replace $K$ by the hypercovering of $U$
given by $\{U_n\}$ in degree $n$ where
$U_n = \coprod_{i \in I_n} U_{n, i}$. This is allowed by
Hypercoverings, Remark \ref{hypercovering-remark-take-unions-hypercovering-X}.
\end{proof}

\noindent
In the following lemma we use the {\v C}ech complex $\mathcal{F}(K)$
associated to a hypercovering $K$ in a site. See
Hypercoverings, Section \ref{hypercovering-section-hyper-cech}.
If $K$ is a hypercovering of $U$ and $K_n = \{U_n \to U\}$, then
the {\v C}ech complex looks like this:
$$
\mathcal{F}(K) = (\mathcal{F}(U_0) \to \mathcal{F}(U_1) \to
\mathcal{F}(U_2) \to\ldots )
$$

\begin{lemma}
\label{lemma-compute-cohomology}
Let $X$ be a scheme. Let $E \in D^+(X_\proetale)$ be represented by
a bounded below complex $\mathcal{E}^\bullet$ of abelian sheaves.
Let $K$ be a hypercovering of $U \in \Ob(X_\proetale)$ with
$K_n = \{U_n \to U\}$ where $U_n$ is a weakly contractible object of
$X_\proetale$. Then
$$
R\Gamma(U, E) = \text{Tot}(\mathcal{E}^\bullet(K))
$$
in $D(\textit{Ab})$.
\end{lemma}

\begin{proof}
If $E = \mathcal{E}[n]$ is the object associated to a single abelian
sheaf on $X_\proetale$, then the spectral sequence of
Hypercoverings, Lemma \ref{hypercovering-lemma-cech-spectral-sequence}
implies that
$$
R\Gamma(X_\proetale, \mathcal{E}) = \mathcal{E}(K)
$$
because the higher cohomology groups of any sheaf over $U_n$ vanish, see
Cohomology on Sites, Lemma \ref{sites-cohomology-lemma-w-contractible}.

\medskip\noindent
If $\mathcal{E}^\bullet$ is bounded below, then we can choose an injective
resolution $\mathcal{E}^\bullet \to \mathcal{I}^\bullet$ and consider
the map of complexes
$$
\text{Tot}(\mathcal{E}^\bullet(K)) \longrightarrow
\text{Tot}(\mathcal{I}^\bullet(K))
$$
For every $n$ the map $\mathcal{E}^\bullet(U_n) \to \mathcal{I}^\bullet(U_n)$
is a quasi-isomorphism because taking sections over $U_n$ is exact.
Hence the displayed map is a quasi-isomorphism by one of the spectral
sequences of
Homology, Lemma \ref{homology-lemma-first-quadrant-ss}.
Using the result of the first paragraph we see that for every $p$
the complex $\mathcal{I}^p(K)$ is acyclic in degrees $n > 0$ and
computes $\mathcal{I}^p(U)$ in degree $0$. Thus the other spectral
sequence of
Homology, Lemma \ref{homology-lemma-first-quadrant-ss}
shows $\text{Tot}(\mathcal{I}^\bullet(K))$ computes
$R\Gamma(U, E) = \mathcal{I}^\bullet(U)$.
\end{proof}

\begin{lemma}
\label{lemma-quasi-compact-quasi-separated-commutes-direct-sums}
Let $X$ be a quasi-compact and quasi-separated scheme.
The functor $R\Gamma(X, -) : D^+(X_\proetale) \to D(\textit{Ab})$
commutes with direct sums and homotopy colimits.
\end{lemma}

\begin{proof}
The statement means the following: Suppose we have a family of objects
$E_i$ of $D^+(X_\proetale)$ such that $\bigoplus E_i$ is an object
of $D^+(X_\proetale)$. Then
$R\Gamma(X, \bigoplus E_i) = \bigoplus R\Gamma(X, E_i)$.
To see this choose a hypercovering $K$ of $X$ with $K_n = \{U_n \to X\}$
where $U_n$ is an affine and weakly contractible scheme, see
Lemma \ref{lemma-w-contractible-hypercovering}.
Let $N$ be an integer such that $H^p(E_i) = 0$ for $p < N$.
Choose a complex of abelian sheaves $\mathcal{E}_i^\bullet$
representing $E_i$ with $\mathcal{E}_i^p = 0$ for $p < N$.
The termwise direct sum $\bigoplus \mathcal{E}_i^\bullet$ represents
$\bigoplus E_i$ in $D(X_\proetale)$, see
Injectives, Lemma \ref{injectives-lemma-derived-products}.
By Lemma \ref{lemma-compute-cohomology} we have
$$
R\Gamma(X, \bigoplus E_i) =
\text{Tot}((\bigoplus \mathcal{E}^\bullet_i)(K))
$$
and
$$
R\Gamma(X, E_i) = \text{Tot}(\mathcal{E}^\bullet_i(K))
$$
Since each $U_n$ is quasi-compact we see that
$$
\text{Tot}((\bigoplus \mathcal{E}^\bullet_i)(K)) =
\bigoplus \text{Tot}(\mathcal{E}^\bullet_i(K))
$$
by Modules on Sites, Lemma
\ref{sites-modules-lemma-sections-over-quasi-compact}.
The statement on homotopy colimits is a formal consequence of the fact
that $R\Gamma$ is an exact functor of triangulated categories and the
fact (just proved) that it commutes with direct sums.
\end{proof}

\begin{remark}
\label{remark-extend-to-all}
Let $X$ be a scheme. Because $X_\proetale$ has enough weakly contractible
objects for all $K$ in $D(X_\proetale)$ we have $K = R\lim \tau_{\geq -n}K$
by
Cohomology on Sites, Proposition
\ref{sites-cohomology-proposition-enough-weakly-contractibles}.
Since $R\Gamma$ commutes with $R\lim$ by
Injectives, Lemma \ref{injectives-lemma-RF-commutes-with-Rlim}
we see that
$$
R\Gamma(X, K) = R\lim R\Gamma(X, \tau_{\geq -n}K)
$$
in $D(\textit{Ab})$. This will allows us to extend some results from
bounded below complexes to all complexes.
\end{remark}





\section{Functoriality of the pro-\'etale site}
\label{section-morphism}

\noindent
Let $f : X \to Y$ be a morphism of schemes. The functor
$Y_\proetale \to X_\proetale$, $V \mapsto X \times_Y V$
induces a morphism of sites $f_\proetale : X_\proetale \to Y_\proetale$, see
Sites, Proposition \ref{sites-proposition-get-morphism}.
In fact, we obtain a commutative diagram of morphisms of sites
$$
\xymatrix{
X_\proetale \ar[r]_\epsilon \ar[d]_{f_\proetale} &
X_\etale \ar[d]^{f_\etale} \\
Y_\proetale \ar[r]^\epsilon & Y_\etale
}
$$
where $\epsilon$ is as in Section \ref{section-comparison}.
In particular we have
$\epsilon^{-1} f_\etale^{-1} = f_\proetale^{-1} \epsilon^{-1}$.
Here is the corresponding result for pushforward.

\begin{lemma}
\label{lemma-morphism-comparison}
Let $f : X \to Y$ be a morphism of schemes.
\begin{enumerate}
\item Let $\mathcal{F}$ be a sheaf of sets on $X_\etale$. Then we have
$f_{\proetale, *}\epsilon^{-1}\mathcal{F} =
\epsilon^{-1}f_{\etale, *}\mathcal{F}$.
\item Let $\mathcal{F}$ be an abelian sheaf on $X_\etale$. Then we have
$Rf_{\proetale, *}\epsilon^{-1}\mathcal{F} =
\epsilon^{-1}Rf_{\etale, *}\mathcal{F}$.
\end{enumerate}
\end{lemma}

\begin{proof}
Proof of (1). Let $\mathcal{F}$ be a sheaf of sets on $X_\etale$. There
is a canonical map $\epsilon^{-1}f_{\etale, *}\mathcal{F} \to
f_{\proetale, *}\epsilon^{-1}\mathcal{F}$, see
Sites, Section \ref{sites-section-pullback}.
To show it is an isomorphism we may work (Zariski) locally on $Y$, hence
we may assume $Y$ is affine. In this case
every object of $Y_\proetale$ has a covering by objects $V = \lim V_i$
which are limits of affine schemes $V_i$ \'etale over $Y$ (by
Proposition \ref{proposition-weakly-etale}
for example). Evaluating the map
$\epsilon^{-1}f_{\etale, *}\mathcal{F} \to
f_{\proetale, *}\epsilon^{-1}\mathcal{F}$
on $V$ we obtain a map
$$
\colim \Gamma(X \times_Y V_i, \mathcal{F})
\longrightarrow
\Gamma(X \times_Y V, \epsilon^*\mathcal{F}).
$$
see Lemma \ref{lemma-limit-pullback} for the left hand side.
By Lemma \ref{lemma-limit-pullback} we have
$$
\Gamma(X \times_Y V, \epsilon^*\mathcal{F}) =
\Gamma(X \times_Y V, \mathcal{F})
$$
Hence the result holds by
\'Etale Cohomology, Lemma
\ref{etale-cohomology-lemma-directed-colimit-cohomology}.

\medskip\noindent
Proof of (2). Arguing in exactly the same manner as above
we see that it suffices to show that
$$
\colim H^i_\etale(X \times_Y V_i, \mathcal{F})
\longrightarrow
H^i_\etale(X \times_Y V, \mathcal{F})
$$
which follows once more from \'Etale Cohomology, Lemma
\ref{etale-cohomology-lemma-directed-colimit-cohomology}.
\end{proof}







\section{Finite morphisms and pro-\'etale sites}
\label{section-finite}

\noindent
It is not clear that a finite morphism of schemes determines
an exact pushforward on abelian pro-\'etale sheaves.

\begin{lemma}
\label{lemma-finite}
Let $f : Z \to X$ be a finite morphism of schemes which is
locally of finite presentation. Then
$f_{\proetale, *} : \textit{Ab}(Z_\proetale) \to \textit{Ab}(X_\proetale)$
is exact.
\end{lemma}

\begin{proof}
The prove this we may work (Zariski) locally on $X$ and assume that $X$
is affine, say $X = \Spec(A)$. Then $Z = \Spec(B)$ for some finite
$A$-algebra $B$ of finite presentation. The construction in the proof of
Proposition \ref{proposition-find-w-contractible}
produces a faithfully flat, ind-\'etale ring map $A \to D$
with $D$ w-contractible. We may check exactness of a sequence of
sheaves by evaluating on $U = \Spec(D)$ be such an object. Then
$f_{\proetale, *}\mathcal{F}$
evaluated at $U$ is equal to $\mathcal{F}$ evaluated at
$V = \Spec(D \otimes_A B)$. Since $D \otimes_A B$ is w-contractible
by Lemma \ref{lemma-finite-finitely-presented-over-w-contractible}
evaluation at $V$ is exact.
\end{proof}








\section{Closed immersions and pro-\'etale sites}
\label{section-closed-immersion}

\noindent
It is not clear (and likely false) that a closed immersion of schemes
determines an exact pushforward on abelian pro-\'etale sheaves.

\begin{lemma}
\label{lemma-closed-immersion-affines}
Let $i : Z \to X$ be a closed immersion morphism of affine schemes.
Denote $X_{app}$ and $Z_{app}$ the sites introduced in
Lemma \ref{lemma-affine-alternative}.
The base change functor
$$
u : X_{app} \to Z_{app},\quad U \longmapsto u(U) = U \times_X Z
$$
is continuous and has a fully faithful left adjoint $v$.
For $V$ in $Z_{app}$ the morphism $V \to v(V)$ is a closed immersion
identifying $V$ with $u(v(V)) = v(V) \times_X Z$ and every point of
$v(V)$ specializes to a point of $V$.
The functor $v$ is cocontinuous and sends coverings to coverings.
\end{lemma}

\begin{proof}
The existence of the adjoint follows immediately from
Lemma \ref{lemma-lift-ind-etale} and the definitions.
It is clear that $u$ is continuous from the definition of
coverings in $X_{app}$.

\medskip\noindent
Write $X = \Spec(A)$ and $Z = \Spec(A/I)$. Let $V = \Spec(\overline{C})$
be an object of $Z_{app}$ and let $v(V) = \Spec(C)$.
We have seen in the statement of Lemma \ref{lemma-lift-ind-etale}
that $V$ equals $v(V) \times_X Z = \Spec(C/IC)$.
Any $g \in C$ which maps to an invertible element of
$C/IC = \overline{C}$ is invertible in $C$. Namely, we have the
$A$-algebra maps $C \to C_g \to C/IC$ and by adjointness
we obtain an $C$-algebra map $C_g \to C$.
Thus every point of $v(V)$ specializes to a point of $V$.

\medskip\noindent
Suppose that $\{V_i \to V\}$ is a covering in $Z_{app}$.
Then $\{v(V_i) \to v(V)\}$ is a finite family of morphisms of
$Z_{app}$ such that every point of $V \subset v(V)$ is
in the image of one of the maps $v(V_i) \to v(V)$. As the
morphisms $v(V_i) \to v(V)$ are flat (since they are weakly \'etale)
we conclude that $\{v(V_i) \to v(V)\}$ is jointly surjective.
This proves that $v$ sends coverings to coverings.

\medskip\noindent
Let $V$ be an object of $Z_{app}$ and let $\{U_i \to v(V)\}$
be a covering in $X_{app}$. Then we see that
$\{u(U_i) \to u(v(V)) = V\}$ is a covering of $Z_{app}$.
By adjointness we obtain morphisms $v(u(U_i)) \to U_i$.
Thus the family $\{v(u(U_i)) \to v(V)\}$ refines the given
covering and we conclude that $v$ is cocontinuous.
\end{proof}

\begin{lemma}
\label{lemma-closed-immersion-affines-apply}
Let $Z \to X$ be a closed immersion morphism of affine schemes.
The corresponding morphism of topoi $i = i_\proetale$
is equal to the morphism of topoi
associated to the fully faithful cocontinuous functor
$v : Z_{app} \to X_{app}$ of Lemma \ref{lemma-closed-immersion-affines}.
It follows that
\begin{enumerate}
\item $i^{-1}\mathcal{F}$ is the sheaf associated to the presheaf
$V \mapsto \mathcal{F}(v(V))$,
\item for a weakly contractible object $V$ of $Z_{app}$ we have
$i^{-1}\mathcal{F}(V) = \mathcal{F}(v(V))$,
\item $i^{-1} : \Sh(X_\proetale) \to \Sh(Z_\proetale)$
has a left adjoint $i^{Sh}_!$,
\item $i^{-1} : \textit{Ab}(X_\proetale) \to \textit{Ab}(Z_\proetale)$
has a left adjoint $i_!$,
\item $\text{id} \to i^{-1}i^{Sh}_!$, $\text{id} \to i^{-1}i_!$, and
$i^{-1}i_* \to \text{id}$ are isomorphisms, and
\item $i_*$, $i^{Sh}_!$ and $i_!$ are fully faithful.
\end{enumerate}
\end{lemma}

\begin{proof}
By Lemma \ref{lemma-affine-alternative} we may describe $i_\proetale$ in terms
of the morphism of sites $u : X_{app} \to Z_{app}$, $V \mapsto V \times_X Z$.
The first statement of the lemma follows from
Sites, Lemma \ref{sites-lemma-have-functor-other-way-morphism}
(but with the roles of $u$ and $v$ reversed).

\medskip\noindent
Proof of (1). By the description of $i$ as the morphism of topoi associated
to $v$ this holds by the construction, see
Sites, Lemma \ref{sites-lemma-cocontinuous-morphism-topoi}.

\medskip\noindent
Proof of (2). Since the functor $v$ sends coverings to coverings by
Lemma \ref{lemma-closed-immersion-affines} we see that the presheaf
$\mathcal{G} : V \mapsto \mathcal{F}(v(V))$ is a separated presheaf
(Sites, Definition \ref{sites-definition-separated}). Hence
the sheafification of $\mathcal{G}$ is $\mathcal{G}^+$, see
Sites, Theorem \ref{sites-theorem-plus}. Next, let $V$ be a weakly
contractible object of $Z_{app}$. Let
$\mathcal{V} = \{V_i \to V\}_{i = 1, \ldots, n}$
be any covering in $Z_{app}$. Set $\mathcal{V}' = \{\coprod V_i \to V\}$.
Since $v$ commutes with finite disjoint unions (as a left adjoint or by
the construction) and since $\mathcal{F}$ sends finite disjoint
unions into products, we see that
$$
H^0(\mathcal{V}, \mathcal{G}) = H^0(\mathcal{V}', \mathcal{G})
$$
(notation as in Sites, Section \ref{sites-section-sheafification};
compare with
\'Etale Cohomology, Lemma \ref{etale-cohomology-lemma-cech-complex}).
Thus we may assume the covering is given by a single morphism, like
so $\{V' \to V\}$. Since $V$ is weakly contractible, this covering
can be refined by the trivial covering $\{V \to V\}$.
It therefore follows that the value of $\mathcal{G}^+ = i^{-1}\mathcal{F}$
on $V$ is simply $\mathcal{F}(v(V))$ and (2) is proved.

\medskip\noindent
Proof of (3). Every object of $Z_{app}$ has a covering by weakly
contractible objects (Lemma \ref{lemma-proetale-enough-w-contractible}).
By the above we see that we would have $i^{Sh}_!h_V = h_{v(V)}$ for $V$
weakly contractible if $i^{Sh}_!$ existed. The existence of
$i^{Sh}_!$ then follows from
Sites, Lemma \ref{sites-lemma-existence-lower-shriek}.

\medskip\noindent
Proof of (4). Existence of $i_!$ follows in the same way by setting
$i_!\mathbf{Z}_V = \mathbf{Z}_{v(V)}$ for $V$ weakly contractible in $Z_{app}$,
using similar for direct sums, and applying
Homology, Lemma \ref{homology-lemma-partially-defined-adjoint}.
Details omitted.

\medskip\noindent
Proof of (5). Let $V$ be a contractible object of $Z_{app}$.
Then $i^{-1}i^{Sh}_!h_V = i^{-1}h_{v(V)} = h_{u(v(V))} = h_V$.
(It is a general fact that $i^{-1}h_U = h_{u(U)}$.) Since the
sheaves $h_V$ for $V$ contractible generate $\Sh(Z_{app})$
(Sites, Lemma \ref{sites-lemma-sheaf-coequalizer-representable})
we conclude $\text{id} \to i^{-1}i^{Sh}_!$ is an isomorphism.
Similarly for the map $\text{id} \to i^{-1}i_!$. Then
$(i^{-1}i_*\mathcal{H})(V) = i_*\mathcal{H}(v(V)) =
\mathcal{H}(u(v(V))) = \mathcal{H}(V)$ and we find that
$i^{-1}i_* \to \text{id}$ is an isomorphism.

\medskip\noindent
The fully faithfulness statements of (6) now follow from
Categories, Lemma \ref{categories-lemma-adjoint-fully-faithful}.
\end{proof}

\begin{lemma}
\label{lemma-closed-immersion}
Let $i : Z \to X$ be a closed immersion of schemes. Then
\begin{enumerate}
\item $i_\proetale^{-1}$ commutes with limits,
\item $i_{\proetale, *}$ is fully faithful, and
\item $i_\proetale^{-1}i_{\proetale, *} \cong \text{id}_{\Sh(Z_\proetale)}$.
\end{enumerate}
\end{lemma}

\begin{proof}
Assertions (2) and (3) are equivalent by
Sites, Lemma \ref{sites-lemma-exactness-properties}.
Parts (1) and (3) are (Zariski) local on $X$, hence we may assume that
$X$ is affine. In this case the result follows from
Lemma \ref{lemma-closed-immersion-affines-apply}.
\end{proof}

\begin{lemma}
\label{lemma-thickening}
Let $i : Z \to X$ be an integral universally injective and surjective morphism
of schemes. Then
$i_{\proetale, *}$ and $i_\proetale^{-1}$ are quasi-inverse
equivalences of categories of pro-\'etale topoi.
\end{lemma}

\begin{proof}
There is an immediate reduction to the case that $X$ is affine.
Then $Z$ is affine too. Set $A = \mathcal{O}(X)$ and $B = \mathcal{O}(Z)$.
Then the categories of \'etale algebras over
$A$ and $B$ are equivalent, see 
\'Etale Cohomology, Theorem
\ref{etale-cohomology-theorem-topological-invariance} and
Remark \ref{etale-cohomology-remark-affine-inside-equivalence}.
Thus the categories of ind-\'etale algebras over $A$ and $B$ are
equivalent. In other words the categories $X_{app}$ and $Z_{app}$
of Lemma \ref{lemma-affine-alternative} are equivalent.
We omit the verification
that this equivalence sends coverings to coverings and vice versa.
Thus the result as Lemma \ref{lemma-affine-alternative}
tells us the pro-\'etale topos is the topos of sheaves on $X_{app}$.
\end{proof}

\begin{lemma}
\label{lemma-compute-i-star}
Let $i : Z \to X$ be a closed immersion of schemes.
Let $U \to X$ be an object of $X_\proetale$ such that
\begin{enumerate}
\item $U$ is affine and weakly contractible, and
\item every point of $U$ specializes to a point of $U \times_X Z$.
\end{enumerate}
Then $i_\proetale^{-1}\mathcal{F}(U \times_X Z) = \mathcal{F}(U)$
for all abelian sheaves on $X_\proetale$.
\end{lemma}

\begin{proof}
Since pullback commutes with restriction, we may replace $X$ by $U$.
Thus we may assume that $X$ is affine and weakly contractible
and that every point of $X$ specializes to a point of $Z$.
By Lemma \ref{lemma-closed-immersion-affines-apply} part (1)
it suffices to show that $v(Z) = X$ in this case.
Thus we have to show: If $A$ is a w-contractible ring, $I \subset A$
an ideal contained in the radical of $A$ and $A \to B \to A/I$
is a factorization with $A \to B$ ind-\'etale, then there is
a unique section $B \to A$ compatible with maps to $A/I$.
Observe that $B/IB = A/I \times R$ as $A/I$-algebras.
After replacing $B$ by a localization we may assume $B/IB = A/I$.
Note that $\Spec(B) \to \Spec(A)$ is surjective as the image
contains $V(I)$ and hence all closed points and is closed under
specialization. Since $A$ is w-contractible there is a section $B \to A$.
Since $B/IB = A/I$ this section is compatible with the map to $A/I$.
We omit the proof of uniqueness (hint: use that $A$ and $B$ have
isomorphic local rings at maximal ideals of $A$).
\end{proof}

\begin{lemma}
\label{lemma-closed-immersion-complement-retrocompact-exact}
Let $i : Z \to X$ be a closed immersion of schemes.
If $X \setminus i(Z)$ is a retrocompact open of $X$, then
$i_{\proetale, *}$ is exact.
\end{lemma}

\begin{proof}
The question is local on $X$ hence we may assume $X$ is affine.
Say $X = \Spec(A)$ and $Z = \Spec(A/I)$. There exist
$f_1, \ldots, f_r \in I$ such that $Z = V(f_1, \ldots, f_r)$
set theoretically, see Algebra, Lemma \ref{algebra-lemma-qc-open}.
By Lemma \ref{lemma-thickening} we may assume that
$Z = \Spec(A/(f_1, \ldots, f_r))$. In this case
the functor $i_{\proetale, *}$ is exact by
Lemma \ref{lemma-finite}.
\end{proof}





\section{Extension by zero}
\label{section-extension-by-zero}

\noindent
The general material in
Modules on Sites, Section \ref{sites-modules-section-localize}
allows us to make the following definition.

\begin{definition}
\label{definition-extension-zero}
Let $j : U \to X$ be a weakly \'etale morphism of schemes.
\begin{enumerate}
\item The restriction functor
$j^{-1} : \Sh(X_\proetale) \to \Sh(U_\proetale)$
has a left adjoint
$j_!^{Sh} : \Sh(X_\proetale) \to \Sh(U_\proetale)$.
\item The restriction functor
$j^{-1} : \textit{Ab}(X_\proetale) \to \textit{Ab}(U_\proetale)$
has a left adjoint which is denoted
$j_! : \textit{Ab}(U_\proetale) \to \textit{Ab}(X_\proetale)$
and called {\it extension by zero}.
\item Let $\Lambda$ be a ring. The functor
$j^{-1} : \textit{Mod}(X_\proetale, \Lambda) \to
\textit{Mod}(U_\proetale, \Lambda)$
has a left adjoint
$j_! : \textit{Mod}(U_\proetale, \Lambda) \to
\textit{Mod}(X_\proetale, \Lambda)$
and called {\it extension by zero}.
\end{enumerate}
\end{definition}

\noindent
As usual we compare this to what happens in the \'etale case.

\begin{lemma}
\label{lemma-jshriek-comparison}
Let $j : U \to X$ be an \'etale morphism of schemes.
Let $\mathcal{G}$ be an abelian sheaf on $U_\etale$.
Then $\epsilon^{-1} j_!\mathcal{G} = j_!\epsilon^{-1}\mathcal{G}$
as sheaves on $X_\proetale$.
\end{lemma}

\begin{proof}
This is true because both are left adjoints to
$j_{\proetale, *}\epsilon^{-1} = \epsilon^{-1}j_{\etale, *}$, see
Lemma \ref{lemma-morphism-comparison}.
\end{proof}

\begin{lemma}
\label{lemma-jshriek-zero}
Let $j : U \to X$ be a weakly \'etale morphism of schemes.
Let $i : Z \to X$ be a closed immersion such that $U \times_X Z = \emptyset$.
Let $V \to X$ be an affine object of $X_\proetale$ such that every point
of $V$ specializes to a point of $V_Z = Z \times_X V$.
Then $j_!\mathcal{F}(V) = 0$ for all abelian sheaves on $U_\proetale$.
\end{lemma}

\begin{proof}
Let $\{V_i \to V\}$ be a pro-\'etale covering. The lemma follows if we
can refine this covering to a covering where the members have no
morphisms into $U$ over $X$ (see construction of $j_!$ in
Modules on Sites, Section \ref{sites-modules-section-localize}).
First refine the covering to get a finite covering with $V_i$ affine.
For each $i$ let $V_i = \Spec(A_i)$ and let $Z_i \subset V_i$ be the
inverse image of $Z$.
Set $W_i = \Spec(A_{i, Z_i}^\sim)$ with notation as in
Lemma \ref{lemma-localization}.
Then $\coprod W_i \to V$ is weakly \'etale and the image contains all
points of $V_Z$. Hence the image contains all points of $V$ by
our assumption on specializations. Thus $\{W_i \to V\}$ is a
pro-\'etale covering refining the given one. But each point in $W_i$
specializes to a point lying over $Z$, hence there are no morphisms
$W_i \to U$ over $X$.
\end{proof}

\begin{lemma}
\label{lemma-open-immersion}
Let $j : U \to X$ be an open immersion of schemes.
Then $\text{id} \cong j^{-1}j_!$ and $j^{-1}j_* \cong \text{id}$
and the functors $j_!$ and $j_*$ are fully faithful.
\end{lemma}

\begin{proof}
See Sites, Lemma \ref{sites-lemma-restrict-back}
and
Categories, Lemma \ref{categories-lemma-adjoint-fully-faithful}.
\end{proof}

\noindent
Here is the relationship between extension by zero and restriction
to the complementary closed subscheme.

\begin{lemma}
\label{lemma-ses-associated-to-open}
Let $X$ be a scheme. Let $Z \subset X$ be a closed subscheme and let
$U \subset X$ be the complement. Denote $i : Z \to X$ and $j : U \to X$
the inclusion morphisms. Assume that $j$ is a quasi-compact morphism.
For every abelian sheaf on $X_\proetale$ there is a canonical short exact
sequence
$$
0 \to j_!j^{-1}\mathcal{F} \to \mathcal{F} \to i_*i^{-1}\mathcal{F} \to 0
$$
on $X_\proetale$ where all the functors are for the pro-\'etale topology.
\end{lemma}

\begin{proof}
We obtain the maps by the adjointness properties of the functors involved.
It suffices to show that $X_\proetale$ has enough objects
(Sites, Definition \ref{sites-definition-w-contractible}) on which
the sequence evaluates to a short exact sequence.
Let $V = \Spec(A)$ be an affine object of $X_\proetale$
such that $A$ is w-contractible (there are enough objects of this type).
Then $V \times_X Z$ is cut out by an ideal $I \subset A$.
The assumption that $j$ is quasi-compact implies there exist
$f_1, \ldots, f_r \in I$ such that $V(I) = V(f_1, \ldots, f_r)$.
We obtain a faithfully flat, ind-Zariski ring map
$$
A \longrightarrow A_{f_1} \times \ldots \times A_{f_r} \times
A_{V(I)}^\sim
$$
with $A_{V(I)}^\sim$ as in Lemma \ref{lemma-localization}.
Since $V_i = \Spec(A_{f_i}) \to X$ factors through $U$ we have
$$
j_!j^{-1}\mathcal{F}(V_i) = \mathcal{F}(V_i)
\quad\text{and}\quad
i_*i^{-1}\mathcal{F}(V_i) = 0
$$
On the other hand, for the scheme $V^\sim = \Spec(A_{V(I)}^\sim)$
we have
$$
j_!j^{-1}\mathcal{F}(V^\sim) = 0
\quad\text{and}\quad
\mathcal{F}(V^\sim) = i_*i^{-1}\mathcal{F}(V^\sim)
$$
the first equality by Lemma \ref{lemma-jshriek-zero}
and the second by
Lemmas \ref{lemma-compute-i-star} and \ref{lemma-localization-w-contractible}.
Thus the sequence evaluates to an exact sequence on
$\Spec(A_{f_1} \times \ldots \times A_{f_r} \times A_{V(I)}^\sim)$
and the lemma is proved.
\end{proof}

\begin{lemma}
\label{lemma-j-shriek-limits}
Let $j : U \to X$ be a quasi-compact open immersion
morphism of schemes. The functor
$j_! : \textit{Ab}(U_\proetale) \to \textit{Ab}(X_\proetale)$
commutes with limits.
\end{lemma}

\begin{proof}
Since $j_!$ is exact it suffices to show that $j_!$ commutes with products.
The question is local on $X$, hence we may assume $X$ affine.
Let $\mathcal{G}$ be an abelian sheaf on $U_\proetale$.
Note that there always is a canonical map
$$
j_!\mathcal{G} \to j_*\mathcal{G}
$$
see Modules on Sites, Remark \ref{sites-modules-remark-from-shriek-to-star}.
In our particular case this map can be obtained from the
fact that $j^{-1}j_*\mathcal{G} = \mathcal{G}$. Hence applying
the exact sequence of Lemma \ref{lemma-ses-associated-to-open}
we get
$$
0 \to j_!\mathcal{G} \to j_*\mathcal{G} \to i_*i^{-1}j_*\mathcal{G} \to 0
$$
where $i : Z \to X$ is the inclusion of the reduced induced scheme
structure on the complement $Z = X \setminus U$.
The functors $j_*$ and $i_*$ commute with products as right adjoints.
The functor $i^{-1}$ commutes with products by
Lemma \ref{lemma-closed-immersion}.
Hence $j_!$ does because on the pro-\'etale site products
are exact
(Cohomology on Sites, Proposition
\ref{sites-cohomology-proposition-enough-weakly-contractibles}).
\end{proof}




\section{Constructible sheaves on the pro-\'etale site}
\label{section-constructible}

\noindent
We stick to constructible sheaves of $\Lambda$-modules for a
Noetherian ring. In the future we intend to discuss constructible
sheaves of sets, groups, etc.

\begin{definition}
\label{definition-constructible}
Let $X$ be a scheme.
Let $\Lambda$ be a Noetherian ring. A sheaf of $\Lambda$-modules
on $X_\proetale$ is {\it constructible} if for every affine open
$U \subset X$ there exists a finite decomposition
of $U$ into constructible locally closed subschemes
$U = \coprod_i U_i$ such that
$\mathcal{F}|_{U_i}$ is of finite type and locally constant for all $i$.
\end{definition}

\noindent
Again this does not give anything ``new''.

\begin{lemma}
\label{lemma-compare-constructible}
Let $X$ be a scheme. Let $\Lambda$ be a Noetherian ring.
The functor $\epsilon^{-1}$ defines an equivalence of categories
$$
\left\{
\begin{matrix}
\text{constructible sheaves of}\\
\Lambda\text{-modules on }X_\etale\\
\end{matrix}
\right\}
\longleftrightarrow
\left\{
\begin{matrix}
\text{constructible sheaves of}\\
\Lambda\text{-modules on }X_\proetale\\
\end{matrix}
\right\}
$$
between constructible sheaves of $\Lambda$-modules on $X_\etale$
and constructible sheaves of $\Lambda$-modules on $X_\proetale$.
\end{lemma}

\begin{proof}
By Lemma \ref{lemma-fully-faithful} the functor $\epsilon^{-1}$
is fully faithful and commutes with pullback (restriction) to
the strata. Hence $\epsilon^{-1}$ of a constructible \'etale
sheaf is a constructible pro-\'etale sheaf. To finish the
proof let $\mathcal{F}$ be a constructible sheaf of $\Lambda$-modules
on $X_\proetale$ as in Definition \ref{definition-constructible}.
There is a canonical map
$$
\epsilon^{-1}\epsilon_*\mathcal{F} \longrightarrow \mathcal{F}
$$
We will show this map is an isomorphism. This will prove that
$\mathcal{F}$ is in the essential image of $\epsilon^{-1}$
and finish the proof (details omitted).

\medskip\noindent
To prove this we may assume that $X$ is affine. In this case we have
a finite partition $X = \coprod_i X_i$ by constructible locally closed
strata such that $\mathcal{F}|_{X_i}$ is locally constant of finite
type. Let $U \subset X$ be one of the open strata in the partition
and let $Z \subset X$ be the reduced induced structure on the complement.
By Lemma \ref{lemma-ses-associated-to-open}
we have a short exact sequence
$$
0 \to j_!j^{-1}\mathcal{F} \to \mathcal{F} \to i_*i^{-1}\mathcal{F} \to 0
$$
on $X_\proetale$. Functoriality gives a commutative diagram
$$
\xymatrix{
0 \ar[r] &
\epsilon^{-1}\epsilon_*j_!j^{-1}\mathcal{F} \ar[r] \ar[d] &
\epsilon^{-1}\epsilon_*\mathcal{F} \ar[r] \ar[d] &
\epsilon^{-1}\epsilon_*i_*i^{-1}\mathcal{F} \ar[r] \ar[d] & 0 \\
0 \ar[r] &
j_!j^{-1}\mathcal{F} \ar[r] &
\mathcal{F} \ar[r] &
i_*i^{-1}\mathcal{F} \ar[r] & 0
}
$$
By induction on the length of the partition we know that
on the one hand
$\epsilon^{-1}\epsilon_*i^{-1}\mathcal{F} \to i^{-1}\mathcal{F}$
and
$\epsilon^{-1}\epsilon_*j^{-1}\mathcal{F} \to j^{-1}\mathcal{F}$
are isomorphisms and on the other that
$i^{-1}\mathcal{F} = \epsilon^{-1}\mathcal{A}$
and
$j^{-1}\mathcal{F} = \epsilon^{-1}\mathcal{B}$
for some constructible sheaves of $\Lambda$-modules
$\mathcal{A}$ on $Z_\etale$ and $\mathcal{B}$ on $U_\etale$.
Then
$$
\epsilon^{-1}\epsilon_*j_!j^{-1}\mathcal{F} =
\epsilon^{-1}\epsilon_*j_!\epsilon^{-1}\mathcal{B} =
\epsilon^{-1}\epsilon_*\epsilon^{-1}j_!\mathcal{B} =
\epsilon^{-1}j_!\mathcal{B} =
j_!\epsilon^{-1}\mathcal{B} =
j_!j^{-1}\mathcal{F}
$$
the second equality by Lemma \ref{lemma-jshriek-comparison},
the third equality by Lemma \ref{lemma-fully-faithful}, and the
fourth equality by Lemma \ref{lemma-jshriek-comparison} again.
Similarly, we have
$$
\epsilon^{-1}\epsilon_*i_*i^{-1}\mathcal{F} =
\epsilon^{-1}\epsilon_*i_*\epsilon^{-1}\mathcal{A} =
\epsilon^{-1}\epsilon_*\epsilon^{-1}i_*\mathcal{A} =
\epsilon^{-1}i_*\mathcal{A} =
i_*\epsilon^{-1}\mathcal{A} =
i_*i^{-1}\mathcal{F}
$$
this time using Lemma \ref{lemma-morphism-comparison}.
By the five lemma we conclude the
vertical map in the middle of the big diagram is an isomorphism.
\end{proof}

\begin{lemma}
\label{lemma-constructible-serre}
Let $X$ be a scheme. Let $\Lambda$ be a Noetherian ring.
The category of constructible sheaves of $\Lambda$-modules on $X_\proetale$
is a weak Serre subcategory of $\textit{Mod}(X_\proetale, \Lambda)$.
\end{lemma}

\begin{proof}
This is a formal consequence of
Lemmas \ref{lemma-compare-constructible} and \ref{lemma-compare-derived}
and the result for the \'etale site
(\'Etale Cohomology, Lemma \ref{etale-cohomology-lemma-constructible-abelian}).
\end{proof}

\begin{lemma}
\label{lemma-compare-constructible-derived}
Let $X$ be a scheme. Let $\Lambda$ be a Noetherian ring.
Let $D_c(X_\etale, \Lambda)$, resp.\ $D_c(X_\proetale, \Lambda)$
be the full subcategory of
$D(X_\etale, \Lambda)$, resp.\ $D(X_\proetale, \Lambda)$
consisting of those complexes whose cohomology sheaves are
constructible sheaves of $\Lambda$-modules. Then
$$
\epsilon^{-1} :
D_c^+(X_\etale, \Lambda)
\longrightarrow
D_c^+(X_\proetale, \Lambda)
$$
is an equivalence of categories.
\end{lemma}

\begin{proof}
The categories $D_c(X_\etale, \Lambda)$ and $D_c(X_\proetale, \Lambda)$
are strictly full, saturated, triangulated subcategories of
$D(X_\etale, \Lambda)$ and $D(X_\proetale, \Lambda)$ by
\'Etale Cohomology, Lemma \ref{etale-cohomology-lemma-constructible-abelian}
and
Lemma \ref{lemma-constructible-serre}
and
Derived Categories, Section \ref{derived-section-triangulated-sub}.
The statement of the lemma follows by combining
Lemmas \ref{lemma-compare-derived} and
\ref{lemma-compare-constructible}.
\end{proof}

\begin{lemma}
\label{lemma-tensor-c}
Let $X$ be a scheme. Let $\Lambda$ be a Noetherian ring.
Let $K, L \in D_c^-(X_\proetale, \Lambda)$. Then
$K \otimes_\Lambda^\mathbf{L} L$ is in $D_c^-(X_\proetale, \Lambda)$.
\end{lemma}

\begin{proof}
Note that $H^i(K \otimes_\Lambda^\mathbf{L} L)$ is the same as
$H^i(\tau_{\geq i - 1}K \otimes_\Lambda^\mathbf{L} \tau_{\geq i - 1}L)$.
Thus we may assume $K$ and $L$ are bounded.
In this case we can apply Lemma \ref{lemma-compare-constructible-derived} to
reduce to the case of the \'etale site, see
\'Etale Cohomology, Lemma \ref{etale-cohomology-lemma-tensor-c}.
\end{proof}

\begin{lemma}
\label{lemma-compare-truncations-constructible}
Let $X$ be a scheme. Let $\Lambda$ be a Noetherian ring.
Let $K$ be an object of $D(X_\proetale, \Lambda)$.
Set $K_n = K \otimes_\Lambda^\mathbf{L} \underline{\Lambda/I^n}$.
If $K_1$ is in $D^-_c(X_\proetale, \Lambda/I)$, then
$K_n$ is in $D^-_c(X_\proetale, \Lambda/I^n)$ for all $n$.
\end{lemma}

\begin{proof}
Consider the distinguished triangles
$$
K \otimes_\Lambda^\mathbf{L} \underline{I^n/I^{n + 1}} \to
K_{n + 1} \to
K_n \to
K \otimes_\Lambda^\mathbf{L} \underline{I^n/I^{n + 1}}[1]
$$
and the isomorphisms
$$
K \otimes_\Lambda^\mathbf{L} \underline{I^n/I^{n + 1}} =
K_1 \otimes_{\Lambda/I}^\mathbf{L} \underline{I^n/I^{n + 1}}
$$
By Lemma \ref{lemma-tensor-c} we see that this tensor product has
constructible cohomology sheaves (and vanishing when $K_1$ has
vanishing cohomology). Hence by induction on $n$ using
Lemma \ref{lemma-constructible-serre}
we see that each $K_n$ has constructible cohomology sheaves.
\end{proof}








\section{Constructible adic sheaves}
\label{section-adic}

\noindent
In this section we define the notion of a constructible
$\Lambda$-sheaf as well as some variants.

\begin{definition}
\label{definition-adic}
Let $\Lambda$ be a Noetherian ring and let $I \subset \Lambda$ be an ideal.
Let $X$ be a scheme. Let $\mathcal{F}$ be a sheaf of $\Lambda$-modules
on $X_\proetale$.
\begin{enumerate}
\item We say $\mathcal{F}$ is a {\it constructible $\Lambda$-sheaf}
if $\mathcal{F} = \lim \mathcal{F}/I^n\mathcal{F}$ and each
$\mathcal{F}/I^n\mathcal{F}$ is a constructible sheaf of $\Lambda/I^n$-modules.
\item If $\mathcal{F}$ is a constructible $\Lambda$-sheaf, then we say
$\mathcal{F}$ is {\it lisse} if each $\mathcal{F}/I^n\mathcal{F}$ is
locally constant.
\item We say $\mathcal{F}$ is {\it adic lisse}\footnote{This may
be nonstandard notation.} if there exists a
$I$-adically complete $\Lambda$-module $M$ with $M/IM$ finite
such that $\mathcal{F}$ is locally isomorphic to
$$
\underline{M}^\wedge = \lim \underline{M/I^nM}.
$$
\item We say $\mathcal{F}$ is
{\it adic constructible}\footnote{This may be nonstandard notation.}
if for every affine open $U \subset X$
there exists a decomposition $U = \coprod U_i$ into
constructible locally closed subschemes such that $\mathcal{F}|_{U_i}$
is adic lisse.
\end{enumerate}
\end{definition}

\noindent
The definition of a constructible $\Lambda$-sheaf is equivalent
to the one in \cite[Expos\'e VI, Definition 1.1.1]{SGA5} when
$\Lambda = \mathbf{Z}_\ell$ and $I = (\ell)$. It is clear that
we have the implications
$$
\xymatrix{
\text{lisse adic} \ar@{=>}[r] \ar@{=>}[d] &
\text{adic constructible} \ar@{=>}[d] \\
\text{lisse constructible }\Lambda\text{-sheaf} \ar@{=>}[r] &
\text{constructible }\Lambda\text{-sheaf}
}
$$
The vertical arrows can be inverted in some cases
(see Lemmas \ref{lemma-Noetherian-constructible} and
\ref{lemma-Noetherian-adic-constructible}). In general
neither the category of adic constructible sheaves nor
the category of adic constructible sheaves is closed
under kernels and cokernels.

\medskip\noindent
Namely, let $X$ be an affine scheme whose underlying topological space $|X|$
is homeomorphic to $\Lambda = \mathbf{Z}_\ell$, see
Example \ref{example-construct-space}. Denote
$f : |X| \to \mathbf{Z}_\ell = \Lambda$
a homeomorphism. We can think of $f$ as a section of
$\underline{\Lambda}^\wedge$ over $X$ and multiplication by $f$
then defines a two term complex
$$
\underline{\Lambda}^\wedge \xrightarrow{f} \underline{\Lambda}^\wedge
$$
on $X_\proetale$. The sheaf $\underline{\Lambda}^\wedge$ is adic lisse.
However, the cokernel of the map above, is not adic constructible, as
the isomorphism type of the stalks of this cokernel attains infinitely
many values: $\mathbf{Z}/\ell^n\mathbf{Z}$ and $\mathbf{Z}_\ell$.
The cokernel is a constructible $\mathbf{Z}_\ell$-sheaf.
However, the kernel is not even a constructible $\mathbf{Z}_\ell$-sheaf
as it is zero a non-quasi-compact open but not zero.

\begin{lemma}
\label{lemma-Noetherian-constructible}
Let $X$ be a Noetherian scheme. Let $\Lambda$ be a Noetherian ring and
let $I \subset \Lambda$ be an ideal. Let $\mathcal{F}$ be a
constructible $\Lambda$-sheaf on $X_\proetale$.
Then there exists a finite partition $X = \coprod X_i$ by
locally closed subschemes such that the restriction $\mathcal{F}|_{X_i}$
is lisse.
\end{lemma}

\begin{proof}
Let $R = \bigoplus I^n/I^{n + 1}$. Observe that $R$ is a Noetherian ring.
Since each of the sheaves
$\mathcal{F}/I^n\mathcal{F}$ is a constructible sheaf of
$\Lambda/I^n\Lambda$-modules also $I^n\mathcal{F}/I^{n + 1}\mathcal{F}$
is a constructible sheaf of $\Lambda/I$-modules and hence the pullback
of a constructible sheaf $\mathcal{G}_n$ on $X_\etale$ by
Lemma \ref{lemma-compare-constructible}.
Set $\mathcal{G} = \bigoplus \mathcal{G}_n$. This is a sheaf
of $R$-modules on $X_\etale$ and the map
$$
\mathcal{G}_0 \otimes_{\Lambda/I} \underline{R}
\longrightarrow
\mathcal{G}
$$
is surjective because the maps
$$
\mathcal{F}/I\mathcal{F} \otimes \underline{I^n/I^{n + 1}} \to
I^n\mathcal{F}/I^{n + 1}\mathcal{F}
$$
are surjective. Hence $\mathcal{G}$ is a constructible sheaf of
$R$-modules by \'Etale Cohomology, Proposition
\ref{etale-cohomology-proposition-constructible-over-noetherian}.
Choose a partition $X = \coprod X_i$ such that
$\mathcal{G}|_{X_i}$ is a locally constant sheaf of $R$-modules
of finite type (\'Etale Cohomology, Lemma
\ref{etale-cohomology-lemma-constructible-quasi-compact-quasi-separated}).
We claim this is a partition as in the lemma.
Namely, replacing $X$ by $X_i$ we may assume $\mathcal{G}$ is locally
constant. It follows that each of the sheaves
 $I^n\mathcal{F}/I^{n + 1}\mathcal{F}$
is locally constant. Using the short exact sequences
$$
0 \to I^n\mathcal{F}/I^{n + 1}\mathcal{F} \to
\mathcal{F}/I^{n + 1}\mathcal{F} \to \mathcal{F}/I^n\mathcal{F} \to 0
$$
induction and Modules on Sites, Lemma
\ref{sites-modules-lemma-kernel-finite-locally-constant}
the lemma follows.
\end{proof}

\begin{lemma}
\label{lemma-weird}
Let $X$ be a weakly contractible affine scheme. Let $\Lambda$ be a Noetherian
ring and $I \subset \Lambda$ be an ideal. Let $\mathcal{F}$ be a sheaf of
$\Lambda$-modules on $X_\proetale$ such that
\begin{enumerate}
\item $\mathcal{F} = \lim \mathcal{F}/I^n\mathcal{F}$,
\item $\mathcal{F}/I^n\mathcal{F}$ is a constant sheaf of
$\Lambda/I^n$-modules,
\item $\mathcal{F}/I\mathcal{F}$ is of finite type.
\end{enumerate}
Then $\mathcal{F} \cong \underline{M}^\wedge$ where $M$ is
a finite $\Lambda^\wedge$-module.
\end{lemma}

\begin{proof}
Pick a $\Lambda/I^n$-module $M_n$ such that
$\mathcal{F}/I^n\mathcal{F} \cong \underline{M_n}$.
Since we have the surjections
$\mathcal{F}/I^{n + 1}\mathcal{F} \to \mathcal{F}/I^n\mathcal{F}$
we conclude that there
exist surjections $M_{n + 1} \to M_n$ inducing isomorphisms
$M_{n + 1}/I^nM_{n + 1} \to M_n$. Fix a choice of such surjections
and set $M = \lim M_n$. Then $M$ is an $I$-adically complete
$\Lambda$-module with $M/I^nM = M_n$, see
Algebra, Lemma \ref{algebra-lemma-limit-complete}.
Since $M_1$ is a finite type $\Lambda$-module
(Modules on Sites, Lemma
\ref{sites-modules-lemma-locally-constant-finite-type})
we see that $M$ is a finite $\Lambda^\wedge$-module.
Consider the sheaves
$$
\mathcal{I}_n = \mathit{Isom}(\underline{M_n}, \mathcal{F}/I^n\mathcal{F})
$$
on $X_\proetale$. Modding out by $I^n$ defines a transition map
$$
\mathcal{I}_{n + 1} \longrightarrow \mathcal{I}_n
$$
By our choice of $M_n$ the sheaf $\mathcal{I}_n$ is a torsor under
$$
\mathit{Isom}(\underline{M_n}, \underline{M_n}) =
\underline{\text{Isom}_\Lambda(M_n, M_n)}
$$
(Modules on Sites, Lemma \ref{sites-modules-lemma-locally-constant})
since $\mathcal{F}/I^n\mathcal{F}$ is (\'etale) locally isomorphic
to $\underline{M_n}$. It follows from
More on Algebra, Lemma \ref{more-algebra-lemma-hom-systems-ML}
that the system of sheaves $(\mathcal{I}_n)$ is Mittag-Leffler.
For each $n$ let $\mathcal{I}'_n \subset \mathcal{I}_n$ be the
image of $\mathcal{I}_N \to \mathcal{I}_n$ for all $N \gg n$.
Then
$$
\ldots \to \mathcal{I}'_3 \to \mathcal{I}'_2 \to \mathcal{I}'_1 \to *
$$
is a sequence of sheaves of sets on $X_\proetale$ with surjective
transition maps. Since $*(X)$ is a singleton (not empty)
and since evaluating at $X$ transforms surjective maps of sheaves of sets
into surjections of sets, we can pick
$s \in \lim \mathcal{I}'_n(X)$. The sections define isomorphisms
$\underline{M}^\wedge \to \lim \mathcal{F}/I^n\mathcal{F} = \mathcal{F}$
and the proof is done.
\end{proof}

\begin{lemma}
\label{lemma-connected-lisse}
Let $X$ be a connected scheme. Let $\Lambda$ be a Noetherian ring and let
$I \subset \Lambda$ be an ideal. If $\mathcal{F}$ is a lisse
constructible $\Lambda$-sheaf on $X_\proetale$, then $\mathcal{F}$
is adic lisse.
\end{lemma}

\begin{proof}
By Lemma \ref{lemma-compare-locally-constant} we have
$\mathcal{F}/I^n\mathcal{F} = \epsilon^{-1}\mathcal{G}_n$
for some locally constant sheaf $\mathcal{G}_n$ of $\Lambda/I^n$-modules. By
\'Etale Cohomology, Lemma
\ref{etale-cohomology-lemma-connected-locally-constant}
there exists a finite $\Lambda/I^n$-module $M_n$ such that
$\mathcal{G}_n$ is locally isomorphic to $\underline{M_n}$.
Choose a covering $\{W_t \to X\}_{t \in T}$ with each $W_t$
affine and weakly contractible.
Then $\mathcal{F}|_{W_t}$ satisfies the assumptions of
Lemma \ref{lemma-weird}
and hence $\mathcal{F}|_{W_t} \cong \underline{N_t}^\wedge$
for some finite $\Lambda^\wedge$-module $N_t$. Note that
$N_t/I^nN_t \cong M_n$ for all $t$ and $n$. Hence
$N_t \cong N_{t'}$ for all $t, t' \in T$, see
More on Algebra, Lemma \ref{more-algebra-lemma-isomorphic-completions}.
This proves that $\mathcal{F}$ is adic lisse.
\end{proof}

\begin{lemma}
\label{lemma-Noetherian-adic-constructible}
Let $X$ be a Noetherian scheme. Let $\Lambda$ be a Noetherian ring and
let $I \subset \Lambda$ be an ideal. Let $\mathcal{F}$ be a
constructible $\Lambda$-sheaf on $X_\proetale$. Then $\mathcal{F}$
is adic constructible.
\end{lemma}

\begin{proof}
This is a consequence of Lemmas \ref{lemma-Noetherian-constructible} and
\ref{lemma-connected-lisse}, the fact that a Noetherian scheme
is locally connected
(Topology, Lemma \ref{topology-lemma-locally-Noetherian-locally-connected}),
and the definitions.
\end{proof}

\noindent
It will be useful to identify the constructible $\Lambda$-sheaves
inside the category of derived complete sheaves of $\Lambda$-modules.
It turns out that the naive analogue of
More on Algebra, Lemma \ref{more-algebra-lemma-derived-complete-finite}
is wrong in this setting. However, here
is the analogue of More on Algebra, Lemma
\ref{more-algebra-lemma-derived-complete-zero}.

\begin{lemma}
\label{lemma-derived-complete-zero}
Let $X$ be a scheme. Let $\Lambda$ be a ring and let
$I \subset \Lambda$ be a finitely generated ideal.
Let $\mathcal{F}$ be a sheaf of $\Lambda$-modules on $X_\proetale$.
If $\mathcal{F}$ is derived complete and $\mathcal{F}/I\mathcal{F} = 0$,
then $\mathcal{F} = 0$.
\end{lemma}

\begin{proof}
Assume that $\mathcal{F}/I\mathcal{F}$ is zero.
Let $I = (f_1, \ldots, f_r)$. Let $i < r$ be the largest
integer such that $\mathcal{G} = \mathcal{F}/(f_1, \ldots, f_i)\mathcal{F}$
is nonzero. If $i$ does not exist, then $\mathcal{F} = 0$ which is what we
want to show. Then $\mathcal{G}$ is derived complete as a cokernel
of a map between derived complete modules, see
Proposition \ref{proposition-enough-weakly-contractibles}.
By our choice of $i$ we have that $f_{i + 1} : \mathcal{G} \to \mathcal{G}$
is surjective. Hence
$$
\lim (\ldots \to \mathcal{G} \xrightarrow{f_{i + 1}} \mathcal{G}
\xrightarrow{f_{i + 1}} \mathcal{G})
$$
is nonzero, contradicting the derived completeness of $\mathcal{G}$.
\end{proof}

\begin{lemma}
\label{lemma-derived-complete-limit}
Let $X$ be a weakly contractible affine scheme.
Let $\Lambda$ be a Noetherian ring and let $I \subset \Lambda$ be an ideal.
Let $\mathcal{F}$ be a derived complete sheaf of $\Lambda$-modules
on $X_\proetale$ with $\mathcal{F}/I\mathcal{F}$ a locally
constant sheaf of $\Lambda/I$-modules of finite type.
Then there exists an integer $t$ and a surjective map
$$
(\underline{\Lambda}^\wedge)^{\oplus t} \to \mathcal{F}
$$
\end{lemma}

\begin{proof}
Since $X$ is weakly contractible, there exists a finite disjoint open
covering $X = \coprod U_i$ such that $\mathcal{F}/I\mathcal{F}|_{U_i}$
is isomorphic to the constant sheaf associated to a finite $\Lambda/I$-module
$M_i$. Choose finitely many generators $m_{ij}$ of $M_i$. We
can find sections $s_{ij} \in \mathcal{F}(X)$ restricting to
$m_{ij}$ viewed as a section of $\mathcal{F}/I\mathcal{F}$ over $U_i$. 
Let $t$ be the total number of $s_{ij}$. Then we obtain a map
$$
\alpha : \underline{\Lambda}^{\oplus t} \longrightarrow \mathcal{F}
$$
which is surjective modulo $I$ by construction. By
Lemma \ref{lemma-naive-completion}
the derived completion of $\underline{\Lambda}^{\oplus t}$ is the
sheaf $(\underline{\Lambda}^\wedge)^{\oplus t}$. Since $\mathcal{F}$
is derived complete we see that $\alpha$ factors through a map
$$
\alpha^\wedge :
(\underline{\Lambda}^\wedge)^{\oplus t}
\longrightarrow
\mathcal{F}
$$
Then $\mathcal{Q} = \Coker(\alpha^\wedge)$ is a derived complete
sheaf of $\Lambda$-modules by
Proposition \ref{proposition-enough-weakly-contractibles}.
By construction $\mathcal{Q}/I\mathcal{Q} = 0$. It follows from
Lemma \ref{lemma-derived-complete-zero}
that $\mathcal{Q} = 0$ which is what we wanted to show.
\end{proof}








\section{A suitable derived category}
\label{section-suitable-derived}

\noindent
Let $X$ be a scheme. It will turn out that for many schemes $X$ a suitable
derived category of $\ell$-adic sheaves can be gotten by considering the
derived complete objects $K$ of $D(X_\proetale, \Lambda)$ with the property
that $K \otimes_\Lambda^\mathbf{L} \mathbf{F}_\ell$ is bounded with
constructible cohomology sheaves. Here is the general definition.

\begin{definition}
\label{definition-Dbc}
Let $\Lambda$ be a Noetherian ring and let $I \subset \Lambda$ be an ideal.
Let $X$ be a scheme. An object $K$ of $D(X_\proetale, \Lambda)$ is called
{\it constructible} if
\begin{enumerate}
\item $K$ is derived complete with respect to $I$,
\item $K \otimes_\Lambda^\mathbf{L} \underline{\Lambda/I}$
has constructible cohomology sheaves and locally has finite tor dimension.
\end{enumerate}
We denote $D_{cons}(X, \Lambda)$ the full subcategory of constructible
$K$ in $D(X_\proetale, \Lambda)$.
\end{definition}

\noindent
Recall that with our conventions a complex of finite tor dimension
is bounded (Cohomology on Sites, Definition
\ref{sites-cohomology-definition-tor-amplitude}).
In fact, let's collect everything proved so far in a lemma.

\begin{lemma}
\label{lemma-describe-constructible-complexes}
In the situation above suppose $K$ is in $D_{cons}(X, \Lambda)$
and $X$ is quasi-compact. Set
$K_n = K \otimes_\Lambda^\mathbf{L} \underline{\Lambda/I^n}$.
There exist $a, b$ such that
\begin{enumerate}
\item $K = R\lim K_n$ and $H^i(K) = 0$ for $i \not \in [a, b]$,
\item each $K_n$ has tor amplitude in $[a, b]$,
\item each $K_n$ has constructible cohomology sheaves,
\item each $K_n = \epsilon^{-1}L_n$ for some
$L_n \in D_{ctf}(X_\etale, \Lambda/I^n)$
(\'Etale Cohomology, Definition \ref{etale-cohomology-definition-ctf}).
\end{enumerate}
\end{lemma}

\begin{proof}
By definition of local having finite tor dimension, we can find
$a, b$ such that $K_1$ has tor amplitude in $[a, b]$.
Part (2) follows from 
Cohomology on Sites, Lemma \ref{sites-cohomology-lemma-bounded}.
Then (1) follows as $K$ is derived complete by the description
of limits in
Cohomology on Sites, Proposition
\ref{sites-cohomology-proposition-enough-weakly-contractibles}
and the fact that $H^b(K_{n + 1}) \to H^b(K_n)$ is surjective
as $K_n = K_{n + 1} \otimes^\mathbf{L}_\Lambda \underline{\Lambda/I^n}$.
Part (3) follows from
Lemma \ref{lemma-compare-truncations-constructible},
Part (4) follows from
Lemma \ref{lemma-compare-constructible-derived}
and the fact that $L_n$ has finite tor dimension because $K_n$ does
(small argument omitted).
\end{proof}

\begin{lemma}
\label{lemma-local-structure-constructible-complex}
Let $X$ be a weakly contractible affine scheme. Let $\Lambda$ be a Noetherian
ring and let $I \subset \Lambda$ be an ideal. Let $K$ be an object of
$D_{cons}(X, \Lambda)$ such that the cohomology sheaves of
$K \otimes_\Lambda^\mathbf{L} \underline{\Lambda/I}$ are locally
constant. Then there exists a finite disjoint open covering
$X = \coprod U_i$ and for each $i$ a finite collection of
finite projective $\Lambda^\wedge$-modules $M_a, \ldots, M_b$
such that $K|_{U_i}$ is represented by a complex
$$
(\underline{M^a})^\wedge \to \ldots \to (\underline{M^b})^\wedge
$$
in $D(U_{i, \proetale}, \Lambda)$ for some maps of sheaves of
$\Lambda$-modules $(\underline{M^i})^\wedge \to (\underline{M^{i + 1}})^\wedge$.
\end{lemma}

\begin{proof}
We freely use the results of
Lemma \ref{lemma-describe-constructible-complexes}.
Choose $a, b$ as in that lemma. We will prove the lemma by
induction on $b - a$. Let $\mathcal{F} = H^b(K)$.
Note that $\mathcal{F}$ is a derived complete sheaf of
$\Lambda$-modules by
Proposition \ref{proposition-enough-weakly-contractibles}.
Moreover $\mathcal{F}/I\mathcal{F}$ is a locally
constant sheaf of $\Lambda/I$-modules of finite type.
Apply Lemma \ref{lemma-derived-complete-limit} to get a surjection
$\rho : (\underline{\Lambda}^\wedge)^{\oplus t} \to \mathcal{F}$.

\medskip\noindent
If $a = b$, then $K = \mathcal{F}[-b]$. In this case we see that
$$
\mathcal{F} \otimes_\Lambda^\mathbf{L} \underline{\Lambda/I} =
\mathcal{F}/I\mathcal{F}
$$
As $X$ is weakly contractible and $\mathcal{F}/I\mathcal{F}$
locally constant, we can find a finite disjoint
union decomposition $X = \coprod U_i$ by affine opens $U_i$
and $\Lambda/I$-modules $\overline{M}_i$
such that $\mathcal{F}/I\mathcal{F}$ restricts to
$\underline{\overline{M}_i}$ on $U_i$. After refining the covering
we may assume the map
$$
\rho|_{U_i} \bmod I :
\underline{\Lambda/I}^{\oplus t}
\longrightarrow
\underline{\overline{M}_i}
$$
is equal to $\underline{\alpha_i}$ for some surjective module map
$\alpha_i : \Lambda/I^{\oplus t} \to \overline{M}_i$, see
Modules on Sites, Lemma \ref{sites-modules-lemma-morphism-locally-constant}.
Note that each $\overline{M}_i$ is a finite $\Lambda/I$-module.
Since $\mathcal{F}/I\mathcal{F}$ has tor amplitude in $[0, 0]$
we conclude that $\overline{M}_i$ is a flat $\Lambda/I$-module.
Hence $\overline{M}_i$ is finite projective
(Algebra, Lemma \ref{algebra-lemma-finite-projective}).
Hence we can find a projector
$\overline{p}_i : (\Lambda/I)^{\oplus t} \to (\Lambda/I)^{\oplus t}$
whose image maps isomorphically to $\overline{M}_i$ under the map $\alpha_i$.
We can lift $\overline{p}_i$ to a projector
$p_i : (\Lambda^\wedge)^{\oplus t} \to
(\Lambda^\wedge)^{\oplus t}$\footnote{Proof: by
Algebra, Lemma \ref{algebra-lemma-lift-idempotents-noncommutative}
we can lift $\overline{p}_i$ to a compatible system of
projectors $p_{i, n} : (\Lambda/I^n)^{\oplus t} \to (\Lambda/I^n)^{\oplus t}$
and then we set $p_i = \lim p_{i, n}$ which works because
$\Lambda^\wedge = \lim \Lambda/I^n$.}.
Then $M_i = \Im(p_i)$ is a finite $I$-adically complete
$\Lambda^\wedge$-module with $M_i/IM_i = \overline{M}_i$.
Over $U_i$ consider the maps
$$
\underline{M_i}^\wedge \to
(\underline{\Lambda}^\wedge)^{\oplus t} \to
\mathcal{F}|_{U_i}
$$
By construction the composition induces an isomorphism modulo $I$.
The source and target are derived complete, hence so are the cokernel
$\mathcal{Q}$ and the kernel $\mathcal{K}$. We have
$\mathcal{Q}/I\mathcal{Q} = 0$ by construction hence $\mathcal{Q}$
is zero by Lemma \ref{lemma-derived-complete-zero}.
Then
$$
0 \to \mathcal{K}/I\mathcal{K} \to
\underline{\overline{M}_i}
\to \mathcal{F}/I\mathcal{F} \to 0
$$
is exact by the vanishing of $\text{Tor}_1$ see at the start of this
paragraph; also use that
$\underline{\Lambda}^\wedge/I\overline{\Lambda}^\wedge$ by
Modules on Sites, Lemma \ref{sites-modules-lemma-completion-flat}
to see that
$\underline{M_i}^\wedge/I\underline{M_i}^\wedge = \underline{\overline{M}_i}$.
Hence $\mathcal{K}/I\mathcal{K} = 0$ by construction and we conclude
that $\mathcal{K} = 0$ as before. This proves the result in case $a = b$.

\medskip\noindent
If $b > a$, then we lift the map $\rho$ to a map
$$
\tilde \rho : (\underline{\Lambda}^\wedge)^{\oplus t}[-b] \longrightarrow K
$$
in $D(X_\proetale, \Lambda)$. This is possible as we can think of
$K$ as a complex of $\underline{\Lambda}^\wedge$-modules by
discussion in the introduction to
Section \ref{section-derived-completion-noetherian}
and because $X_\proetale$ is weakly contractible
hence there is no obstruction to lifting the elements
$\rho(e_s) \in H^0(X, \mathcal{F})$ to elements of $H^b(X, K)$.
Fitting $\tilde \rho$ into a distinguished triangle
$$
(\underline{\Lambda}^\wedge)^{\oplus t}[-b] \to K \to L \to
(\underline{\Lambda}^\wedge)^{\oplus t}[-b + 1]
$$
we see that $L$ is an object of $D_{cons}(X, \Lambda)$ such
that $L \otimes_\Lambda^\mathbf{L} \underline{\Lambda/I}$
has tor amplitude contained in $[a, b - 1]$ (details omitted).
By induction we can describe $L$ locally as stated in the lemma, say
$L$ is isomorphic to
$$
(\underline{M^a})^\wedge \to \ldots \to (\underline{M^{b - 1}})^\wedge
$$
The map
$L \to (\underline{\Lambda}^\wedge)^{\oplus t}[-b + 1]$
corresponds to a map
$(\underline{M^{b - 1}})^\wedge \to (\underline{\Lambda}^\wedge)^{\oplus t}$
which allows us to extend the complex by one. The corresponding
complex is isomorphic to $K$ in the derived category by the properties
of triangulated categories. This finishes the proof.
\end{proof}

\noindent
Motivated by what happens for constructible $\Lambda$-sheaves
we introduce the following notion.

\begin{definition}
\label{definition-adic-constructible}
Let $X$ be a scheme. Let $\Lambda$ be a Noetherian ring and let
$I \subset \Lambda$ be an ideal. Let $K \in D(X_\proetale, \Lambda)$.
\begin{enumerate}
\item We say $K$ is {\it adic lisse}\footnote{This may be
nonstandard notation} if there exists a finite complex of finite
projective $\Lambda^\wedge$-modules $M^\bullet$ such that
$K$ is locally isomorphic to
$$
\underline{M^a}^\wedge \to \ldots \to \underline{M^b}^\wedge
$$
\item We say $K$ is {\it adic constructible}\footnote{This may be
nonstandard notation.} if for every affine open $U \subset X$
there exists a decomposition $U = \coprod U_i$ into
constructible locally closed subschemes such that $K|_{U_i}$
is adic lisse.
\end{enumerate}
\end{definition}

\noindent
The difference between the local structure obtained in
Lemma \ref{lemma-local-structure-constructible-complex}
and the structure of an adic lisse complex is that
the maps $\underline{M^i}^\wedge \to \underline{M^{i + 1}}^\wedge$ in 
Lemma \ref{lemma-local-structure-constructible-complex}
need not be constant, whereas in the definition above they
are required to be constant.

\begin{lemma}
\label{lemma-weakly-contractible-locally-constant-ML}
Let $X$ be a weakly contractible affine scheme. Let $\Lambda$ be a Noetherian
ring and let $I \subset \Lambda$ be an ideal. Let $K$ be an object of
$D_{cons}(X, \Lambda)$ such that
$K \otimes_\Lambda^\mathbf{L} \underline{\Lambda/I^n}$
is isomorphic in $D(X_\proetale, \Lambda/I^n)$ to a
complex of constant sheaves of $\Lambda/I^n$-modules. Then
$$
H^0(X, K \otimes_\Lambda^\mathbf{L} \Lambda/I^n)
$$
has the Mittag-Leffler condition.
\end{lemma}

\begin{proof}
Say $K \otimes_\Lambda^\mathbf{L} \underline{\Lambda/I^n}$ is isomorphic
to $\underline{E_n}$ for some object $E_n$ of $D(\Lambda/I^n)$.
Since $K \otimes_\Lambda^\mathbf{L} \underline{\Lambda/I}$ has
finite tor dimension and has finite type cohomology sheaves
we see that $E_1$ is perfect (see
More on Algebra, Lemma \ref{more-algebra-lemma-perfect}). The transition maps
$$
K \otimes_\Lambda^\mathbf{L} \underline{\Lambda/I^{n + 1}}
\to
K \otimes_\Lambda^\mathbf{L} \underline{\Lambda/I^n}
$$
locally come from (possibly many distinct) maps of complexes
$E_{n + 1} \to E_n$ in $D(\Lambda/I^{n + 1})$ see
Cohomology on Sites, Lemma \ref{sites-cohomology-lemma-locally-constant-map}.
For each $n$ choose one such map and observe that it induces
an isomorphism
$E_{n + 1} \otimes_{\Lambda/I^{n + 1}}^\mathbf{L} \Lambda/I^n \to E_n$
in $D(\Lambda/I^n)$. By
More on Algebra, Lemma \ref{more-algebra-lemma-Rlim-perfect-gives-complete}
we can find a finite complex $M^\bullet$ of finite projective
$\Lambda^\wedge$-modules and isomorphisms $M^\bullet/I^nM^\bullet \to E_n$
in $D(\Lambda/I^n)$ compatible with the transition maps.

\medskip\noindent
Now observe that for each finite collection of indices
$n > m > k$ the triple of maps
$$
H^0(X, K \otimes_\Lambda^\mathbf{L} \Lambda/I^n)
\to
H^0(X, K \otimes_\Lambda^\mathbf{L} \Lambda/I^m)
\to
H^0(X, K \otimes_\Lambda^\mathbf{L} \Lambda/I^k)
$$
is isomorphic to
$$
H^0(X, \underline{M^\bullet/I^nM^\bullet})
\to
H^0(X, \underline{M^\bullet/I^mM^\bullet})
\to
H^0(X, \underline{M^\bullet/I^kM^\bullet})
$$
Namely, choose any isomorphism
$$
\underline{M^\bullet/I^nM^\bullet} \to
K \otimes_\Lambda^\mathbf{L} \Lambda/I^n
$$
induces similar isomorphisms module $I^m$ and $I^k$ and we see that
the assertion is true. Thus to prove the lemma it suffices to show that
the system
$H^0(X, \underline{M^\bullet/I^nM^\bullet})$ has Mittag-Leffler.
Since taking sections over $X$ is exact, it suffices to prove that
the system of $\Lambda$-modules
$$
H^0(M^\bullet/I^nM^\bullet)
$$
has Mittag-Leffler. Set $A = \Lambda^\wedge$ and consider the spectral
sequence
$$
\text{Tor}_{-p}^A(H^q(M^\bullet), A/I^nA) \Rightarrow
H^{p + q}(M^\bullet/I^nM^\bullet)
$$
By More on Algebra, Lemma \ref{more-algebra-lemma-tor-strictly-pro-zero}
the pro-systems $\{\text{Tor}_{-p}^A(H^q(M^\bullet), A/I^nA)\}$ are zero
for $p > 0$. Thus the pro-system $\{H^0(M^\bullet/I^nM^\bullet)\}$
is equal to the pro-system $\{H^0(M^\bullet)/I^nH^0(M^\bullet)\}$
and the lemma is proved.
\end{proof}

\begin{lemma}
\label{lemma-connected-adic-lisse}
Let $X$ be a connected scheme. Let $\Lambda$ be a Noetherian ring and let
$I \subset \Lambda$ be an ideal. If $K$ is in $D_{cons}(X, \Lambda)$
such that $K \otimes_\Lambda \underline{\Lambda/I}$
has locally constant cohomology sheaves, then $K$ is adic lisse
(Definition \ref{definition-adic-constructible}).
\end{lemma}

\begin{proof}
Write $K_n = K \otimes_\Lambda^\mathbf{L} \underline{\Lambda/I^n}$.
We will use the results of Lemma \ref{lemma-describe-constructible-complexes}
without further mention. By Cohomology on Sites, Lemma
\ref{sites-cohomology-lemma-locally-constant-bounded}
we see that $K_n$ has locally constant cohomology sheaves for all $n$.
We have $K_n = \epsilon^{-1}L_n$ some $L_n$ in
$D_{ctf}(X_\etale, \Lambda/I^n)$ with locally constant cohomology sheaves.
By \'Etale Cohomology, Lemma
\ref{etale-cohomology-lemma-connected-ctf-locally-constant}
there exist perfect $M_n \in D(\Lambda/I^n)$
such that $L_n$ is \'etale locally isomorphic to $\underline{M_n}$.
The maps $L_{n + 1} \to L_n$ corresponding to $K_{n + 1} \to K_n$
induces isomorphisms
$L_{n + 1} \otimes_{\Lambda/I^{n + 1}}^\mathbf{L} \underline{\Lambda/I^n}
\to L_n$. Looking locally on $X$ we conclude that there
exist maps $M_{n + 1} \to M_n$ in $D(\Lambda/I^{n + 1})$
inducing isomorphisms
$M_{n + 1} \otimes_{\Lambda/I^{n + 1}} \Lambda/I^n \to M_n$, see
Cohomology on Sites, Lemma \ref{sites-cohomology-lemma-locally-constant-map}.
Fix a choice of such maps. By
More on Algebra, Lemma \ref{more-algebra-lemma-Rlim-perfect-gives-complete}
we can find a finite complex $M^\bullet$ of finite projective
$\Lambda^\wedge$-modules and isomorphisms $M^\bullet/I^nM^\bullet \to M_n$
in $D(\Lambda/I^n)$ compatible with the transition maps.
To finish the proof we will show that $K$ is locally isomorphic
to
$$
\underline{M^\bullet}^\wedge =
\lim \underline{M^\bullet/I^nM^\bullet} =
R\lim \underline{M^\bullet/I^nM^\bullet}
$$
Let $E^\bullet$ be the dual complex to $M^\bullet$, see
More on Algebra, Lemma \ref{more-algebra-lemma-dual-perfect-complex}
and its proof. Consider the objects
$$
H_n =
R\SheafHom_{\Lambda/I^n}(\underline{M^\bullet/I^nM^\bullet}, K_n) =
\underline{E^\bullet/I^nE^\bullet} \otimes_{\Lambda/I^n}^\mathbf{L} K_n
$$
of $D(X_\proetale, \Lambda/I^n)$. Modding out by $I^n$ defines a
transition map $H_{n + 1} \to H_n$. Set $H = R\lim H_n$. Then $H$ is an
object of $D_{cons}(X, \Lambda)$ (details omitted) with
$H \otimes_\Lambda^\mathbf{L} \underline{\Lambda/I^n} = H_n$.
Choose a covering $\{W_t \to X\}_{t \in T}$ with each $W_t$
affine and weakly contractible. By our choice of $M^\bullet$
we see that
\begin{align*}
H_n|_{W_t} & \cong 
R\SheafHom_{\Lambda/I^n}(\underline{M^\bullet/I^nM^\bullet},
\underline{M^\bullet/I^nM^\bullet}) \\
& =
\underline{
\text{Tot}(E^\bullet/I^nE^\bullet \otimes_{\Lambda/I^n} M^\bullet/I^nM^\bullet)
}
\end{align*}
Thus we may apply Lemma \ref{lemma-weakly-contractible-locally-constant-ML}
to $H = R\lim H_n$. We conclude the system $H^0(W_t, H_n)$ satisfies
Mittag-Leffler. Since for all $n \gg 1$ there is an element of $H^0(W_t, H_n)$
which maps to an isomorphism in
$$
H^0(W_t, H_1) = \Hom(\underline{M^\bullet/IM^\bullet}, K_1)
$$
we find an element $(\varphi_{t, n})$
in the inverse limit which produces an isomorphism mod $I$. Then
$$
R\lim \varphi_{t, n} :
\underline{M^\bullet}^\wedge|_{W_t} =
R\lim \underline{M^\bullet/I^nM^\bullet}|_{W_t}
\longrightarrow
R\lim K_n|_{W_t} = K|_{W_t}
$$
is an isomorphism. This finishes the proof.
\end{proof}

\begin{proposition}
\label{proposition-Noetherian-adic-constructible}
Let $X$ be a Noetherian scheme. Let $\Lambda$ be a Noetherian ring and
let $I \subset \Lambda$ be an ideal. Let $K$ be an object of
$D_{cons}(X, \Lambda)$. Then $K$ is adic constructible
(Definition \ref{definition-adic-constructible}).
\end{proposition}

\begin{proof}
This is a consequence of Lemma \ref{lemma-connected-adic-lisse}
and the fact that a Noetherian scheme is locally connected
(Topology, Lemma \ref{topology-lemma-locally-Noetherian-locally-connected}),
and the definitions.
\end{proof}







\section{Proper base change}
\label{section-proper-base-change}

\noindent
In this section we explain how to prove the proper base change theorem
for derived complete objects on the pro-\'etale site using the proper
base change theorem for \'etale cohomology following the general theme
that we use the pro-\'etale topology only to deal with ``limit issues''
and we use results proved for the \'etale topology to handle everything
else.

\begin{theorem}
\label{theorem-proper-base-change}
Let $f : X \to Y$ be a proper morphism of schemes. Let $g : Y' \to Y$ be
a morphism of schemes giving rise to the base change diagram
$$
\xymatrix{
X' \ar[r]_{g'} \ar[d]_{f'} & X \ar[d]^f \\
Y' \ar[r]^g & Y
}
$$
Let $\Lambda$ be a Noetherian ring and let $I \subset \Lambda$ be an ideal
such that $\Lambda/I$ is torsion. Let $K$ be an object
of $D(X_\proetale)$ such that
\begin{enumerate}
\item $K$ is derived complete, and
\item $K \otimes_\Lambda^\mathbf{L} \underline{\Lambda/I^n}$ is
bounded below with cohomology sheaves coming from $X_\etale$,
\item $\Lambda/I^n$ is a perfect $\Lambda$-module\footnote{This assumption
can be removed if $K$ is a constructible complex, see \cite{BS}.}.
\end{enumerate}
Then the base change map
$$
Lg_{comp}^*Rf_*K \longrightarrow Rf'_*L(g')^*_{comp}K
$$
is an isomorphism.
\end{theorem}

\begin{proof}
We omit the construction of the base change map (this uses only
formal properties of derived pushforward and completed derived pullback,
compare with
Cohomology on Sites, Remark \ref{sites-cohomology-remark-base-change}).
Write $K_n = K \otimes^\mathbf{L}_\Lambda \underline{\Lambda/I^n}$.
By Lemma \ref{lemma-naive-completion} we have $K = R\lim K_n$
because $K$ is derived complete.
By Lemmas \ref{lemma-pushforward-Noetherian-case} and
\ref{lemma-naive-completion} we can unwind the left hand side
$$
Lg_{comp}^* Rf_* K =
R\lim Lg^*(Rf_*K)\otimes^\mathbf{L}_\Lambda \underline{\Lambda/I^n} =
R\lim Lg^* Rf_* K_n
$$
the last equality because $\Lambda/I^n$ is a perfect module and
the projection formula (Cohomology on Sites, Lemma
\ref{sites-cohomology-lemma-projection-formula}).
Using Lemma \ref{lemma-pushforward-Noetherian-case} we can unwind the right
hand side
$$
Rf'_* L(g')^*_{comp} K =
Rf'_* R\lim L(g')^* K_n  =
R\lim Rf'_* L(g')^* K_n
$$
the last equality because $Rf'_*$ commutes with $R\lim$
(Cohomology on Sites, Lemma
\ref{sites-cohomology-lemma-Rf-commutes-with-Rlim}).
Thus it suffices to show the maps
$$
Lg^* Rf_* K_n \longrightarrow Rf'_* L(g')^* K_n
$$
are isomorphisms. By Lemma \ref{lemma-compare-derived} and our second
condition we can write $K_n = \epsilon^{-1}L_n$ for some
$L_n \in D^+(X_\etale, \Lambda/I^n)$. By Lemma \ref{lemma-morphism-comparison}
and the fact that $\epsilon^{-1}$ commutes with pullbacks
we obtain
$$
Lg^* Rf_* K_n =
Lg^* Rf_* \epsilon^*L_n =
Lg^* \epsilon^{-1} Rf_* L_n =
\epsilon^{-1} Lg^* Rf_* L_n
$$
and
$$
Rf'_* L(g')^* K_n =
Rf'_* L(g')^* \epsilon^{-1} L_n =
Rf'_* \epsilon^{-1} L(g')^* L_n =
\epsilon^{-1} Rf'_* L(g')^* L_n
$$
(this also uses that $L_n$ is bounded below).
Finally, by the proper base change theorem for \'etale cohomology
(\'Etale Cohomology, Theorem
\ref{etale-cohomology-theorem-proper-base-change}) we have
$$
Lg^* Rf_* L_n = Rf'_* L(g')^* L_n
$$
(again using that $L_n$ is bounded below)
and the theorem is proved.
\end{proof}










\input{chapters}

\bibliography{my}
\bibliographystyle{amsalpha}

\end{document}
